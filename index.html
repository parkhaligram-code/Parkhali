<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        /* --- Premium CSS Variables & Reset --- */
        :root { 
            --primary-blue: #1565c0; --primary-green: #2e7d32; 
            --blood-red: #e53935; --emergency-orange: #fb8c00; --agri-green: #689f38; 
            --bg-color: #f8fafc; --card-bg: #ffffff; 
            --text-main: #1e293b; --text-muted: #64748b; 
            --shadow-md: 0 10px 15px -3px rgba(0,0,0,0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.1);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Hind Siliguri', 'Poppins', sans-serif; margin: 0; padding: 0; background-color: var(--bg-color); color: var(--text-main); overflow-x: hidden; padding-bottom: 90px; }
        
        .container { max-width: 480px; margin: 0 auto; min-height: 100vh; position: relative; background: #fff; box-shadow: 0 0 20px rgba(0,0,0,0.03); }

        /* --- SPLASH SCREEN --- */
        #splash-screen { position: fixed; inset: 0; max-width: 480px; margin: 0 auto; background: linear-gradient(135deg, var(--primary-blue), var(--primary-green)); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.6s ease-out, visibility 0.6s ease-out; }
        .splash-logo { font-size: 80px; color: white; margin-bottom: 10px; animation: pulse-logo 1.5s infinite ease-in-out; }
        .splash-text { color: white; font-size: 2rem; font-weight: 700; margin: 0; letter-spacing: 1px; }
        .spinner { width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; margin-top: 30px; animation: spin 1s linear infinite; }
        @keyframes pulse-logo { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes spin { to { transform: rotate(360deg); } }
        .splash-hidden { opacity: 0; visibility: hidden; pointer-events: none; }

        /* --- HEADER --- */
        header { background: linear-gradient(135deg, var(--primary-blue), var(--primary-green)); color: white; padding: 2rem 1.5rem 3.5rem; border-bottom-left-radius: 35px; border-bottom-right-radius: 35px; box-shadow: var(--shadow-md); position: relative; z-index: 10; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .header-top h1 { font-size: 1.5rem; font-weight: 700; margin: 0; display: flex; align-items: center; gap: 8px;}
        .logout-btn { background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 15px; cursor: pointer; border-radius: 20px; font-size: 0.9rem; font-weight: 600; display: none; align-items: center; gap: 5px; backdrop-filter: blur(5px); transition: 0.3s; }
        .hero-section h2 { font-size: 2rem; margin: 0 0 0.2rem 0; font-weight: 700; }
        .hero-section p { font-size: 1.05rem; opacity: 0.9; margin: 0; }

        /* --- MAIN CONTENT --- */
        main { padding: 0 1.5rem; margin-top: -2.5rem; position: relative; z-index: 20; }
        .section-card { background: var(--card-bg); padding: 1.5rem; border-radius: 20px; box-shadow: var(--shadow-lg); margin-bottom: 1.5rem; transition: transform 0.3s ease; border: 1px solid #f1f5f9; }
        .section-title { font-size: 1.25rem; color: var(--text-main); margin: 0 0 1.2rem 0; font-weight: 700; display: flex; align-items: center; gap: 8px;}
        
        /* --- FORMS --- */
        .form-input { width: 100%; padding: 14px 16px; margin: 8px 0 16px; border: 1.5px solid #e2e8f0; border-radius: 12px; font-family: inherit; font-size: 1rem; background: #f8fafc; transition: all 0.3s; }
        .form-input:focus { border-color: var(--primary-blue); background: #fff; outline: none; box-shadow: 0 0 0 4px rgba(21,101,192,0.1); }
        .btn-primary { width: 100%; padding: 14px; background: linear-gradient(135deg, var(--primary-blue), var(--primary-green)); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 1.1rem; letter-spacing: 0.5px; transition: 0.3s; box-shadow: 0 4px 12px rgba(46,125,50,0.3); }
        .btn-primary:active { transform: translateY(2px); box-shadow: none; }
        .msg { font-size: 0.9rem; margin-top: 10px; text-align: center; font-weight: 500; }
        .error { color: var(--blood-red); } .success { color: var(--primary-green); }

        /* --- BANNER SLIDER (16:9 Aspect Ratio) --- */
        .banner-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Ratio */
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            margin-bottom: 20px;
            background: #e2e8f0;
        }
        .banner-slide {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; opacity: 0; transition: opacity 0.8s ease-in-out;
        }
        .banner-slide.active { opacity: 1; }
        
        /* --- ADMIN BANNER ITEM --- */
        .admin-banner-item {
            display: flex; align-items: center; gap: 10px; padding: 10px;
            border: 1px solid #e2e8f0; border-radius: 12px; margin-bottom: 10px;
            background: #fff;
        }
        .admin-banner-thumb {
            width: 80px; height: 45px; object-fit: cover; border-radius: 8px;
            background: #f1f5f9;
        }

        /* --- SERVICES GRID --- */
        .services-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.2rem; }
        .service-item { background: white; padding: 20px; border-radius: 20px; box-shadow: var(--shadow-md); display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: 0.3s; border: 1px solid #f1f5f9; text-align: center; }
        .service-item:active { transform: scale(0.95); background: #f8fafc; }
        .service-icon { width: 60px; height: 60px; border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 32px; margin-bottom: 0.8rem; box-shadow: var(--shadow-md); }
        .icon-blood { background: #ffebee; color: var(--blood-red); }
        .icon-emergency { background: #fff3e0; color: var(--emergency-orange); }
        .icon-agri { background: #f1f8e9; color: var(--agri-green); }
        .service-label { font-size: 0.95rem; font-weight: 600; color: var(--text-main); }

        /* --- NOTICES --- */
        .notice-item { background: #fff; padding: 1.2rem; border-radius: 16px; margin-bottom: 1rem; border: 1px solid #f1f5f9; border-left: 5px solid var(--primary-blue); box-shadow: var(--shadow-md); }
        .notice-item h4 { margin: 0 0 0.5rem; color: var(--text-main); font-size: 1.15rem; font-weight: 700;}
        .notice-item p { margin: 0 0 0.8rem; font-size: 0.95rem; color: var(--text-muted); line-height: 1.5; }

        /* --- BOTTOM NAV --- */
        .bottom-nav { position: fixed; bottom: 20px; left: 20px; right: 20px; max-width: 440px; margin: 0 auto; background: white; display: none; justify-content: space-between; align-items: center; padding: 0.6rem 1.5rem; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); z-index: 100; }
        .nav-item { color: #94a3b8; text-decoration: none; display: flex; flex-direction: column; align-items: center; font-size: 0.75rem; font-weight: 600; cursor: pointer; transition: 0.3s; flex: 1; }
        .nav-item.active { color: var(--primary-blue); }
        .nav-center { position: relative; top: -25px; background: var(--primary-blue); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(21,101,192,0.4); border: 4px solid white; transition: 0.3s; }
        .nav-center .material-icons-round { color: white; font-size: 30px; }
        .nav-icon { font-size: 26px; margin-bottom: 2px; }

        /* --- SUCCESS MODAL --- */
        .success-modal { position: fixed; inset: 0; background: rgba(255,255,255,0.95); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .checkmark-circle { width: 80px; height: 80px; background: #4caf50; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .checkmark-icon { color: white; font-size: 50px; }
        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        /* --- ADMIN & MODAL STYLES --- */
        .modal-overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px); z-index: 200; display: none; justify-content: center; align-items: flex-end; opacity: 0; transition: opacity 0.3s ease; }
        .modal-overlay.show { opacity: 1; }
        .modal-content { background: white; width: 100%; max-width: 480px; border-top-left-radius: 30px; border-top-right-radius: 30px; padding: 2rem 1.5rem; max-height: 85vh; overflow-y: auto; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .modal-overlay.show .modal-content { transform: translateY(0); }
        .admin-stat-card { background: linear-gradient(135deg, #1e293b, #334155); color: white; padding: 15px; border-radius: 16px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .badge { padding: 4px 10px; border-radius: 8px; font-size: 0.75rem; font-weight: 700; color: white; }
        .badge-active { background: #10b981; } .badge-banned { background: var(--blood-red); } .badge-admin { background: var(--primary-blue); }
        .contact-card { background: #fff; padding: 15px; border-radius: 16px; margin-bottom: 12px; border: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; box-shadow: var(--shadow-md); }
        .contact-badge { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 14px; font-weight: 700; font-size: 1.1rem; color: white; }
        .call-btn { width: 45px; height: 45px; border-radius: 14px; display: flex; align-items: center; justify-content: center; text-decoration: none; color: white; background: #10b981; }
        .close-btn { background: #f1f5f9; border: none; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-muted); }
        .btn-action { padding: 5px 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.75rem; color: white; margin-left: 5px; }
        .btn-delete { background: var(--blood-red); } .btn-ban { background: var(--emergency-orange); } .btn-unban { background: #10b981; }
    </style>
</head>
<body>

    <div id="splash-screen">
        <span class="material-icons-round splash-logo">holiday_village</span>
        <h1 class="splash-text">‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ</h1>
        <div class="spinner"></div>
    </div>

    <div id="success-modal" class="success-modal">
        <div class="checkmark-circle"><span class="material-icons-round checkmark-icon">check</span></div>
        <h2 style="color: #333; margin-bottom: 5px;">‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!</h2>
        <p style="color: #666;">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§</p>
    </div>

    <div class="container">
        <header>
            <div class="header-top">
                <h1><span class="material-icons-round" style="font-size: 28px;">widgets</span> ‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ</h1>
                <button id="logout-btn" class="logout-btn"><span class="material-icons-round" style="font-size: 18px;">logout</span> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
            <div class="hero-section" id="hero-text">
                <h2>‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2>
                <p>‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶∏‡ßá‡¶¨‡¶æ‡¶Ø‡¶º ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡•§</p>
            </div>
        </header>

        <main>
            <section id="auth-section" class="section-card" style="display: none;">
                <h3 class="section-title" style="justify-content: center;">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <input type="email" id="email" class="form-input" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤" required>
                <input type="password" id="password" class="form-input" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°" required>
                <button id="auth-action-btn" class="btn-primary">‡¶≤‡¶ó‡¶á‡¶®</button>
                <p style="text-align: center; margin-top: 15px; color: #64748b;" id="toggle-auth">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? <span style="color: var(--primary-blue); font-weight: 700; cursor: pointer;">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span></p>
                <p id="auth-msg" class="msg"></p>
            </section>

            <section id="reg-form-view" class="section-card" style="display: none;">
                <h3 class="section-title" style="color: var(--primary-green);">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®</h3>
                <p style="margin-bottom: 20px; color: #666; font-size: 0.9rem;">‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶´‡¶∞‡ßç‡¶Æ‡¶ü‡¶ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                
                <input type="text" id="reg-name" class="form-input" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ">
                <input type="text" id="reg-profession" class="form-input" placeholder="‡¶™‡ßá‡¶∂‡¶æ (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶õ‡¶æ‡¶§‡ßç‡¶∞, ‡¶ï‡ßÉ‡¶∑‡¶ï)">
                <select id="reg-blood" class="form-input">
                    <option value="">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®...</option><option value="A+">A+</option><option value="A-">A-</option><option value="B+">B+</option><option value="B-">B-</option><option value="O+">O+</option><option value="O-">O-</option><option value="AB+">AB+</option><option value="AB-">AB-</option>
                </select>
                <input type="tel" id="reg-phone" class="form-input" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
                <input type="text" id="reg-para" class="form-input" placeholder="‡¶™‡¶æ‡ßú‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
                <button id="submit-profile-btn" class="btn-primary">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </section>

            <div id="home-view" style="display: none;">
                <div class="banner-container" id="home-banner-slider">
                    <div style="display:flex; justify-content:center; align-items:center; height:100%; color:#94a3b8">‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
                </div>

                <section class="section-card">
                    <h3 class="section-title"><span class="material-icons-round" style="color:var(--primary-blue);">campaign</span> ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¨‡ßã‡¶∞‡ßç‡¶°</h3>
                    <div id="notice-container"><div style="padding: 20px; text-align: center; color: var(--text-muted);">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div></div>
                </section>
            </div>

            <div id="services-view" style="display: none;">
                <section class="section-card" style="background: transparent; box-shadow: none; padding: 0; border: none;">
                    <h3 class="section-title" style="margin-bottom: 20px;">‡¶∏‡¶ï‡¶≤ ‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
                    <div class="services-grid">
                        <div class="service-item" onclick="openModal('blood-donor-modal'); loadDonors();">
                            <div class="service-icon icon-blood"><span class="material-icons-round">bloodtype</span></div>
                            <div class="service-label">‡¶¨‡ßç‡¶≤‡¶æ‡¶° ‡¶°‡ßã‡¶®‡¶æ‡¶∞</div>
                        </div>
                        <div class="service-item" onclick="openModal('emergency-modal')">
                            <div class="service-icon icon-emergency"><span class="material-icons-round">support_agent</span></div>
                            <div class="service-label">‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ</div>
                        </div>
                        <div class="service-item" onclick="openModal('agriculture-modal')">
                            <div class="service-icon icon-agri"><span class="material-icons-round">agriculture</span></div>
                            <div class="service-label">‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶§‡¶•‡ßç‡¶Ø</div>
                        </div>
                    </div>
                </section>
            </div>

            <div id="profile-view" style="display: none;">
                <section class="section-card" style="text-align: center;">
                    <div style="width: 80px; height: 80px; background: var(--primary-blue); color: white; font-size: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; margin: 0 auto 15px;"><span class="material-icons-round">person</span></div>
                    <h3 style="margin: 0;" id="profile-display-name">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h3>
                    <p style="color: var(--text-muted); font-size: 0.95rem;" id="profile-display-role"></p>
                    <p style="color: var(--text-muted); font-size: 0.85rem;" id="profile-display-email"></p>
                </section>
                <section class="section-card">
                    <h4 style="margin: 0 0 15px 0;">‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                    <input type="text" id="up-name" class="form-input" placeholder="‡¶®‡¶æ‡¶Æ">
                    <input type="text" id="up-profession" class="form-input" placeholder="‡¶™‡ßá‡¶∂‡¶æ">
                    <input type="tel" id="up-phone" class="form-input" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤">
                    <button id="update-profile-btn" class="btn-primary">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </section>
            </div>

            <div id="admin-view" style="display: none;">
                <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                    <div class="admin-stat-card" style="flex: 1;"><div><div class="stat-number" id="total-users">-</div><div>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</div></div><span class="material-icons-round" style="font-size: 32px; opacity: 0.5;">group</span></div>
                    <div class="admin-stat-card" style="flex: 1; background: linear-gradient(135deg, #0f766e, #115e59);"><div><div class="stat-number" id="total-notices">-</div><div>‡¶®‡ßã‡¶ü‡¶ø‡¶∂</div></div><span class="material-icons-round" style="font-size: 32px; opacity: 0.5;">campaign</span></div>
                </div>

                <section class="section-card">
                    <h3 class="section-title">‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h3>
                    <input type="text" id="banner-img-url" class="form-input" placeholder="‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï (URL)">
                    <input type="text" id="banner-link-url" class="form-input" placeholder="‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ø‡ßá‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá (Link URL)">
                    <button id="add-banner-btn" class="btn-primary" style="background: #e91e63;">‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <div id="admin-banner-list" style="margin-top: 15px;"></div>
                </section>

                <section class="section-card">
                    <h3 class="section-title">‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂</h3>
                    <input type="text" id="notice-title" class="form-input" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ">
                    <textarea id="notice-desc" class="form-input" rows="3" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§..."></textarea>
                    <button id="publish-btn" class="btn-primary">‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </section>
                
                <section class="section-card">
                    <h3 class="section-title">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤</h3>
                    <input type="text" id="search-user" class="form-input" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
                    <div id="admin-user-list" style="margin-top: 10px; max-height: 350px; overflow-y: auto;"></div>
                </section>
            </div>
        </main>

        <nav class="bottom-nav" id="bottom-nav">
            <div class="nav-item active" id="nav-btn-home"><span class="material-icons-round nav-icon">home</span> ‡¶π‡ßã‡¶Æ</div>
            <div class="nav-center" id="nav-btn-services"><span class="material-icons-round">grid_view</span></div>
            <div class="nav-item" id="nav-btn-admin" style="display: none;"><span class="material-icons-round nav-icon">admin_panel_settings</span> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</div>
            <div class="nav-item" id="nav-btn-profile"><span class="material-icons-round nav-icon">person</span> ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</div>
        </nav>

        <div id="blood-donor-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h3 style="color:var(--blood-red);margin:0">ü©∏ ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶§‡¶æ</h3><button class="close-btn" onclick="closeModal('blood-donor-modal')"><span class="material-icons-round">close</span></button></div><div style="background:#fff5f5;padding:15px;border-radius:16px;margin-bottom:20px;border:1px solid #fed7d7"><h4 style="color:var(--blood-red);margin:0 0 10px 0">‡¶®‡¶ø‡¶ú‡ßá‡¶ï‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</h4><input type="text" id="donor-name" class="form-input" placeholder="‡¶®‡¶æ‡¶Æ"><select id="donor-group" class="form-input"><option value="">‡¶ó‡ßç‡¶∞‡ßÅ‡¶™...</option><option value="A+">A+</option><option value="B+">B+</option><option value="O+">O+</option><option value="AB+">AB+</option></select><input type="tel" id="donor-phone" class="form-input" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤"><button id="add-donor-btn" class="btn-primary" style="background:var(--blood-red)">‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button></div><div><select id="filter-group" class="form-input" onchange="loadDonors(this.value)"><option value="All">‡¶∏‡¶¨ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</option><option value="A+">A+</option><option value="B+">B+</option><option value="O+">O+</option><option value="AB+">AB+</option></select><div id="donor-list-container" style="margin-top:15px"></div></div></div></div>
        <div id="emergency-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h3 style="color:var(--emergency-orange);margin:0">‚òéÔ∏è ‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ</h3><button class="close-btn" onclick="closeModal('emergency-modal')"><span class="material-icons-round">close</span></button></div><div class="contact-card"><div><h5>‡¶ú‡¶æ‡¶§‡ßÄ‡ßü ‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ</h5><p>999</p></div><a href="tel:999" class="call-btn"><span class="material-icons-round">call</span></a></div><div class="contact-card"><div><h5>‡¶ö‡ßá‡ßü‡¶æ‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®</h5><p>01700000000</p></div><a href="tel:01700000000" class="call-btn"><span class="material-icons-round">call</span></a></div></div></div>
        <div id="agriculture-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h3 style="color:var(--agri-green);margin:0">üåæ ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂</h3><button class="close-btn" onclick="closeModal('agriculture-modal')"><span class="material-icons-round">close</span></button></div><div style="background:#f0fdf4;padding:15px;border-radius:16px;margin-bottom:20px;border:1px solid #bbf7d0"><p style="margin:0;color:#166534">‡¶¨‡ßã‡¶∞‡ßã ‡¶Æ‡ßå‡¶∏‡ßÅ‡¶Æ‡ßá ‡¶ú‡¶Æ‡¶ø‡¶§‡ßá ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶∏‡ßá‡¶ö ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p></div><div class="contact-card"><div><h5>‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶ï‡¶≤ ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</h5><p>16123</p></div><a href="tel:16123" class="call-btn"><span class="material-icons-round">call</span></a></div></div></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc, setDoc, updateDoc, deleteDoc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyAuqcDRrtuQi2tdWXA2E_UWyq7pCrGpoy4", authDomain: "parkhali-village.firebaseapp.com", projectId: "parkhali-village" };
        const app = initializeApp(firebaseConfig); const auth = getAuth(app); const db = getFirestore(app); const adminEmail = "admin@parkhali.com";

        window.openModal=(id)=>{const m=document.getElementById(id);m.style.display='flex';setTimeout(()=>m.classList.add('show'),10)};
        window.closeModal=(id)=>{const m=document.getElementById(id);m.classList.remove('show');setTimeout(()=>m.style.display='none',300)};

        const views = { auth:document.getElementById('auth-section'), reg:document.getElementById('reg-form-view'), home:document.getElementById('home-view'), services:document.getElementById('services-view'), profile:document.getElementById('profile-view'), admin:document.getElementById('admin-view') };
        const navs = { home:document.getElementById('nav-btn-home'), services:document.getElementById('nav-btn-services'), profile:document.getElementById('nav-btn-profile'), admin:document.getElementById('nav-btn-admin') };

        function switchView(name) {
            Object.values(views).forEach(el=>el.style.display='none');
            Object.values(navs).forEach(el=>el.classList.remove('active'));
            if(name==='services') navs.services.style.transform="scale(1.1)"; else { navs.services.style.transform="scale(1)"; if(navs[name]) navs[name].classList.add('active'); }
            views[name].style.display='block';
            
            const hTitle=document.querySelector('.hero-section h2'); const hSub=document.querySelector('.hero-section p');
            if(name==='home'){hTitle.innerText="‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!"; hSub.innerText=auth.currentUser?auth.currentUser.email.split('@')[0]:""; loadBanners();}
            else if(name==='services'){hTitle.innerText="‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π"; hSub.innerText="‡¶è‡¶ï‡¶®‡¶ú‡¶∞‡ßá ‡¶∏‡¶¨ ‡¶∏‡ßá‡¶¨‡¶æ";}
            else if(name==='profile'){hTitle.innerText="‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤"; hSub.innerText="‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶§‡¶•‡ßç‡¶Ø"; loadProfile();}
            else if(name==='admin'){hTitle.innerText="‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®"; hSub.innerText="‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶∞‡ßÅ‡¶Æ"; loadAdminData();}
            else if(name==='reg'){hTitle.innerText="‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶®"; hSub.innerText="‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶π‡¶æ‡ßü‡¶§‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®";}
        }

        Object.keys(navs).forEach(k=>navs[k].addEventListener('click',()=>switchView(k)));

        // AUTH & FLOW LOGIC
        onAuthStateChanged(auth, async (user) => {
            setTimeout(()=>document.getElementById('splash-screen').classList.add('splash-hidden'), 2000);
            if (user) {
                const docSnap = await getDoc(doc(db, "users", user.uid));
                if(docSnap.exists()) {
                    const data = docSnap.data();
                    if(data.status === "banned" && user.email !== adminEmail) { signOut(auth); alert("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); return; }
                    document.getElementById('logout-btn').style.display="flex";
                    if(!data.name && user.email !== adminEmail) { document.getElementById('bottom-nav').style.display="none"; switchView('reg'); } 
                    else { document.getElementById('bottom-nav').style.display="flex"; navs.admin.style.display = (user.email === adminEmail) ? "flex" : "none"; switchView('home'); loadNotices(); }
                } else {
                     await setDoc(doc(db, "users", user.uid), { email:user.email, role:"user", status:"active" }); switchView('reg');
                }
            } else { switchView('auth'); document.getElementById('logout-btn').style.display="none"; document.getElementById('bottom-nav').style.display="none"; }
        });

        // LOGIN/REGISTER
        let isLogin = true; document.getElementById('toggle-auth').addEventListener('click', () => { isLogin=!isLogin; document.getElementById('auth-action-btn').innerText = isLogin?"‡¶≤‡¶ó‡¶á‡¶®":"‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞"; document.querySelector('#auth-section h3').innerText = isLogin?"‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®":"‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";});
        document.getElementById('auth-action-btn').addEventListener('click', async () => {
            const em = document.getElementById('email').value; const pass = document.getElementById('password').value;
            if(!em || !pass) return;
            try { if(isLogin) await signInWithEmailAndPassword(auth, em, pass); else { const cred = await createUserWithEmailAndPassword(auth, em, pass); await setDoc(doc(db, "users", cred.user.uid), { email: em, role: em===adminEmail?"admin":"user", status: "active", createdAt: serverTimestamp() }); } } catch(e) { alert("‡¶è‡¶∞‡¶∞: " + e.message); }
        });
        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));

        // SUBMIT PROFILE
        document.getElementById('submit-profile-btn').addEventListener('click', async () => {
            if(!document.getElementById('reg-name').value || !document.getElementById('reg-para').value) { alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!"); return; }
            await updateDoc(doc(db, "users", auth.currentUser.uid), { name: document.getElementById('reg-name').value, profession: document.getElementById('reg-profession').value, bloodGroup: document.getElementById('reg-blood').value, phone: document.getElementById('reg-phone').value, address: document.getElementById('reg-para').value });
            document.getElementById('success-modal').style.display = 'flex'; setTimeout(() => { document.getElementById('success-modal').style.display = 'none'; document.getElementById('bottom-nav').style.display="flex"; switchView('home'); loadNotices(); }, 2000);
        });

        // --- BANNER LOGIC ---
        let sliderInterval;
        async function loadBanners() {
            const container = document.getElementById('home-banner-slider');
            const snap = await getDocs(query(collection(db, "banners"), orderBy("createdAt", "desc")));
            if(snap.empty) { container.innerHTML = "<div style='display:flex;justify-content:center;align-items:center;height:100%;color:#94a3b8'>‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</div>"; return; }
            container.innerHTML = "";
            let idx = 0;
            snap.forEach(d => {
                const b = d.data();
                container.innerHTML += `<a href="${b.link || '#'}" target="_blank"><img src="${b.image}" class="banner-slide ${idx===0?'active':''}" data-idx="${idx}"></a>`;
                idx++;
            });
            startSlider(idx);
        }
        function startSlider(count) {
            if(sliderInterval) clearInterval(sliderInterval);
            if(count <= 1) return;
            let current = 0;
            sliderInterval = setInterval(() => {
                const slides = document.querySelectorAll('.banner-slide');
                if(slides.length === 0) return;
                slides[current].classList.remove('active');
                current = (current + 1) % slides.length;
                slides[current].classList.add('active');
            }, 3500);
        }

        // --- ADMIN BANNER LOGIC ---
        document.getElementById('add-banner-btn').addEventListener('click', async () => {
            const img = document.getElementById('banner-img-url').value; const lnk = document.getElementById('banner-link-url').value;
            if(!img) return alert("‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶ø‡¶®");
            await addDoc(collection(db, "banners"), { image: img, link: lnk, createdAt: serverTimestamp() });
            alert("‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá"); document.getElementById('banner-img-url').value=""; loadAdminData();
        });

        // --- FEATURES ---
        window.loadDonors = async (f="All") => {
            const c=document.getElementById('donor-list-container'); c.innerHTML="‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            const s=await getDocs(query(collection(db,"blood_donors"),orderBy("createdAt","desc"))); c.innerHTML="";
            s.forEach(d=>{ const v=d.data(); if(f==="All"||v.bloodGroup===f) c.innerHTML+=`<div class="contact-card"><div><div style="font-weight:bold;color:#e53935">${v.bloodGroup}</div><div>${v.name}</div></div><a href="tel:${v.phone}" class="call-btn"><span class="material-icons-round">call</span></a></div>`});
        }
        document.getElementById('add-donor-btn').addEventListener('click',async()=>{
            const n=document.getElementById('donor-name').value; const g=document.getElementById('donor-group').value; const p=document.getElementById('donor-phone').value;
            if(!n||!g||!p)return; await addDoc(collection(db,"blood_donors"),{name:n,bloodGroup:g,phone:p,createdAt:serverTimestamp()}); alert("‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); loadDonors();
        });

        async function loadProfile() {
            if(!auth.currentUser) return;
            const d = await getDoc(doc(db, "users", auth.currentUser.uid));
            if(d.exists()) {
                const u = d.data();
                document.getElementById('profile-display-name').innerText = u.name || "‡¶®‡¶æ‡¶Æ ‡¶®‡ßá‡¶á";
                document.getElementById('profile-display-role').innerText = u.profession || "";
                document.getElementById('profile-display-email').innerText = u.email;
                document.getElementById('up-name').value = u.name || ""; document.getElementById('up-profession').value = u.profession || ""; document.getElementById('up-phone').value = u.phone || "";
            }
        }
        document.getElementById('update-profile-btn').addEventListener('click', async()=>{
            await updateDoc(doc(db,"users",auth.currentUser.uid),{ name:document.getElementById('up-name').value, profession:document.getElementById('up-profession').value, phone:document.getElementById('up-phone').value }); alert("‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); loadProfile();
        });

        // ADMIN LOADER
        document.getElementById('publish-btn').addEventListener('click', async()=>{
            const t=document.getElementById('notice-title').value; const d=document.getElementById('notice-desc').value;
            if(!t||!d)return; await addDoc(collection(db,"notices"),{title:t,description:d,createdAt:serverTimestamp()}); alert("‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); loadNotices(); loadAdminData();
        });
        async function loadNotices() {
            const c=document.getElementById('notice-container'); const s=await getDocs(query(collection(db,"notices"),orderBy("createdAt","desc")));
            c.innerHTML = s.empty ? "<p style='text-align:center'>‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶®‡ßá‡¶á</p>" : "";
            s.forEach(d=>{ const n=d.data(); c.innerHTML+=`<div class="notice-item"><h4>${n.title}</h4><p>${n.description}</p></div>`});
        }
        async function loadAdminData() {
            const us = await getDocs(collection(db, "users")); const ns = await getDocs(collection(db, "notices"));
            document.getElementById('total-users').innerText = us.size; document.getElementById('total-notices').innerText = ns.size;
            
            // Users
            const c=document.getElementById('admin-user-list'); c.innerHTML="";
            us.forEach(d=>{ const u=d.data(); const act = u.status==='banned' ? `<button onclick="window.tog('${d.id}','active')" class="btn-action btn-unban">Unban</button>` : `<button onclick="window.tog('${d.id}','banned')" class="btn-action btn-ban">Ban</button>`; c.innerHTML+=`<div class="user-manage-card"><div><div style="font-weight:600; font-size:0.9rem;">${u.email}</div></div><div>${u.role!=='admin'?act+`<button onclick="window.del('${d.id}')" class="btn-action btn-delete">Del</button>`:''}</div></div>` });

            // Banners
            const bSnap = await getDocs(collection(db, "banners"));
            const bList = document.getElementById('admin-banner-list'); bList.innerHTML = "";
            bSnap.forEach(d => {
                const b = d.data();
                bList.innerHTML += `<div class="admin-banner-item"><img src="${b.image}" class="admin-banner-thumb"> <button class="btn-action btn-delete" onclick="window.delBanner('${d.id}')">Delete</button></div>`;
            });
        }
        window.tog=async(id,st)=>{await updateDoc(doc(db,"users",id),{status:st}); loadAdminData();};
        window.del=async(id)=>{if(confirm('Delete?'))await deleteDoc(doc(db,"users",id)); loadAdminData();};
        window.delBanner=async(id)=>{if(confirm('Banner Delete?'))await deleteDoc(doc(db,"banners",id)); loadAdminData();};
    </script>
</body>
</html>
