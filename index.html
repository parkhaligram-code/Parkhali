<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        /* --- Modern CSS Styles --- */
        :root { --primary-blue: #1976d2; --primary-green: #2e7d32; --blood-red: #d32f2f; --emergency-orange: #ff9800; --agri-green: #7cb342; --accent-blue: #e3f2fd; --light-bg: #f0f4f7; --dark-text: #333; --light-text: #666; }
        body { font-family: 'Poppins', sans-serif; margin: 0; padding: 0; background-color: var(--light-bg); color: var(--dark-text); }
        .container { max-width: 480px; margin: 0 auto; background: var(--light-bg); min-height: 100vh; box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: relative; overflow-x: hidden; padding-bottom: 75px; }

        /* Header */
        header { background: linear-gradient(135deg, var(--primary-blue), var(--primary-green)); color: white; padding: 1.5rem 1.5rem 2.5rem; border-bottom-left-radius: 25px; border-bottom-right-radius: 25px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .header-top h1 { font-size: 1.5rem; font-weight: 600; margin: 0; }
        .logout-btn { background: rgba(255,255,255,0.2); color: white; border: none; padding: 6px 12px; cursor: pointer; border-radius: 20px; font-size: 0.9rem; display: none; align-items: center; gap: 5px; font-family: inherit; }
        .hero-section h2 { font-size: 1.8rem; margin: 0 0 0.5rem 0; }
        .hero-section p { font-size: 1rem; opacity: 0.9; margin: 0; }

        main { padding: 1.5rem; margin-top: -1.5rem; }
        .section-card { background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 1.5rem; }
        h3 { font-size: 1.2rem; color: var(--primary-blue); margin: 0 0 1rem 0; font-weight: 600; display: flex; align-items: center; gap: 8px;}

        /* Forms & Buttons */
        .form-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; box-sizing: border-box; background: #fafafa; }
        .form-input:focus { border-color: var(--primary-blue); outline: none; }
        .btn-primary { width: 100%; padding: 12px; background: linear-gradient(to right, var(--primary-blue), var(--primary-green)); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 1rem; margin-top: 10px; font-family: inherit; }
        .toggle-auth { text-align: center; margin-top: 15px; font-size: 0.9rem; color: var(--light-text); }
        .toggle-auth span { color: var(--primary-blue); font-weight: 600; cursor: pointer; }
        .msg { font-size: 0.85rem; margin-top: 10px; text-align: center; }
        .error { color: var(--blood-red); font-weight: bold; }
        .success { color: #388e3c; }

        /* Services Grid & Notices */
        .services-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
        .service-item { text-align: center; cursor: pointer; transition: transform 0.2s; }
        .service-icon { width: 55px; height: 55px; background: var(--accent-blue); color: var(--primary-blue); border-radius: 15px; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.5rem; font-size: 28px; }
        .service-icon.blood { background: #ffebee; color: var(--blood-red); }
        .service-icon.emergency { background: #fff3e0; color: var(--emergency-orange); }
        .service-icon.agri { background: #f1f8e9; color: var(--agri-green); }
        .service-label { font-size: 0.8rem; font-weight: 500; color: var(--dark-text); }
        
        .notice-item { background: #fff; padding: 1rem; border-radius: 10px; margin-bottom: 1rem; border: 1px solid #eee; border-left: 4px solid var(--primary-green); box-shadow: 0 1px 3px rgba(0,0,0,0.05);}
        .notice-item h4 { margin: 0 0 0.5rem; color: var(--primary-blue); font-size: 1.1rem;}
        .notice-item p { margin: 0 0 0.5rem; font-size: 0.9rem; color: #444; }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; max-width: 480px; margin: 0 auto; background: white; display: none; justify-content: space-around; padding: 0.5rem 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); border-top-left-radius: 20px; border-top-right-radius: 20px; z-index: 10; }
        .nav-item { color: var(--light-text); text-decoration: none; display: flex; flex-direction: column; align-items: center; font-size: 0.75rem; font-weight: 500; padding: 5px 10px; border-radius: 10px; cursor: pointer; transition: 0.2s;}
        .nav-item.active { color: var(--primary-blue); background: var(--accent-blue); }
        .nav-icon { font-size: 24px; margin-bottom: 2px; }

        /* Modals & Profile */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 100; display: none; justify-content: center; align-items: flex-end; }
        .modal-content { background: white; width: 100%; max-width: 480px; border-top-left-radius: 20px; border-top-right-radius: 20px; padding: 1.5rem; max-height: 85vh; overflow-y: auto; box-sizing: border-box; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;}
        .modal-header h3 { margin: 0; display: flex; align-items: center; gap: 8px; }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--light-text); }
        
        .contact-card { background: #fff; padding: 12px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .contact-info h5 { margin: 0 0 5px 0; font-size: 1rem; color: var(--dark-text); }
        .contact-info p { margin: 0; font-size: 0.85rem; color: var(--light-text); }
        .contact-badge { color: white; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: bold; font-size: 1.2rem; }
        .call-btn { background: #4caf50; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; text-decoration: none; box-shadow: 0 2px 5px rgba(76, 175, 80, 0.4);}
        
        .profile-avatar { width: 80px; height: 80px; background: var(--accent-blue); color: var(--primary-blue); font-size: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; margin: 0 auto 15px; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="header-top">
                <h1>‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</h1>
                <button id="logout-btn" class="logout-btn"><span class="material-icons-round" style="font-size: 16px;">logout</span> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
            <div class="hero-section" id="hero-text"><h2>‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2><p>‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶∏‡ßá‡¶¨‡¶æ‡¶Ø‡¶º ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡•§</p></div>
        </header>

        <main>
            <section id="auth-section" class="section-card">
                <h3 id="form-title" style="text-align: center; color: var(--dark-text); justify-content: center;">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <input type="email" id="email" class="form-input" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤" required>
                <input type="password" id="password" class="form-input" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°" required>
                <button id="auth-action-btn" class="btn-primary">‡¶≤‡¶ó‡¶á‡¶®</button>
                <p class="toggle-auth" id="toggle-auth">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? <span>‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span></p>
                <p id="auth-msg" class="msg"></p>
            </section>

            <div id="home-view" style="display: none;">
                <section class="section-card">
                    <h3>‡¶ú‡¶®‡¶™‡ßç‡¶∞‡¶ø‡ßü ‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
                    <div class="services-grid">
                        <div class="service-item" id="btn-blood-donor"><div class="service-icon blood"><span class="material-icons-round">bloodtype</span></div><div class="service-label">‡¶¨‡ßç‡¶≤‡¶æ‡¶° ‡¶°‡ßã‡¶®‡¶æ‡¶∞</div></div>
                        <div class="service-item" id="btn-emergency"><div class="service-icon emergency"><span class="material-icons-round">support_agent</span></div><div class="service-label">‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ</div></div>
                        <div class="service-item" id="btn-agriculture"><div class="service-icon agri"><span class="material-icons-round">agriculture</span></div><div class="service-label">‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶§‡¶•‡ßç‡¶Ø</div></div>
                    </div>
                </section>

                <section class="section-card">
                    <h3><span class="material-icons-round">campaign</span> ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¨‡ßã‡¶∞‡ßç‡¶°</h3>
                    <div id="notice-container"><p style="text-align: center; color: var(--light-text); font-size: 0.9rem;">‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p></div>
                </section>
            </div>

            <div id="profile-view" style="display: none;">
                <section class="section-card" style="text-align: center;">
                    <div class="profile-avatar"><span class="material-icons-round">person</span></div>
                    <h3 style="justify-content: center; margin-bottom: 5px;" id="profile-display-name">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h3>
                    <p style="color: var(--light-text); font-size: 0.9rem; margin-top: 0;" id="profile-display-email"></p>
                </section>

                <section class="section-card">
                    <h4 style="margin: 0 0 15px 0; color: var(--primary-blue);">‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                    <input type="text" id="profile-name" class="form-input" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ">
                    <input type="tel" id="profile-phone" class="form-input" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
                    <input type="text" id="profile-address" class="form-input" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶™‡¶æ‡ßú‡¶æ/‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
                    <button id="update-profile-btn" class="btn-primary">‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <p id="profile-msg" class="msg"></p>
                </section>
            </div>

            <div id="admin-view" style="display: none;">
                <section class="section-card" style="border: 2px solid var(--primary-blue); background: #f8fbff;">
                    <h3 style="color: var(--primary-blue);"><span class="material-icons-round">admin_panel_settings</span> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶∞‡ßÅ‡¶Æ</h3>
                    <div style="background: white; padding: 15px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0;">‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                        <input type="text" id="notice-title" class="form-input" placeholder="‡¶®‡ßã‡¶ü‡¶ø‡¶∂‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ">
                        <textarea id="notice-desc" class="form-input" rows="3" placeholder="‡¶®‡ßã‡¶ü‡¶ø‡¶∂‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§..."></textarea>
                        <button id="publish-btn" class="btn-primary" style="background: var(--primary-blue);">‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                </section>
            </div>
        </main>

        <nav class="bottom-nav" id="bottom-nav">
            <div class="nav-item active" id="nav-btn-home"><span class="material-icons-round nav-icon">home</span> ‡¶π‡ßã‡¶Æ</div>
            <div class="nav-item" id="nav-btn-admin" style="display: none;"><span class="material-icons-round nav-icon">admin_panel_settings</span> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</div>
            <div class="nav-item" id="nav-btn-profile"><span class="material-icons-round nav-icon">person</span> ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</div>
        </nav>

        <div id="blood-donor-modal" class="modal-overlay">...</div> 
        <div id="emergency-modal" class="modal-overlay">...</div>

        <div id="agriculture-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 style="color: var(--agri-green);"><span class="material-icons-round">agriculture</span> ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂</h3>
                    <button id="close-agri-modal" class="close-btn"><span class="material-icons-round">close</span></button>
                </div>
                
                <div style="background: #f1f8e9; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #c5e1a5;">
                    <h4 style="color: var(--primary-green); margin: 0 0 5px 0;">üåæ ‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡ßå‡¶∏‡ßÅ‡¶Æ‡ßá‡¶∞ ‡¶ü‡¶ø‡¶™‡¶∏</h4>
                    <p style="font-size: 0.9rem; margin: 0; color: #555;">‡¶è‡¶ñ‡¶® ‡¶¨‡ßã‡¶∞‡ßã ‡¶ß‡¶æ‡¶®‡ßá‡¶∞ ‡¶Æ‡ßå‡¶∏‡ßÅ‡¶Æ‡•§ ‡¶ú‡¶Æ‡¶ø‡¶§‡ßá ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶∏‡ßá‡¶ö ‡¶¶‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡ßã‡¶ï‡¶æ ‡¶¶‡¶Æ‡¶®‡ßá ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶ï‡ßÄ‡¶ü‡¶®‡¶æ‡¶∂‡¶ï ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                </div>

                <h4 style="color: var(--primary-blue); margin-bottom: 10px;">‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó</h4>
                <div class="contact-card">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="contact-badge" style="background: var(--agri-green);"><span class="material-icons-round">support_agent</span></div>
                        <div class="contact-info"><h5>‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶ï‡¶≤ ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</h5><p>‡¶ü‡ßã‡¶≤ ‡¶´‡ßç‡¶∞‡¶ø (‡¶∏‡¶∞‡¶ï‡¶æ‡¶∞‡¶ø)</p></div>
                    </div>
                    <a href="tel:16123" class="call-btn" style="background: var(--agri-green);"><span class="material-icons-round">call</span></a>
                </div>
                <div class="contact-card">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="contact-badge" style="background: var(--primary-green);"><span class="material-icons-round">person</span></div>
                        <div class="contact-info"><h5>‡¶â‡¶™-‡¶∏‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ï‡¶∞‡ßç‡¶§‡¶æ</h5><p>‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶¨‡ßç‡¶≤‡¶ï</p></div>
                    </div>
                    <a href="tel:01700000000" class="call-btn" style="background: var(--primary-green);"><span class="material-icons-round">call</span></a>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc, setDoc, updateDoc, deleteDoc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAuqcDRrtuQi2tdWXA2E_UWyq7pCrGpoy4",
            authDomain: "parkhali-village.firebaseapp.com",
            projectId: "parkhali-village"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // UI Elements
        const authSection = document.getElementById('auth-section');
        const homeView = document.getElementById('home-view');
        const adminView = document.getElementById('admin-view');
        const profileView = document.getElementById('profile-view');
        const bottomNav = document.getElementById('bottom-nav');
        
        const navBtnHome = document.getElementById('nav-btn-home');
        const navBtnAdmin = document.getElementById('nav-btn-admin');
        const navBtnProfile = document.getElementById('nav-btn-profile');
        
        const adminEmail = "admin@parkhali.com";

        // Navigation Switcher
        function switchView(viewName) {
            navBtnHome.classList.remove('active'); navBtnAdmin.classList.remove('active'); navBtnProfile.classList.remove('active');
            homeView.style.display = 'none'; adminView.style.display = 'none'; profileView.style.display = 'none';

            if(viewName === 'home') {
                homeView.style.display = 'block'; navBtnHome.classList.add('active');
                document.getElementById('hero-text').innerHTML = `<h2>‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã!</h2><p style="font-size:0.9rem;">${auth.currentUser ? auth.currentUser.email : ''}</p>`;
            } else if(viewName === 'admin') {
                adminView.style.display = 'block'; navBtnAdmin.classList.add('active');
                document.getElementById('hero-text').innerHTML = `<h2>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2><p style="font-size:0.9rem;">‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶∞‡ßÅ‡¶Æ</p>`;
            } else if(viewName === 'profile') {
                profileView.style.display = 'block'; navBtnProfile.classList.add('active');
                document.getElementById('hero-text').innerHTML = `<h2>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h2><p style="font-size:0.9rem;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶§‡¶•‡ßç‡¶Ø</p>`;
                loadProfileData(); // Fetch current data
            }
        }

        navBtnHome.addEventListener('click', () => switchView('home'));
        navBtnAdmin.addEventListener('click', () => switchView('admin'));
        navBtnProfile.addEventListener('click', () => switchView('profile'));

        // --- Profile Logic ---
        async function loadProfileData() {
            if(!auth.currentUser) return;
            document.getElementById('profile-display-email').innerText = auth.currentUser.email;
            const docRef = doc(db, "users", auth.currentUser.uid);
            const docSnap = await getDoc(docRef);
            
            if (docSnap.exists()) {
                const data = docSnap.data();
                document.getElementById('profile-name').value = data.name || "";
                document.getElementById('profile-phone').value = data.phone || "";
                document.getElementById('profile-address').value = data.address || "";
                if(data.name) document.getElementById('profile-display-name').innerText = data.name;
            }
        }

        document.getElementById('update-profile-btn').addEventListener('click', async () => {
            const name = document.getElementById('profile-name').value;
            const phone = document.getElementById('profile-phone').value;
            const address = document.getElementById('profile-address').value;
            const msg = document.getElementById('profile-msg');
            
            msg.className = "msg"; msg.style.color = "blue"; msg.innerText = "‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";

            try {
                await updateDoc(doc(db, "users", auth.currentUser.uid), {
                    name: name, phone: phone, address: address
                });
                msg.className = "msg success"; msg.innerText = "‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!";
                document.getElementById('profile-display-name').innerText = name;
            } catch (e) {
                msg.className = "msg error"; msg.innerText = "‡¶è‡¶∞‡¶∞: " + e.message;
            }
        });

        // Toggle Auth & Auth State Logic
        let isLogin = true;
        document.getElementById('toggle-auth').addEventListener('click', () => {
            isLogin = !isLogin;
            document.getElementById('form-title').innerText = isLogin ? "‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®" : "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
            document.getElementById('auth-action-btn').innerText = isLogin ? "‡¶≤‡¶ó‡¶á‡¶®" : "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞";
            document.getElementById('toggle-auth').innerHTML = isLogin ? '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? <span>‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span>' : '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? <span>‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span>';
        });

        document.getElementById('auth-action-btn').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            if(!email || !password) return;
            try {
                if(isLogin) { await signInWithEmailAndPassword(auth, email, password); } 
                else {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    await setDoc(doc(db, "users", userCredential.user.uid), { email: email, role: email === adminEmail ? "admin" : "user", status: "active" });
                }
            } catch(e) { alert("‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡ßü‡ßá‡¶õ‡ßá: " + e.message); }
        });

        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                authSection.style.display = "none";
                document.getElementById('logout-btn').style.display = "flex";
                bottomNav.style.display = "flex";
                navBtnAdmin.style.display = (user.email === adminEmail) ? "flex" : "none";
                switchView('home');
                loadNotices(); 
            } else {
                authSection.style.display = "block";
                homeView.style.display = "none"; adminView.style.display = "none"; profileView.style.display = "none";
                document.getElementById('logout-btn').style.display = "none";
                bottomNav.style.display = "none";
                document.getElementById('hero-text').innerHTML = `<h2>‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2><p>‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶∏‡ßá‡¶¨‡¶æ‡¶Ø‡¶º ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡•§</p>`;
            }
        });

        // Modals Logic (Agriculture)
        const agriModal = document.getElementById('agriculture-modal');
        document.getElementById('btn-agriculture').addEventListener('click', () => agriModal.style.display = 'flex');
        document.getElementById('close-agri-modal').addEventListener('click', () => agriModal.style.display = 'none');

        // Note: Notice board publish and load logic is exactly the same as previously implemented.
        document.getElementById('publish-btn').addEventListener('click', async () => {
            const title = document.getElementById('notice-title').value;
            const desc = document.getElementById('notice-desc').value;
            if(!title || !desc) return alert("‡¶∏‡¶¨ ‡¶ò‡¶∞ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");
            await addDoc(collection(db, "notices"), { title: title, description: desc, createdAt: serverTimestamp() });
            alert("‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); document.getElementById('notice-title').value = ""; document.getElementById('notice-desc').value = ""; loadNotices(); 
        });

        async function loadNotices() {
            const container = document.getElementById('notice-container');
            const querySnapshot = await getDocs(query(collection(db, "notices"), orderBy("createdAt", "desc")));
            container.innerHTML = ""; 
            if(querySnapshot.empty) { container.innerHTML = "<p>‡¶ï‡ßã‡¶®‡ßã ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶®‡ßá‡¶á‡•§</p>"; return; }
            querySnapshot.forEach((doc) => {
                const notice = doc.data();
                container.innerHTML += `<div class="notice-item"><h4>${notice.title}</h4><p>${notice.description}</p></div>`;
            });
        }
    </script>
</body>
</html>
