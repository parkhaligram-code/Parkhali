<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        /* ================== THEME VARIABLES ================== */
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --accent: #10b981;
            --danger: #ef4444;
            --warning: #f97316;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text-main: #0f172a;
            --text-sub: #64748b;
            --shadow: 0 4px 15px rgba(0,0,0,0.05);
            --header-grad: linear-gradient(135deg, #2563eb, #0891b2);
            --transition: all 0.3s ease;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Hind Siliguri', sans-serif; margin: 0; padding: 0; background: var(--bg); color: var(--text-main); padding-bottom: 90px; }
        .container { max-width: 480px; margin: 0 auto; min-height: 100vh; position: relative; background: var(--bg); box-shadow: 0 0 20px rgba(0,0,0,0.05); }

        /* ================== TOAST & LOADING ================== */
        #toast-message {
            position: fixed; bottom: 100px; left: 20px; right: 20px; max-width: 400px; margin: 0 auto;
            background: #1e293b; color: white; padding: 12px 20px; border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 1000; display: flex;
            align-items: center; gap: 10px; 
            transform: translateY(150px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            font-weight: 500; backdrop-filter: blur(10px);
        }
        #toast-message.show { 
            transform: translateY(0); 
            opacity: 1; 
            visibility: visible; 
        }
        .spinner-small { width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }

        /* ================== HEADER (updated user name style) ================== */
        header { background: var(--header-grad); color: white; padding: 1rem 1.2rem 1.8rem; border-bottom-left-radius: 25px; border-bottom-right-radius: 25px; position: relative; z-index: 10; transition: var(--transition); }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .app-title { font-size: 1.3rem; font-weight: 700; display: flex; align-items: center; gap: 5px; }
        .datetime-display {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            font-family: 'Poppins', 'Hind Siliguri', sans-serif;
            line-height: 1.3;
        }
        .time { font-size: 1.2rem; font-weight: 600; letter-spacing: 0.5px; }
        .date { font-size: 0.85rem; font-weight: 300; opacity: 0.9; }
        .hero-text { margin-top: 5px; }
        .hero-text h2 { margin: 0; font-size: 1.6rem; }
        .user-large {
            font-size: 1.8rem;
            font-weight: 700;
            margin-top: 4px;
            line-height: 1.2;
            word-break: break-word;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.15);
            padding: 8px 15px;
            border-radius: 40px;
            backdrop-filter: blur(5px);
            width: fit-content;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .user-large .material-icons-round { font-size: 2rem; }

        /* ================== MAIN & CARDS ================== */
        main { padding: 0 1rem; margin-top: -1.5rem; position: relative; z-index: 20; }
        .card { background: var(--card); padding: 1.2rem; border-radius: 20px; box-shadow: var(--shadow); margin-bottom: 1rem; transition: var(--transition); }
        .title-sec { font-size: 1.1rem; font-weight: 700; display: flex; align-items: center; gap: 5px; margin-bottom: 15px; color: var(--primary); }

        .input-box { width: 100%; padding: 14px 16px; margin-bottom: 12px; border: 1px solid #e2e8f0; border-radius: 14px; font-family: inherit; font-size: 0.95rem; background: #f8fafc; transition: var(--transition); }
        .input-box:focus { border-color: var(--primary); background: white; box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
        select.input-box { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; background-size: 16px; }

        .btn { width: 100%; padding: 14px; border: none; border-radius: 14px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: 0.2s; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(37,99,235,0.3); }
        .btn-success { background: var(--accent); color: white; box-shadow: 0 4px 10px rgba(16,185,129,0.3); }
        .btn-outline { background: white; color: var(--primary); border: 1px solid var(--primary); box-shadow: var(--shadow); }

        /* ================== FILE INPUT ================== */
        .file-upload-area {
            border: 2px dashed var(--primary); background: #f0f9ff; border-radius: 20px; padding: 20px;
            text-align: center; margin-bottom: 15px; cursor: pointer; transition: var(--transition);
            position: relative;
        }
        .file-upload-area:hover { background: #e0f2fe; }
        .file-upload-area input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
        .file-upload-area .material-icons-round { font-size: 40px; color: var(--primary); }
        .file-upload-area p { margin: 5px 0 0; color: var(--text-sub); }
        .image-preview { width: 100%; max-height: 150px; object-fit: cover; border-radius: 12px; margin-top: 8px; border: 1px solid #e2e8f0; }

        /* ================== BANNER SLIDER ================== */
        .banner-box { position: relative; width: 100%; padding-top: 43.75%; border-radius: 20px; overflow: hidden; background: #e2e8f0; margin-bottom: 15px; box-shadow: var(--shadow); }
        .banner-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 1s; }
        .banner-img.active { opacity: 1; }

        /* ================== GLANCE GRID ================== */
        .glance-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .glance-card { background: white; padding: 12px 5px; border-radius: 16px; text-align: center; box-shadow: var(--shadow); cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 6px; border: 1px solid #f1f5f9; transition: 0.2s; }
        .glance-card:active { transform: scale(0.95); }
        .glance-card .material-icons-round { font-size: 26px; padding: 10px; border-radius: 50%; margin-bottom: 2px; }
        .glance-title { font-size: 0.85rem; font-weight: 600; color: var(--text-main); }

        /* ================== LISTS & CARDS ================== */
        .list-item { background: white; padding: 15px; border-radius: 16px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #f1f5f9; cursor: pointer; transition: 0.2s; }
        .list-item:active { background: #f8fafc; }
        .avatar { width: 45px; height: 45px; background: #eff6ff; color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: bold; margin-right: 15px; overflow: hidden; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }
        .info h4 { margin: 0 0 3px; font-size: 1.05rem; }
        .info p { margin: 0; font-size: 0.85rem; color: var(--text-sub); }
        .call-btn { width: 40px; height: 40px; background: #dcfce7; color: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; }

        .place-thumb { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; margin-right: 10px; }

        .service-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .service-card { background: white; padding: 15px; text-align: center; border-radius: 20px; box-shadow: var(--shadow); cursor: pointer; transition: 0.2s; }
        .service-card:active { transform: scale(0.97); }
        .s-icon { width: 55px; height: 55px; margin: 0 auto 10px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 28px; }

        /* ================== GALLERY GRID ================== */
        .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
        .gallery-item { position: relative; aspect-ratio: 1/1; border-radius: 12px; overflow: hidden; box-shadow: var(--shadow); cursor: pointer; }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; }
        .gallery-download { position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.5); color: white; border-radius: 50%; padding: 4px; cursor: pointer; z-index: 2; }

        /* ================== SPORTS CARD ================== */
        .sports-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 10px; }
        .sports-card { background: white; border-radius: 20px; padding: 15px; box-shadow: var(--shadow); cursor: pointer; transition: 0.2s; }
        .sports-card:active { transform: scale(0.98); }
        .sports-card img { width: 100%; max-height: 180px; object-fit: cover; border-radius: 12px; margin-bottom: 10px; }
        .sports-card h3 { margin: 0 0 5px; font-size: 1.2rem; color: var(--primary); }
        .sports-card p { margin: 0; color: var(--text-sub); font-size: 0.9rem; }

        /* ================== BOTTOM NAV ================== */
        .bottom-nav { position: fixed; bottom: 15px; left: 15px; right: 15px; max-width: 450px; margin: 0 auto; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 8px 20px; border-radius: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); display: none; justify-content: space-between; align-items: center; z-index: 100; }
        .nav-btn { display: flex; flex-direction: column; align-items: center; color: #94a3b8; font-size: 0.75rem; font-weight: 600; cursor: pointer; flex: 1; transition: 0.2s; }
        .nav-btn.active { color: var(--primary); }
        .nav-center { width: 60px; height: 60px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-top: -35px; border: 4px solid white; box-shadow: 0 5px 15px rgba(37,99,235,0.4); transition: var(--transition); }

        /* ================== MODALS ================== */
        .modal-bg {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 200;
            display: none; align-items: center; justify-content: center;
        }
        .modal-content {
            background: white; width: 90%; max-width: 400px; padding: 20px;
            border-radius: 25px; max-height: 85vh; overflow-y: auto;
            transform: scale(0.8); opacity: 0;
            transition: transform 0.3s ease, opacity 0.2s ease;
        }
        .modal-bg.show .modal-content {
            transform: scale(1); opacity: 1;
        }
        .close-icon { float: right; background: #f1f5f9; border-radius: 50%; padding: 5px; cursor: pointer; color: #64748b; }

        /* ================== SPLASH ================== */
        #splash {
            position: fixed; inset: 0; background: var(--header-grad); z-index: 999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; transition: 0.5s;
        }
        .splash-text {
            font-size: 3rem;
            font-weight: 700;
            animation: bounceText 1.2s infinite alternate ease-in-out;
            letter-spacing: 2px;
            text-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        @keyframes bounceText {
            0% { transform: scale(1); letter-spacing: 2px; }
            100% { transform: scale(1.1); letter-spacing: 6px; }
        }
        .loader { border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-top: 20px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .success-box { position: fixed; inset: 0; background: white; z-index: 999; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .check-anim { width: 80px; height: 80px; background: var(--accent); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 40px; margin-bottom: 15px; animation: pop 0.5s; }
        @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        /* ================== PROFILE ================== */
        .profile-cover { background: linear-gradient(145deg, var(--primary), var(--primary-dark)); height: 120px; border-radius: 20px 20px 0 0; margin: -1.2rem -1.2rem 1rem -1.2rem; position: relative; }
        .profile-avatar-wrapper { position: relative; width: 110px; height: 110px; margin: -55px auto 10px; z-index: 10; }
        .profile-avatar { width: 100%; height: 100%; border-radius: 50%; overflow: hidden; background: white; border: 4px solid white; box-shadow: 0 4px 20px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; }
        .profile-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .profile-avatar .material-icons-round { font-size: 60px; color: var(--text-sub); background: #f1f5f9; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        .edit-avatar-btn { position: absolute; bottom: 5px; right: 5px; background: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 10px rgba(0,0,0,0.2); cursor: pointer; border: 2px solid white; color: var(--primary); }
        .profile-name { text-align: center; margin: 5px 0 0; }
        .profile-name h3 { font-size: 1.4rem; margin: 0; }
        .profile-name p { color: var(--text-sub); margin: 5px 0 0; }

        .info-grid { display: flex; gap: 15px; justify-content: center; margin: 15px 0; }
        .info-chip { background: #f8fafc; padding: 8px 16px; border-radius: 30px; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; color: var(--text-main); }
        .info-chip .material-icons-round { font-size: 18px; color: var(--primary); }

        /* ================== NOTICE CARD ================== */
        .notice-card { background: white; padding: 12px; border-left: 4px solid var(--primary); border-radius: 12px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); cursor: pointer; transition: 0.2s; }
        .notice-card:active { background: #f8fafc; }
        .notice-card h4 { margin: 0 0 5px; }
        .notice-card p { margin: 0 0 8px; font-size: 0.85rem; color: #64748b; }
        .notice-img { width: 100%; max-height: 150px; object-fit: cover; border-radius: 8px; margin-top: 8px; }

        /* ================== ADMIN CARDS ================== */
        .admin-stat { background: #1e293b; color: white; padding: 15px; border-radius: 16px; flex: 1; text-align: center; }
        .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .exampro-card {
            background: #1e293b; border-radius: 20px; padding: 22px 10px; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15); border-bottom: 3px solid #38bdf8;
            cursor: pointer; transition: 0.2s;
        }
        .exampro-card:active { transform: scale(0.95); }
        .exampro-card .material-icons-round { color: #38bdf8; font-size: 38px; margin-bottom: 10px; }
        .exampro-card span { color: #f8fafc; font-weight: 600; font-size: 1rem; }

        .admin-banner-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8fafc; border-radius: 10px; margin-bottom: 10px; }
        .admin-banner-img { height: 50px; width: 80px; object-fit: cover; border-radius: 6px; }
        .action-btn { padding: 6px 12px; border: none; border-radius: 30px; color: white; cursor: pointer; font-size: 0.8rem; }

        /* ================== THEME SELECTOR ================== */
        .theme-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .theme-item { height: 60px; border-radius: 12px; cursor: pointer; border: 2px solid transparent; transition: 0.2s; background-size: cover; }
        .theme-item.active { border-color: var(--primary); transform: scale(1.02); }

        /* ================== CONDITIONAL FIELDS ================== */
        .conditional-field { display: none; margin-top: 5px; }
    </style>
</head>
<body>

    <!-- Splash Screen with animated text -->
    <div id="splash">
        <span class="material-icons-round" style="font-size: 70px;">holiday_village</span>
        <div class="splash-text">‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ</div>
        <p style="margin:5px 0 10px;">‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶≠‡¶ø‡¶≤‡ßá‡¶ú ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™</p>
        <div class="loader"></div>
    </div>

    <!-- Success View -->
    <div id="success-view" class="success-box">
        <div class="check-anim"><span class="material-icons-round">check</span></div>
        <h2 style="color: var(--text-main); margin:0;">‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!</h2>
        <p style="color: var(--text-sub);">‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá</p>
    </div>

    <!-- Toast Message -->
    <div id="toast-message">
        <span class="material-icons-round" id="toast-icon">info</span>
        <span id="toast-text">Message</span>
    </div>

    <div class="container">
        <header>
            <div class="header-top">
                <div class="app-title"><span class="material-icons-round">widgets</span> ‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ</div>
                <div class="datetime-display">
                    <span class="time" id="current-time">--:--:--</span>
                    <span class="date" id="current-date">---, -- --- ----</span>
                </div>
            </div>
            <div class="hero-text">
                <h2 id="h-title">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2>
                <div class="user-large" id="user-large-name">
                    <span class="material-icons-round">emoji_people</span>
                    <span id="user-name-span"></span>
                </div>
            </div>
        </header>

        <main>
            <!-- AUTH VIEW -->
            <div id="view-auth" style="display: none; padding-top: 15px;">
                <div class="card" style="text-align: center;">
                    <h3 id="auth-head" style="color: var(--primary);">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    <input type="email" id="auth-email" class="input-box" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏">
                    <input type="password" id="auth-pass" class="input-box" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
                    <button id="auth-action" class="btn btn-primary">‡¶≤‡¶ó‡¶á‡¶®</button>
                    <p style="margin-top: 20px; font-size: 0.9rem;">
                        <span id="auth-hint">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á?</span> 
                        <b id="auth-toggle" style="color: var(--primary); cursor: pointer;">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</b>
                    </p>
                </div>
            </div>

            <!-- SETUP VIEW (updated with conditional fields) -->
            <div id="view-setup" style="display: none;">
                <div class="card">
                    <div class="title-sec">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®</div>
                    <p style="font-size: 0.85rem; color: var(--text-sub); margin-top:-10px; margin-bottom:15px">‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ‡ßü ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶§‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®</p>
                    <input id="set-name" class="input-box" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ">
                    
                    <!-- Profession dropdown -->
                    <select id="set-prof" class="input-box">
                        <option value="">‡¶™‡ßá‡¶∂‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                        <option value="‡¶õ‡¶æ‡¶§‡ßç‡¶∞">‡¶õ‡¶æ‡¶§‡ßç‡¶∞</option>
                        <option value="‡¶ï‡ßÉ‡¶∑‡¶ï">‡¶ï‡ßÉ‡¶∑‡¶ï</option>
                        <option value="‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡¶æ‡¶∞">‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡¶æ‡¶∞</option>
                        <option value="‡¶™‡ßç‡¶∞‡¶¨‡¶æ‡¶∏‡ßÄ">‡¶™‡ßç‡¶∞‡¶¨‡¶æ‡¶∏‡ßÄ</option>
                        <option value="‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡¶Ø‡¶º‡ßÄ">‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡¶Ø‡¶º‡ßÄ</option>
                        <option value="‡¶ö‡¶æ‡¶ï‡¶∞‡¶ø‡¶ú‡ßÄ‡¶¨‡ßÄ">‡¶ö‡¶æ‡¶ï‡¶∞‡¶ø‡¶ú‡ßÄ‡¶¨‡ßÄ</option>
                        <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
                    </select>

                    <!-- Conditional fields -->
                    <div id="field-driver" class="conditional-field">
                        <input id="set-vehicle" class="input-box" placeholder="‡¶ó‡¶æ‡ßú‡¶ø‡¶∞ ‡¶ß‡¶∞‡¶£ (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶Æ‡ßã‡¶ü‡¶∞‡¶∏‡¶æ‡¶á‡¶ï‡ßá‡¶≤, ‡¶ü‡ßç‡¶∞‡¶æ‡¶ï)">
                    </div>
                    <div id="field-probashi" class="conditional-field">
                        <input id="set-country" class="input-box" placeholder="‡¶ï‡ßã‡¶® ‡¶¶‡ßá‡¶∂‡ßá">
                    </div>
                    <div id="field-student" class="conditional-field">
                        <input id="set-institution" class="input-box" placeholder="‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
                    </div>

                    <select id="set-blood" class="input-box">
                        <option value="">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                        <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                        <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
                    </select>
                    <input type="tel" id="set-phone" class="input-box" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
                    <input id="set-addr" class="input-box" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶™‡¶æ‡ßú‡¶æ/‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
                    <div class="file-upload-area" id="setup-upload-area">
                        <input type="file" id="setup-photo" accept="image/*">
                        <span class="material-icons-round">add_photo_alternate</span>
                        <p>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</p>
                    </div>
                    <img id="setup-preview" class="image-preview" style="display:none;">
                    <button id="save-setup" class="btn btn-success">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® <span class="material-icons-round">check_circle</span></button>
                </div>
            </div>

            <!-- HOME VIEW -->
            <div id="view-home" style="display: none;">
                <div class="banner-box" id="banner-slider">
                    <div style="display:flex; justify-content:center; align-items:center; height:100%; color:#94a3b8">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
                </div>

                <div class="title-sec" style="margin-left: 5px; margin-top: 10px;">‡¶è‡¶ï ‡¶®‡¶ú‡¶∞‡ßá ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶ü‡¶ø</div>
                <div class="glance-grid">
                    <div class="glance-card" onclick="switchTab('mosque'); loadPlaces('mosques', 'mosque-list')">
                        <span class="material-icons-round" style="color:#0ea5e9; background:#e0f2fe">mosque</span>
                        <span class="glance-title">‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶</span>
                    </div>
                    <div class="glance-card" onclick="switchTab('school'); loadPlaces('schools', 'school-list')">
                        <span class="material-icons-round" style="color:#8b5cf6; background:#ede9fe">school</span>
                        <span class="glance-title">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡ßü</span>
                    </div>
                    <div class="glance-card" onclick="switchTab('shop'); loadPlaces('shops', 'shop-list')">
                        <span class="material-icons-round" style="color:#f59e0b; background:#fef3c7">storefront</span>
                        <span class="glance-title">‡¶¶‡ßã‡¶ï‡¶æ‡¶®</span>
                    </div>
                    <div class="glance-card" onclick="switchTab('villagers')">
                        <span class="material-icons-round" style="color:#10b981; background:#d1fae5">groups</span>
                        <span class="glance-title">‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ</span>
                    </div>
                    <div class="glance-card" onclick="switchTab('map')">
                        <span class="material-icons-round" style="color:#ef4444; background:#fee2e2">map</span>
                        <span class="glance-title">Map</span>
                    </div>
                    <div class="glance-card" onclick="switchTab('gallery'); loadGallery()">
                        <span class="material-icons-round" style="color:#db2777; background:#fae8ff">photo_library</span>
                        <span class="glance-title">‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø</span>
                    </div>
                </div>

                <button class="btn btn-outline" onclick="switchTab('sports')" style="margin-bottom: 15px;">
                    <span class="material-icons-round">sports_soccer</span> ‡¶ñ‡ßá‡¶≤‡¶æ‡¶ß‡ßÅ‡¶≤‡¶æ
                </button>

                <div class="card" style="padding: 15px 10px;">
                    <div class="title-sec" style="margin-left: 5px;"><span class="material-icons-round">campaign</span> ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¨‡ßã‡¶∞‡ßç‡¶°</div>
                    <div id="notice-list"><p style="text-align:center; color:#94a3b8">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p></div>
                </div>
            </div>

            <!-- MOSQUE VIEW -->
            <div id="view-mosque" style="display: none;">
                <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="switchTab('home')">arrow_back</span> ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶‡¶∏‡¶Æ‡ßÇ‡¶π</div>
                <div id="mosque-list"><p style="text-align:center; color:#94a3b8">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p></div>
            </div>

            <!-- SCHOOL VIEW -->
            <div id="view-school" style="display: none;">
                <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="switchTab('home')">arrow_back</span> ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®‡¶∏‡¶Æ‡ßÇ‡¶π</div>
                <div id="school-list"><p style="text-align:center; color:#94a3b8">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p></div>
            </div>

            <!-- SHOP VIEW -->
            <div id="view-shop" style="display: none;">
                <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="switchTab('home')">arrow_back</span> ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßÄ‡ßü ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞ ‡¶ì ‡¶¶‡ßã‡¶ï‡¶æ‡¶®</div>
                <div id="shop-list"><p style="text-align:center; color:#94a3b8">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p></div>
            </div>

            <!-- MAP VIEW -->
            <div id="view-map" style="display: none;">
                <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="switchTab('home')">arrow_back</span> ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™</div>
                <div style="width: 100%; height: 400px; background: #e2e8f0; border-radius: 12px; overflow: hidden; box-shadow: var(--shadow);">
                    <iframe id="map-iframe" src="" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            </div>

            <!-- SERVICES VIEW (added vehicle card) -->
            <div id="view-services" style="display: none;">
                <div class="title-sec" style="margin-bottom: 20px; font-size: 1.2rem;">‡¶ú‡¶®‡¶™‡ßç‡¶∞‡¶ø‡ßü ‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π</div>
                <div class="service-grid">
                    <div class="service-card" onclick="openModal('blood-modal'); loadDonors('All')">
                        <div class="s-icon" style="background:#fee2e2; color:var(--danger)"><span class="material-icons-round">bloodtype</span></div>
                        <b>‡¶¨‡ßç‡¶≤‡¶æ‡¶° ‡¶°‡ßã‡¶®‡¶æ‡¶∞</b>
                    </div>
                    <div class="service-card" onclick="openModal('emergency-modal'); loadEmergencyContacts()">
                        <div class="s-icon" style="background:#ffedd5; color:var(--warning)"><span class="material-icons-round">support_agent</span></div>
                        <b>‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ</b>
                    </div>
                    <div class="service-card" onclick="openModal('agri-modal'); loadLatestAgriPost()">
                        <div class="s-icon" style="background:#dcfce7; color:var(--accent)"><span class="material-icons-round">agriculture</span></div>
                        <b>‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶§‡¶•‡ßç‡¶Ø</b>
                    </div>
                    <div class="service-card" onclick="openModal('vehicle-modal'); loadDrivers()">
                        <div class="s-icon" style="background:#e0f2fe; color:#0284c7"><span class="material-icons-round">directions_car</span></div>
                        <b>‡¶Ø‡¶æ‡¶®‡¶¨‡¶æ‡¶π‡¶®</b>
                    </div>
                </div>
            </div>

            <!-- VILLAGERS VIEW -->
            <div id="view-villagers" style="display: none;">
                <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="switchTab('home')">arrow_back</span> ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</div>
                <div style="position: sticky; top: 0; background: var(--bg); padding-bottom: 10px; z-index: 30;">
                    <input type="text" id="search-villager" class="input-box" placeholder="üîç ‡¶®‡¶æ‡¶Æ, ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¨‡¶æ ‡¶™‡ßá‡¶∂‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." style="border-radius: 30px; margin: 0;">
                </div>
                <div id="villager-list">
                    <p style="text-align:center; color:#94a3b8">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>
            </div>

            <!-- PROFILE VIEW (updated with conditional fields) -->
            <div id="view-profile" style="display: none;">
                <div class="card" style="padding: 0; overflow: hidden;">
                    <div class="profile-cover"></div>
                    <div class="profile-avatar-wrapper">
                        <div class="profile-avatar" id="profile-avatar">
                            <img id="profile-avatar-img" src="" style="display:none;">
                            <span id="profile-avatar-icon" class="material-icons-round">person</span>
                        </div>
                        <div class="edit-avatar-btn" id="edit-avatar-btn">
                            <span class="material-icons-round">edit</span>
                        </div>
                    </div>
                    <div class="profile-name">
                        <h3 id="my-name">‡¶®‡¶æ‡¶Æ</h3>
                        <p id="my-role">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</p>
                    </div>
                    <div class="info-grid" id="profile-info-grid">
                        <!-- Dynamically filled -->
                    </div>
                    <div style="padding: 0 1.2rem 1.2rem;">
                        <button id="profile-logout" class="btn btn-outline" style="color:var(--danger); border-color:var(--danger);"><span class="material-icons-round">logout</span> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
                    </div>
                </div>
                <div class="card">
                    <div class="title-sec">‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</div>
                    <input id="up-name" class="input-box" placeholder="‡¶®‡¶æ‡¶Æ">
                    
                    <!-- Profession dropdown in profile -->
                    <select id="up-prof" class="input-box">
                        <option value="">‡¶™‡ßá‡¶∂‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                        <option value="‡¶õ‡¶æ‡¶§‡ßç‡¶∞">‡¶õ‡¶æ‡¶§‡ßç‡¶∞</option>
                        <option value="‡¶ï‡ßÉ‡¶∑‡¶ï">‡¶ï‡ßÉ‡¶∑‡¶ï</option>
                        <option value="‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡¶æ‡¶∞">‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡¶æ‡¶∞</option>
                        <option value="‡¶™‡ßç‡¶∞‡¶¨‡¶æ‡¶∏‡ßÄ">‡¶™‡ßç‡¶∞‡¶¨‡¶æ‡¶∏‡ßÄ</option>
                        <option value="‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡¶Ø‡¶º‡ßÄ">‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡¶Ø‡¶º‡ßÄ</option>
                        <option value="‡¶ö‡¶æ‡¶ï‡¶∞‡¶ø‡¶ú‡ßÄ‡¶¨‡ßÄ">‡¶ö‡¶æ‡¶ï‡¶∞‡¶ø‡¶ú‡ßÄ‡¶¨‡ßÄ</option>
                        <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
                    </select>

                    <div id="up-field-driver" class="conditional-field">
                        <input id="up-vehicle" class="input-box" placeholder="‡¶ó‡¶æ‡ßú‡¶ø‡¶∞ ‡¶ß‡¶∞‡¶£">
                    </div>
                    <div id="up-field-probashi" class="conditional-field">
                        <input id="up-country" class="input-box" placeholder="‡¶ï‡ßã‡¶® ‡¶¶‡ßá‡¶∂‡ßá">
                    </div>
                    <div id="up-field-student" class="conditional-field">
                        <input id="up-institution" class="input-box" placeholder="‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®">
                    </div>

                    <input id="up-phone" class="input-box" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤">
                    <select id="up-blood" class="input-box">
                        <option value="">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</option>
                        <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                        <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
                    </select>
                    <input id="up-addr" class="input-box" placeholder="‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ">
                    <input type="file" id="profile-photo" accept="image/*" style="display:none;">
                    <img id="profile-preview" class="image-preview" style="display:none;">
                    <button id="up-btn" class="btn btn-primary">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <!-- GALLERY VIEW -->
            <div id="view-gallery" style="display: none;">
                <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="switchTab('home')">arrow_back</span> ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø</div>
                <div id="gallery-grid" class="gallery-grid">
                    <p style="text-align:center; color:#94a3b8">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>
            </div>

            <!-- SPORTS VIEW -->
            <div id="view-sports" style="display: none;">
                <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="switchTab('home')">arrow_back</span> ‡¶ñ‡ßá‡¶≤‡¶æ‡¶ß‡ßÅ‡¶≤‡¶æ‡¶∞ ‡¶ñ‡¶¨‡¶∞</div>
                <div id="sports-list" class="sports-grid">
                    <p style="text-align:center; color:#94a3b8">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>
            </div>

            <!-- ADMIN VIEW (with new subsections) -->
            <div id="view-admin" style="display: none;">
                <!-- Admin Main Dashboard -->
                <div id="admin-main">
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <div class="admin-stat"><h2 id="st-user" style="margin:0">0</h2><small>Users</small></div>
                        <div class="admin-stat" style="background:var(--accent)"><h2 id="st-note" style="margin:0">0</h2><small>Notices</small></div>
                    </div>

                    <div class="admin-grid">
                        <div class="exampro-card" onclick="openAdminSub('places')">
                            <span class="material-icons-round">domain</span>
                            <span>‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®</span>
                        </div>
                        <div class="exampro-card" onclick="openAdminSub('users')">
                            <span class="material-icons-round">people</span>
                            <span>‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßç‡¶∏</span>
                        </div>
                        <div class="exampro-card" onclick="openAdminSub('notices')">
                            <span class="material-icons-round">campaign</span>
                            <span>‡¶®‡ßã‡¶ü‡¶ø‡¶∂</span>
                        </div>
                        <div class="exampro-card" onclick="openAdminSub('banners')">
                            <span class="material-icons-round">view_carousel</span>
                            <span>‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞</span>
                        </div>
                        <div class="exampro-card" onclick="openAdminSub('gallery')">
                            <span class="material-icons-round">photo_library</span>
                            <span>‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø</span>
                        </div>
                        <div class="exampro-card" onclick="openAdminSub('theme')">
                            <span class="material-icons-round">palette</span>
                            <span>‡¶•‡¶ø‡¶Æ</span>
                        </div>
                        <div class="exampro-card" onclick="openAdminSub('map')">
                            <span class="material-icons-round">map</span>
                            <span>‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡¶ø‡¶Ç‡¶ï</span>
                        </div>
                        <div class="exampro-card" onclick="openAdminSub('sports')">
                            <span class="material-icons-round">sports_volleyball</span>
                            <span>‡¶ñ‡ßá‡¶≤‡¶æ‡¶ß‡ßÅ‡¶≤‡¶æ</span>
                        </div>
                        <!-- NEW CARDS -->
                        <div class="exampro-card" onclick="openAdminSub('blood')">
                            <span class="material-icons-round">bloodtype</span>
                            <span>‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶§‡¶æ</span>
                        </div>
                        <div class="exampro-card" onclick="openAdminSub('emergency')">
                            <span class="material-icons-round">support_agent</span>
                            <span>‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ</span>
                        </div>
                        <div class="exampro-card" onclick="openAdminSub('agri')">
                            <span class="material-icons-round">agriculture</span>
                            <span>‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶§‡¶•‡ßç‡¶Ø</span>
                        </div>
                        <div class="exampro-card" onclick="openAdminSub('vehicles')">
                            <span class="material-icons-round">directions_car</span>
                            <span>‡¶Ø‡¶æ‡¶®‡¶¨‡¶æ‡¶π‡¶®</span>
                        </div>
                    </div>
                </div>

                <!-- Admin Sub: Places (unchanged) -->
                <div id="admin-sub-places" style="display:none;">
                    <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="closeAdminSub()">arrow_back</span> ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®/‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</div>
                    <div class="card">
                        <select id="ap-col" class="input-box">
                            <option value="mosques">‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶</option>
                            <option value="schools">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡ßü</option>
                            <option value="shops">‡¶¶‡ßã‡¶ï‡¶æ‡¶®</option>
                        </select>
                        <input id="ap-name" class="input-box" placeholder="‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
                        <textarea id="ap-desc" class="input-box" rows="2" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§/‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ"></textarea>
                        <div class="file-upload-area" id="ap-upload-area">
                            <input type="file" id="ap-image" accept="image/*">
                            <span class="material-icons-round">add_photo_alternate</span>
                            <p>‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</p>
                        </div>
                        <img id="ap-preview" class="image-preview" style="display:none;">
                        <button id="ap-btn" class="btn btn-primary" style="background:var(--accent)">‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        
                        <hr style="border:0; border-top:1px solid #e2e8f0; margin:15px 0">
                        <div class="title-sec" style="font-size:1rem">‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                        <select id="ad-view-col" class="input-box" onchange="loadAdminPlaces()">
                            <option value="mosques">‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</option>
                            <option value="schools">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡ßü ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</option>
                            <option value="shops">‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</option>
                        </select>
                        <div id="admin-places-list" style="max-height: 250px; overflow-y: auto;"></div>
                    </div>
                </div>

                <!-- Admin Sub: Users (enhanced with name, phone, profession) -->
                <div id="admin-sub-users" style="display:none;">
                    <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="closeAdminSub()">arrow_back</span> ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤</div>
                    <div class="card">
                        <input id="au-search" class="input-box" placeholder="‡¶®‡¶æ‡¶Æ, ‡¶´‡ßã‡¶®, ‡¶™‡ßá‡¶∂‡¶æ ‡¶¨‡¶æ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
                        <div id="admin-users" style="max-height: 400px; overflow-y: auto;"></div>
                    </div>
                </div>

                <!-- Admin Sub: Notices (unchanged) -->
                <div id="admin-sub-notices" style="display:none;">
                    <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="closeAdminSub()">arrow_back</span> ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    <div class="card">
                        <input id="an-title" class="input-box" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ">
                        <textarea id="an-desc" class="input-box" rows="2" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§"></textarea>
                        <div class="file-upload-area" id="an-upload-area">
                            <input type="file" id="an-image" accept="image/*">
                            <span class="material-icons-round">add_photo_alternate</span>
                            <p>‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</p>
                        </div>
                        <img id="an-preview" class="image-preview" style="display:none;">
                        <button id="an-btn" class="btn btn-primary">‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        
                        <hr style="border:0; border-top:1px solid #e2e8f0; margin:15px 0">
                        <div class="title-sec" style="font-size:1rem">‡¶∏‡¶ï‡¶≤ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂</div>
                        <div id="admin-notices-list" style="max-height: 250px; overflow-y: auto;"></div>
                    </div>
                </div>

                <!-- Admin Sub: Banners (unchanged) -->
                <div id="admin-sub-banners" style="display:none;">
                    <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="closeAdminSub()">arrow_back</span> ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    <div class="card">
                        <div class="file-upload-area" id="banner-upload-area">
                            <input type="file" id="banner-image" accept="image/*">
                            <span class="material-icons-round">add_photo_alternate</span>
                            <p>‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                        </div>
                        <img id="banner-preview" class="image-preview" style="display:none;">
                        <input id="ab-link" class="input-box" placeholder="‡¶≤‡¶ø‡¶ô‡ßç‡¶ï URL (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)">
                        <button id="ab-btn" class="btn btn-primary" style="background:#db2777">‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <div id="admin-banners" style="margin-top: 15px; max-height: 300px; overflow-y: auto;"></div>
                    </div>
                </div>

                <!-- Admin Sub: Gallery (unchanged) -->
                <div id="admin-sub-gallery" style="display:none;">
                    <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="closeAdminSub()">arrow_back</span> ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    <div class="card">
                        <div class="file-upload-area" id="gallery-upload-area">
                            <input type="file" id="gallery-upload" accept="image/*" multiple>
                            <span class="material-icons-round">add_photo_alternate</span>
                            <p>‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                        </div>
                        <button id="gallery-upload-btn" class="btn btn-primary" style="background:var(--accent); margin-top:10px;">‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <div id="admin-gallery-list" style="margin-top: 15px; max-height: 300px; overflow-y: auto;"></div>
                    </div>
                </div>

                <!-- Admin Sub: Theme (unchanged) -->
                <div id="admin-sub-theme" style="display:none;">
                    <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="closeAdminSub()">arrow_back</span> ‡¶•‡¶ø‡¶Æ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶á‡¶ú‡¶æ‡¶∞</div>
                    <div class="card">
                        <p style="color:var(--text-sub); margin-bottom:15px;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶õ‡¶®‡ßç‡¶¶‡ßá‡¶∞ ‡¶•‡¶ø‡¶Æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                        <div class="theme-grid" id="theme-grid"></div>
                        <button id="save-theme-btn" class="btn btn-success" style="margin-top:15px;">‡¶•‡¶ø‡¶Æ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                </div>

                <!-- Admin Sub: Map link (unchanged) -->
                <div id="admin-sub-map" style="display:none;">
                    <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="closeAdminSub()">arrow_back</span> ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</div>
                    <div class="card">
                        <p>‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶è‡¶Æ‡ßç‡¶¨‡ßá‡¶° URL ‡¶¶‡¶ø‡¶®</p>
                        <input id="map-link-input" class="input-box" placeholder="https://www.google.com/maps/embed?pb=...">
                        <button id="save-map-link" class="btn btn-primary">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <p class="hint" style="font-size:0.8rem; color:var(--text-sub); margin-top:8px;">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶≤‡¶ø‡¶Ç‡¶ï: <span id="current-map-link"></span></p>
                    </div>
                </div>

                <!-- Admin Sub: Sports (unchanged) -->
                <div id="admin-sub-sports" style="display:none;">
                    <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="closeAdminSub()">arrow_back</span> ‡¶ñ‡ßá‡¶≤‡¶æ‡¶ß‡ßÅ‡¶≤‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    <div class="card">
                        <input id="sports-title" class="input-box" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ">
                        <textarea id="sports-desc" class="input-box" rows="2" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§"></textarea>
                        <div class="file-upload-area" id="sports-upload-area">
                            <input type="file" id="sports-image" accept="image/*">
                            <span class="material-icons-round">add_photo_alternate</span>
                            <p>‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</p>
                        </div>
                        <img id="sports-preview" class="image-preview" style="display:none;">
                        <button id="sports-add-btn" class="btn btn-primary" style="background:var(--accent)">‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <hr style="border:0; border-top:1px solid #e2e8f0; margin:15px 0">
                        <div class="title-sec" style="font-size:1rem">‡¶∏‡¶ï‡¶≤ ‡¶™‡ßã‡¶∏‡ßç‡¶ü</div>
                        <div id="admin-sports-list" style="max-height: 250px; overflow-y: auto;"></div>
                    </div>
                </div>

                <!-- NEW Admin Sub: Blood Donors -->
                <div id="admin-sub-blood" style="display:none;">
                    <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="closeAdminSub()">arrow_back</span> ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶§‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    <div class="card">
                        <input id="blood-name" class="input-box" placeholder="‡¶®‡¶æ‡¶Æ">
                        <select id="blood-group" class="input-box">
                            <option value="">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</option>
                            <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                            <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
                        </select>
                        <input id="blood-phone" class="input-box" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
                        <button id="blood-add-btn" class="btn btn-success">‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <hr>
                        <div id="admin-blood-list" style="max-height: 300px; overflow-y: auto;"></div>
                    </div>
                </div>

                <!-- NEW Admin Sub: Emergency -->
                <div id="admin-sub-emergency" style="display:none;">
                    <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="closeAdminSub()">arrow_back</span> ‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    <div class="card">
                        <input id="emergency-name" class="input-box" placeholder="‡¶®‡¶æ‡¶Æ / ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó">
                        <input id="emergency-phone" class="input-box" placeholder="‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
                        <button id="emergency-add-btn" class="btn btn-success">‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <hr>
                        <div id="admin-emergency-list" style="max-height: 300px; overflow-y: auto;"></div>
                    </div>
                </div>

                <!-- NEW Admin Sub: Agri Info -->
                <div id="admin-sub-agri" style="display:none;">
                    <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="closeAdminSub()">arrow_back</span> ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶§‡¶•‡ßç‡¶Ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    <div class="card">
                        <textarea id="agri-content" class="input-box" rows="3" placeholder="‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"></textarea>
                        <div class="file-upload-area" id="agri-upload-area">
                            <input type="file" id="agri-image" accept="image/*">
                            <span class="material-icons-round">add_photo_alternate</span>
                            <p>‡¶õ‡¶¨‡¶ø (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</p>
                        </div>
                        <img id="agri-preview" class="image-preview" style="display:none;">
                        <button id="agri-add-btn" class="btn btn-success">‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <hr>
                        <div id="admin-agri-list" style="max-height: 300px; overflow-y: auto;"></div>
                    </div>
                </div>

                <!-- NEW Admin Sub: Vehicles (Drivers) -->
                <div id="admin-sub-vehicles" style="display:none;">
                    <div class="title-sec"><span class="material-icons-round" style="cursor:pointer; margin-right:5px" onclick="closeAdminSub()">arrow_back</span> ‡¶Ø‡¶æ‡¶®‡¶¨‡¶æ‡¶π‡¶® (‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡¶æ‡¶∞) ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    <div class="card">
                        <input id="driver-name" class="input-box" placeholder="‡¶®‡¶æ‡¶Æ">
                        <input id="driver-phone" class="input-box" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
                        <input id="driver-vehicle" class="input-box" placeholder="‡¶ó‡¶æ‡ßú‡¶ø‡¶∞ ‡¶ß‡¶∞‡¶£">
                        <div class="file-upload-area" id="driver-upload-area">
                            <input type="file" id="driver-photo" accept="image/*">
                            <span class="material-icons-round">add_photo_alternate</span>
                            <p>‡¶õ‡¶¨‡¶ø (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</p>
                        </div>
                        <img id="driver-preview" class="image-preview" style="display:none;">
                        <button id="driver-add-btn" class="btn btn-success">‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <hr>
                        <div id="admin-driver-list" style="max-height: 300px; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav" id="b-nav">
            <div class="nav-btn active" id="tab-home"><span class="material-icons-round" style="font-size:26px">home</span>‡¶π‡ßã‡¶Æ</div>
            <div class="nav-btn" id="tab-services"><div class="nav-center"><span class="material-icons-round" style="font-size:30px">grid_view</span></div></div>
            <div class="nav-btn" id="tab-admin" style="display: none;"><span class="material-icons-round" style="font-size:26px">admin_panel_settings</span>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</div>
            <div class="nav-btn" id="tab-profile"><span class="material-icons-round" style="font-size:26px">person</span>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</div>
        </nav>

        <!-- MODALS (all centered) -->

        <!-- User Detail Modal (unchanged) -->
        <div id="user-modal" class="modal-bg" onclick="if(event.target===this) closeModal('user-modal')">
            <div class="modal-content" style="text-align: center;">
                <span class="material-icons-round close-icon" onclick="closeModal('user-modal')">close</span>
                <div id="um-av" style="width:60px; height:60px; background:#eff6ff; color:var(--primary); border-radius:50%; font-size:28px; font-weight:bold; display:flex; align-items:center; justify-content:center; margin: 0 auto 10px; overflow:hidden;">
                    <img id="um-av-img" src="" style="width:100%; height:100%; object-fit:cover; display:none;">
                    <span id="um-av-text">A</span>
                </div>
                <h3 id="um-name" style="margin: 0;">Name</h3>
                <p id="um-role" style="color:var(--text-sub); margin: 5px 0 15px;">Role</p>
                <div style="background:#f8fafc; padding:15px; border-radius:12px; text-align:left; font-size:0.95rem;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px"><span>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤:</span><b id="um-phone">-</b></div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px"><span>‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™:</span><b id="um-blood" style="color:var(--danger)">-</b></div>
                    <div style="display:flex; justify-content:space-between"><span>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</span><b id="um-addr">-</b></div>
                </div>
                <a id="um-call" href="#" class="btn btn-success" style="margin-top: 15px; text-decoration: none;"><span class="material-icons-round">call</span> ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
            </div>
        </div>

        <!-- Place Detail Modal (unchanged) -->
        <div id="place-modal" class="modal-bg" onclick="if(event.target===this) closeModal('place-modal')">
            <div class="modal-content">
                <span class="material-icons-round close-icon" onclick="closeModal('place-modal')">close</span>
                <img id="place-modal-img" src="" style="width:100%; max-height:200px; object-fit:cover; border-radius:12px; margin-bottom:10px;">
                <h3 id="place-modal-name" style="margin:0 0 5px;"></h3>
                <p id="place-modal-desc" style="color:var(--text-sub);"></p>
            </div>
        </div>

        <!-- Blood Modal (unchanged) -->
        <div id="blood-modal" class="modal-bg" onclick="if(event.target===this) closeModal('blood-modal')">
            <div class="modal-content">
                <span class="material-icons-round close-icon" onclick="closeModal('blood-modal')">close</span>
                <h3 style="color:var(--danger); margin:0 0 15px;"><span class="material-icons-round" style="vertical-align:middle">bloodtype</span> ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶§‡¶æ</h3>
                <div style="background:#fef2f2; padding:12px; border-radius:12px; margin-bottom:15px;">
                    <input id="bd-name" class="input-box" placeholder="‡¶®‡¶æ‡¶Æ" style="margin-bottom:8px">
                    <select id="bd-grp" class="input-box" style="margin-bottom:8px"><option value="">‡¶ó‡ßç‡¶∞‡ßÅ‡¶™...</option><option>A+</option><option>B+</option><option>O+</option><option>AB+</option><option>A-</option><option>B-</option><option>O-</option><option>AB-</option></select>
                    <input id="bd-phone" type="tel" class="input-box" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤" style="margin-bottom:8px">
                    <button id="bd-add" class="btn btn-primary" style="background:var(--danger); padding:10px">‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
                <select id="bd-filter" class="input-box" onchange="loadDonors(this.value)"><option value="All">‡¶∏‡¶ï‡¶≤ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</option><option>A+</option><option>B+</option><option>O+</option><option>AB+</option><option>A-</option><option>B-</option><option>O-</option><option>AB-</option></select>
                <div id="bd-list" style="max-height: 250px; overflow-y:auto"></div>
            </div>
        </div>

        <!-- Emergency Modal (dynamic) -->
        <div id="emergency-modal" class="modal-bg" onclick="if(event.target===this) closeModal('emergency-modal')">
            <div class="modal-content">
                <span class="material-icons-round close-icon" onclick="closeModal('emergency-modal')">close</span>
                <h3 style="color:var(--warning); margin:0 0 15px;">‚òéÔ∏è ‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ</h3>
                <div id="emergency-list"></div>
            </div>
        </div>

        <!-- Agri Modal (dynamic) -->
        <div id="agri-modal" class="modal-bg" onclick="if(event.target===this) closeModal('agri-modal')">
            <div class="modal-content">
                <span class="material-icons-round close-icon" onclick="closeModal('agri-modal')">close</span>
                <h3 style="color:var(--accent); margin:0 0 15px;">üåæ ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶§‡¶•‡ßç‡¶Ø</h3>
                <div id="agri-content-display" style="background:#f0fdf4; color:#166534; padding:12px; border-radius:12px; margin-bottom:15px; font-size:0.9rem"></div>
                <img id="agri-image-display" style="width:100%; max-height:200px; object-fit:cover; border-radius:12px; display:none;">
                <div class="list-item"><div><h4 style="margin:0">‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶ï‡¶≤ ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</h4><small>16123</small></div><a href="tel:16123" class="call-btn"><span class="material-icons-round">call</span></a></div>
            </div>
        </div>

        <!-- Vehicle Modal (new) -->
        <div id="vehicle-modal" class="modal-bg" onclick="if(event.target===this) closeModal('vehicle-modal')">
            <div class="modal-content">
                <span class="material-icons-round close-icon" onclick="closeModal('vehicle-modal')">close</span>
                <h3 style="color:#0284c7; margin:0 0 15px;"><span class="material-icons-round">directions_car</span> ‡¶Ø‡¶æ‡¶®‡¶¨‡¶æ‡¶π‡¶® (‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡¶æ‡¶∞)</h3>
                <input type="text" id="search-driver" class="input-box" placeholder="üîç ‡¶®‡¶æ‡¶Æ, ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¨‡¶æ ‡¶ó‡¶æ‡ßú‡¶ø‡¶∞ ‡¶ß‡¶∞‡¶£" style="border-radius:30px; margin-bottom:15px;">
                <div id="driver-list" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
        </div>

        <!-- Image View Modal (unchanged) -->
        <div id="gallery-modal" class="modal-bg" onclick="if(event.target===this) closeModal('gallery-modal')">
            <div class="modal-content" style="text-align: center;">
                <span class="material-icons-round close-icon" onclick="closeModal('gallery-modal')">close</span>
                <h3 style="margin:0 0 10px; color:var(--text-main); text-align: left;">‡¶õ‡¶¨‡¶ø ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h3>
                <img id="gallery-modal-img" src="" style="width:100%; max-height:50vh; object-fit:contain; border-radius:12px; margin-bottom:15px; background: #f8fafc;">
                <a id="gallery-modal-download" href="#" class="btn btn-success" style="text-decoration: none; display: flex; justify-content: center; gap: 8px;">
                    <span class="material-icons-round">download</span> ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                </a>
            </div>
        </div>

        <!-- Notice Detail Modal (unchanged) -->
        <div id="notice-detail-modal" class="modal-bg" onclick="if(event.target===this) closeModal('notice-detail-modal')">
            <div class="modal-content" style="text-align: center;">
                <span class="material-icons-round close-icon" onclick="closeModal('notice-detail-modal')">close</span>
                <h3 id="notice-modal-title" style="margin:0 0 10px; color:var(--primary);"></h3>
                <img id="notice-modal-img" src="" style="width:100%; max-height:250px; object-fit:contain; border-radius:12px; margin-bottom:15px; background:#f8fafc; display:none;">
                <p id="notice-modal-desc" style="color:var(--text-main); font-size:1rem; text-align:left;"></p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc, setDoc, updateDoc, deleteDoc, query, orderBy, serverTimestamp, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // Firebase config
        const firebaseConfig = { apiKey: "AIzaSyAuqcDRrtuQi2tdWXA2E_UWyq7pCrGpoy4", authDomain: "parkhali-village.firebaseapp.com", projectId: "parkhali-village" };
        const app = initializeApp(firebaseConfig); const auth = getAuth(app); const db = getFirestore(app); const adminEmail = "admin@parkhali.com";

        // Cloudinary config
        const CLOUD_NAME = "dwnpdwnvc";
        const UPLOAD_PRESET = "parkhali";

        // ========== GLOBAL TOAST TIMEOUT ==========
        let toastTimeout;

        function showToast(message, icon = 'check_circle', duration = 3000) {
            const toast = document.getElementById('toast-message');
            document.getElementById('toast-icon').innerText = icon;
            document.getElementById('toast-text').innerText = message;
            toast.classList.add('show');
            if (toastTimeout) clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => toast.classList.remove('show'), duration);
        }

        function showLoading(btn) {
            const originalText = btn.innerText;
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-small"></span> ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç...';
            return () => {
                btn.disabled = false;
                btn.innerText = originalText;
            };
        }

        function showSuccessFull() {
            const s = document.getElementById('success-view');
            s.style.display = 'flex';
            setTimeout(() => s.style.display = 'none', 2000);
        }

        // ========== CLOUDINARY UPLOAD ==========
        async function uploadToCloudinary(file) {
            const formData = new FormData();
            formData.append("file", file);
            formData.append("upload_preset", UPLOAD_PRESET);
            const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, { method: "POST", body: formData });
            const data = await res.json();
            return data.secure_url;
        }

        // ========== MODAL CONTROLS ==========
        window.openModal = (id) => { const m=document.getElementById(id); m.style.display='flex'; setTimeout(()=>m.classList.add('show'), 10); }
        window.closeModal = (id) => { const m=document.getElementById(id); m.classList.remove('show'); setTimeout(()=>m.style.display='none', 300); }

        // ========== THEME MANAGEMENT ==========
        const themes = [
            { name: '‡¶®‡ßÄ‡¶≤', primary: '#2563eb', accent: '#10b981', grad: 'linear-gradient(135deg, #2563eb, #0891b2)' },
            { name: '‡¶∏‡¶¨‡ßÅ‡¶ú', primary: '#059669', accent: '#f59e0b', grad: 'linear-gradient(135deg, #059669, #10b981)' },
            { name: '‡¶≤‡¶æ‡¶≤', primary: '#dc2626', accent: '#f97316', grad: 'linear-gradient(135deg, #dc2626, #f97316)' },
            { name: '‡¶¨‡ßá‡¶ó‡ßÅ‡¶®‡¶ø', primary: '#7c3aed', accent: '#ec4899', grad: 'linear-gradient(135deg, #7c3aed, #ec4899)' },
            { name: '‡¶ï‡¶Æ‡¶≤‡¶æ', primary: '#ea580c', accent: '#eab308', grad: 'linear-gradient(135deg, #ea580c, #eab308)' },
            { name: '‡¶™‡¶ø‡¶Ç‡¶ï', primary: '#db2777', accent: '#7c3aed', grad: 'linear-gradient(135deg, #db2777, #7c3aed)' },
            { name: '‡¶≠‡¶æ‡¶∑‡¶æ ‡¶¶‡¶ø‡¶¨‡¶∏', primary: '#b45309', accent: '#f59e0b', grad: 'linear-gradient(135deg, #b45309, #fbbf24)' },
            { name: '‡¶∏‡ßç‡¶¨‡¶æ‡¶ß‡ßÄ‡¶®‡¶§‡¶æ ‡¶¶‡¶ø‡¶¨‡¶∏', primary: '#b91c1c', accent: '#16a34a', grad: 'linear-gradient(135deg, #b91c1c, #16a34a)' },
            { name: '‡¶¨‡¶ø‡¶ú‡ßü ‡¶¶‡¶ø‡¶¨‡¶∏', primary: '#1e3a8a', accent: '#059669', grad: 'linear-gradient(135deg, #1e3a8a, #059669)' },
            { name: '‡¶∞‡¶æ‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®', primary: '#2c3e50', accent: '#f1c40f', grad: 'linear-gradient(135deg, #2c3e50, #f1c40f)' },
            { name: '‡¶à‡¶¶', primary: '#16a34a', accent: '#fbbf24', grad: 'linear-gradient(135deg, #16a34a, #fbbf24)' },
            { name: '‡¶®‡¶ø‡¶â ‡¶á‡ßü‡¶æ‡¶∞', primary: '#6b21a8', accent: '#eab308', grad: 'linear-gradient(135deg, #6b21a8, #eab308)' },
            { name: '‡¶∂‡ßÄ‡¶§', primary: '#0f172a', accent: '#38bdf8', grad: 'linear-gradient(135deg, #0f172a, #38bdf8)' },
            { name: '‡¶ó‡ßç‡¶∞‡ßÄ‡¶∑‡ßç‡¶Æ', primary: '#c2410c', accent: '#fde047', grad: 'linear-gradient(135deg, #c2410c, #fde047)' },
            { name: '‡¶¨‡¶∞‡ßç‡¶∑‡¶æ', primary: '#0284c7', accent: '#22c55e', grad: 'linear-gradient(135deg, #0284c7, #22c55e)' }
        ];

        async function loadTheme() {
            const themeDoc = await getDoc(doc(db, "settings", "appearance"));
            if (themeDoc.exists()) {
                const t = themeDoc.data();
                applyTheme(t);
            } else {
                applyTheme(themes[0]);
            }
        }

        function applyTheme(theme) {
            document.documentElement.style.setProperty('--primary', theme.primary);
            document.documentElement.style.setProperty('--accent', theme.accent);
            document.documentElement.style.setProperty('--header-grad', theme.grad);
        }

        async function saveTheme(theme) {
            await setDoc(doc(db, "settings", "appearance"), theme);
            applyTheme(theme);
            showToast('‡¶•‡¶ø‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá', 'palette');
        }

        function renderThemeGrid() {
            const grid = document.getElementById('theme-grid');
            grid.innerHTML = '';
            themes.forEach((t, idx) => {
                const div = document.createElement('div');
                div.className = 'theme-item';
                div.style.background = t.grad;
                div.setAttribute('data-index', idx);
                div.onclick = () => {
                    document.querySelectorAll('.theme-item').forEach(el => el.classList.remove('active'));
                    div.classList.add('active');
                };
                grid.appendChild(div);
            });
            getDoc(doc(db, "settings", "appearance")).then(doc => {
                if (doc.exists()) {
                    const curr = doc.data();
                    const index = themes.findIndex(t => t.primary === curr.primary);
                    if (index !== -1) grid.children[index]?.classList.add('active');
                } else {
                    grid.children[0]?.classList.add('active');
                }
            });
        }

        document.getElementById('save-theme-btn')?.addEventListener('click', () => {
            const active = document.querySelector('.theme-item.active');
            if (!active) return;
            const idx = active.getAttribute('data-index');
            saveTheme(themes[idx]);
        });

        // ========== DATETIME DISPLAY ==========
        function updateDateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('bn-BD', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
            const dateStr = now.toLocaleDateString('bn-BD', options);
            document.getElementById('current-time').innerText = timeStr;
            document.getElementById('current-date').innerText = dateStr;
        }
        setInterval(updateDateTime, 1000);

        // ========== NAVIGATION & HISTORY ==========
        const tabs = { 
            home:'view-home', services:'view-services', villagers:'view-villagers', profile:'view-profile', 
            admin:'view-admin', auth:'view-auth', setup:'view-setup', mosque:'view-mosque', school:'view-school', 
            shop:'view-shop', map:'view-map', gallery:'view-gallery', sports:'view-sports'
        };
        const navBtns = { home:'tab-home', services:'tab-services', profile:'tab-profile', admin:'tab-admin' };
        let backCount = 0;
        let backTimer;

        let currentUserData = null;

        window.switchTab = (tabName, pushState = true) => {
            Object.values(tabs).forEach(id => document.getElementById(id).style.display = 'none');
            Object.values(navBtns).forEach(id => document.getElementById(id).classList.remove('active'));

            document.getElementById(tabs[tabName]).style.display = 'block';

            if(['villagers', 'mosque', 'school', 'shop', 'map', 'gallery', 'sports'].includes(tabName)) { 
                document.getElementById('tab-home').classList.add('active'); 
            } else if(navBtns[tabName]) { 
                document.getElementById(navBtns[tabName]).classList.add('active'); 
            }

            const hTitle = document.getElementById('h-title'); 
            const userLarge = document.getElementById('user-large-name');
            const userNameSpan = document.getElementById('user-name-span');

            if(tabName === 'home') { 
                hTitle.innerText="‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!"; 
                if (currentUserData && currentUserData.name) {
                    userNameSpan.innerText = currentUserData.name;
                } else if (auth.currentUser) {
                    userNameSpan.innerText = auth.currentUser.email.split('@')[0] || '';
                } else {
                    userNameSpan.innerText = '';
                }
                loadBanners(); 
                loadNotices(); 
            }
            else if(tabName === 'services') { 
                hTitle.innerText="‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π"; 
                userNameSpan.innerText = ''; 
            }
            else if(tabName === 'villagers') { 
                hTitle.innerText="‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ"; 
                userNameSpan.innerText = ''; 
                loadVillagers(); 
            }
            else if(tabName === 'profile') { 
                hTitle.innerText="‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤"; 
                userNameSpan.innerText = ''; 
                loadProfile(); 
            }
            else if(tabName === 'admin') { 
                hTitle.innerText="‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤"; 
                userNameSpan.innerText = ''; 
                window.closeAdminSub(); 
                loadAdminData(); 
            }
            else if(tabName === 'mosque') { 
                hTitle.innerText="‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶"; 
                userNameSpan.innerText = ''; 
            }
            else if(tabName === 'school') { 
                hTitle.innerText="‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡ßü"; 
                userNameSpan.innerText = ''; 
            }
            else if(tabName === 'shop') { 
                hTitle.innerText="‡¶¶‡ßã‡¶ï‡¶æ‡¶®"; 
                userNameSpan.innerText = ''; 
            }
            else if(tabName === 'map') { 
                hTitle.innerText="‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™"; 
                userNameSpan.innerText = ''; 
                loadMapLink(); 
            }
            else if(tabName === 'gallery') { 
                hTitle.innerText="‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø"; 
                userNameSpan.innerText = ''; 
                loadGallery(); 
            }
            else if(tabName === 'sports') { 
                hTitle.innerText="‡¶ñ‡ßá‡¶≤‡¶æ‡¶ß‡ßÅ‡¶≤‡¶æ"; 
                userNameSpan.innerText = ''; 
                loadSportsPosts(); 
            }

            if (pushState) {
                history.pushState({ tab: tabName }, '');
            }
        };

        // Handle back button
        window.addEventListener('popstate', (e) => {
            if (e.state && e.state.tab) {
                switchTab(e.state.tab, false);
            } else {
                const currentTab = Object.keys(tabs).find(key => document.getElementById(tabs[key]).style.display === 'block');
                if (currentTab === 'home') {
                    backCount++;
                    if (backCount === 1) {
                        showToast('‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ö‡¶æ‡¶™‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶ï‡¶∞‡¶§‡ßá', 'info', 2000);
                        backTimer = setTimeout(() => backCount = 0, 2000);
                    } else if (backCount >= 2) {
                        clearTimeout(backTimer);
                        backCount = 0;
                        if (navigator.app) {
                            navigator.app.exitApp();
                        } else {
                            window.close();
                        }
                    }
                } else {
                    switchTab('home', true);
                }
            }
        });

        history.replaceState({ tab: 'home' }, '');

        Object.keys(navBtns).forEach(k => document.getElementById(navBtns[k]).addEventListener('click', () => switchTab(k)));

        // ========== AUTH ==========
        onAuthStateChanged(auth, async (user) => {
            setTimeout(() => document.getElementById('splash').style.display = 'none', 1500);
            await loadTheme();
            if(user) {
                const uDoc = await getDoc(doc(db, "users", user.uid));
                if(uDoc.exists()) {
                    const data = uDoc.data();
                    currentUserData = data;
                    if(data.status === "banned" && user.email !== adminEmail) { signOut(auth); alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); return; }
                    
                    if(!data.name && user.email !== adminEmail) {
                        document.getElementById('b-nav').style.display = "none";
                        switchTab('setup');
                    } else {
                        document.getElementById('b-nav').style.display = "flex";
                        document.getElementById('tab-admin').style.display = (user.email === adminEmail) ? "flex" : "none";
                        switchTab('home');
                    }
                } else {
                    await setDoc(doc(db, "users", user.uid), { email:user.email, role:"user", status:"active" });
                    switchTab('setup');
                }
            } else {
                document.getElementById('b-nav').style.display = "none";
                switchTab('auth');
            }
        });

        let isLog = true;
        document.getElementById('auth-toggle').onclick = () => {
            isLog = !isLog;
            document.getElementById('auth-head').innerText = isLog ? "‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®" : "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü";
            document.getElementById('auth-action').innerText = isLog ? "‡¶≤‡¶ó‡¶á‡¶®" : "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞";
            document.getElementById('auth-hint').innerText = isLog ? "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á?" : "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá?";
            document.getElementById('auth-toggle').innerText = isLog ? "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®" : "‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
        };

        document.getElementById('auth-action').onclick = async () => {
            const e = document.getElementById('auth-email').value; const p = document.getElementById('auth-pass').value;
            if(!e || !p) return;
            try {
                if(isLog) await signInWithEmailAndPassword(auth, e, p);
                else {
                    const c = await createUserWithEmailAndPassword(auth, e, p);
                    await setDoc(doc(db, "users", c.user.uid), { email:e, role: e===adminEmail?"admin":"user", status:"active", createdAt:serverTimestamp() });
                }
            } catch(er) { alert("Error: " + er.message); }
        };

        document.getElementById('profile-logout').onclick = () => signOut(auth);

        // ========== CONDITIONAL FIELDS FOR SETUP ==========
        const profSelect = document.getElementById('set-prof');
        const driverField = document.getElementById('field-driver');
        const probashiField = document.getElementById('field-probashi');
        const studentField = document.getElementById('field-student');

        profSelect.addEventListener('change', () => {
            driverField.style.display = 'none';
            probashiField.style.display = 'none';
            studentField.style.display = 'none';
            const val = profSelect.value;
            if (val === '‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡¶æ‡¶∞') driverField.style.display = 'block';
            else if (val === '‡¶™‡ßç‡¶∞‡¶¨‡¶æ‡¶∏‡ßÄ') probashiField.style.display = 'block';
            else if (val === '‡¶õ‡¶æ‡¶§‡ßç‡¶∞') studentField.style.display = 'block';
        });

        // ========== SETUP ==========
        document.getElementById('setup-photo').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const preview = document.getElementById('setup-preview');
                    preview.src = event.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        async function syncDriverWithUser(userId, userData) {
            // If profession is driver, add/update in drivers collection
            if (userData.profession === '‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡¶æ‡¶∞') {
                const driverRef = doc(db, "drivers", userId); // use same UID as user
                await setDoc(driverRef, {
                    name: userData.name,
                    phone: userData.phone,
                    vehicleType: userData.vehicleType || '',
                    photoURL: userData.photoURL || '',
                    userId: userId,
                    updatedAt: serverTimestamp()
                });
            } else {
                // If not driver, remove from drivers collection
                try {
                    await deleteDoc(doc(db, "drivers", userId));
                } catch (e) { /* ignore if not exists */ }
            }
        }

        document.getElementById('save-setup').onclick = async () => {
            const n = document.getElementById('set-name').value; const a = document.getElementById('set-addr').value;
            if(!n || !a) return alert("‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶¶‡¶ø‡¶®!");
            
            let photoURL = "";
            const fileInput = document.getElementById('setup-photo');
            if (fileInput.files[0]) {
                const finish = showLoading(document.getElementById('save-setup'));
                try {
                    photoURL = await uploadToCloudinary(fileInput.files[0]);
                } catch (err) {
                    finish();
                    alert("‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá, ‡¶™‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                    return;
                }
                finish();
            }

            const userData = {
                name: n,
                profession: document.getElementById('set-prof').value,
                bloodGroup: document.getElementById('set-blood').value,
                phone: document.getElementById('set-phone').value,
                address: a,
                photoURL: photoURL,
                vehicleType: document.getElementById('set-vehicle')?.value || '',
                country: document.getElementById('set-country')?.value || '',
                institution: document.getElementById('set-institution')?.value || ''
            };

            await updateDoc(doc(db, "users", auth.currentUser.uid), userData);
            await syncDriverWithUser(auth.currentUser.uid, userData);
            showSuccessFull();
            setTimeout(() => { document.getElementById('b-nav').style.display='flex'; switchTab('home'); }, 2000);
        };

        // ========== BANNERS ==========
        document.getElementById('banner-image')?.addEventListener('change', function(e) {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    document.getElementById('banner-preview').src = event.target.result;
                    document.getElementById('banner-preview').style.display = 'block';
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        document.getElementById('ab-btn').onclick = async () => {
            const file = document.getElementById('banner-image').files[0];
            if (!file) return alert('‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
            const link = document.getElementById('ab-link').value;
            const finish = showLoading(document.getElementById('ab-btn'));
            try {
                const url = await uploadToCloudinary(file);
                await addDoc(collection(db, "banners"), { image: url, link: link, createdAt: serverTimestamp() });
                showToast('‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá', 'check_circle');
                document.getElementById('banner-image').value = '';
                document.getElementById('banner-preview').style.display = 'none';
                document.getElementById('ab-link').value = '';
                loadAdminData();
            } catch (err) {
                alert('‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•');
            } finally {
                finish();
            }
        };

        let sInt;
        async function loadBanners() {
            const b = document.getElementById('banner-slider');
            const d = await getDocs(query(collection(db, "banners"), orderBy("createdAt", "desc")));
            if(d.empty) { b.innerHTML = "<div style='display:flex;justify-content:center;align-items:center;height:100%;color:#94a3b8'>‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</div>"; return; }
            b.innerHTML = ""; let i=0;
            d.forEach(doc => { b.innerHTML += `<a href="${doc.data().link||'#'}"><img src="${doc.data().image}" class="banner-img ${i===0?'active':''}"></a>`; i++; });
            if(sInt) clearInterval(sInt);
            if(i>1) sInt = setInterval(()=>{
                const imgs = document.querySelectorAll('.banner-img'); let a=0;
                imgs.forEach((el,x)=>{if(el.classList.contains('active')){el.classList.remove('active');a=x;}});
                imgs[(a+1)%imgs.length].classList.add('active');
            }, 3500);
        }

        // ========== NOTICES ==========
        document.getElementById('an-image')?.addEventListener('change', function(e) {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    document.getElementById('an-preview').src = event.target.result;
                    document.getElementById('an-preview').style.display = 'block';
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        document.getElementById('an-btn').onclick = async () => { 
            const t = document.getElementById('an-title').value; 
            if(!t) return alert('‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®');
            let imageUrl = '';
            const file = document.getElementById('an-image').files[0];
            if (file) {
                const finish = showLoading(document.getElementById('an-btn'));
                try {
                    imageUrl = await uploadToCloudinary(file);
                } catch (err) {
                    finish();
                    alert('‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•');
                    return;
                }
                finish();
            }
            await addDoc(collection(db,"notices"), {
                title: t,
                description: document.getElementById('an-desc').value,
                imageUrl: imageUrl,
                createdAt: serverTimestamp()
            }); 
            document.getElementById('an-title').value = "";
            document.getElementById('an-desc').value = "";
            document.getElementById('an-image').value = "";
            document.getElementById('an-preview').style.display = 'none';
            showToast('‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶π‡ßü‡ßá‡¶õ‡ßá', 'campaign');
            loadAdminData(); 
        };

        function showNoticeDetail(notice) {
            document.getElementById('notice-modal-title').innerText = notice.title;
            document.getElementById('notice-modal-desc').innerText = notice.description || '';
            const imgEl = document.getElementById('notice-modal-img');
            if (notice.imageUrl) {
                imgEl.src = notice.imageUrl;
                imgEl.style.display = 'block';
            } else {
                imgEl.style.display = 'none';
            }
            openModal('notice-detail-modal');
        }

        async function loadNotices() {
            const n = document.getElementById('notice-list');
            const d = await getDocs(query(collection(db, "notices"), orderBy("createdAt", "desc")));
            n.innerHTML = d.empty ? "<p style='text-align:center;color:#94a3b8'>‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶®‡ßá‡¶á</p>" : "";
            d.forEach(doc => {
                const data = doc.data();
                const noticeDiv = document.createElement('div');
                noticeDiv.className = 'notice-card';
                noticeDiv.onclick = () => showNoticeDetail(data);
                noticeDiv.innerHTML = `
                    <h4>${data.title}</h4>
                    <p>${data.description || ''}</p>
                    ${data.imageUrl ? `<img src="${data.imageUrl}" class="notice-img">` : ''}
                `;
                n.appendChild(noticeDiv);
            });
        }

        // ========== PLACES ==========
        window.loadPlaces = async (collectionName, listId) => {
            const l = document.getElementById(listId);
            l.innerHTML = "<p style='text-align:center;color:#94a3b8'>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>";
            const d = await getDocs(query(collection(db, collectionName), orderBy("createdAt", "desc")));
            if(d.empty) { l.innerHTML = "<p style='text-align:center'>‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>"; return; }
            l.innerHTML = "";
            d.forEach(doc => {
                const data = doc.data();
                const imgHtml = data.imageUrl ? `<img src="${data.imageUrl}" class="place-thumb">` : '<div class="place-thumb" style="background:#f1f5f9; display:flex; align-items:center; justify-content:center;"><span class="material-icons-round" style="color:#94a3b8">place</span></div>';
                l.innerHTML += `
                <div class="list-item" onclick='showPlaceDetails(${JSON.stringify(data).replace(/'/g, "&apos;")})'>
                    <div style="display:flex; align-items:center;">
                        ${imgHtml}
                        <div>
                            <h4 style="margin:0 0 3px; color:var(--primary);">${data.name}</h4>
                            <p style="margin:0; font-size:0.8rem; color:var(--text-sub)">${data.desc || ''}</p>
                        </div>
                    </div>
                    <span class="material-icons-round" style="color:var(--text-sub)">chevron_right</span>
                </div>`;
            });
        };

        window.showPlaceDetails = (place) => {
            document.getElementById('place-modal-name').innerText = place.name;
            document.getElementById('place-modal-desc').innerText = place.desc || '‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶®‡ßá‡¶á';
            const imgEl = document.getElementById('place-modal-img');
            if (place.imageUrl) {
                imgEl.src = place.imageUrl;
                imgEl.style.display = 'block';
            } else {
                imgEl.style.display = 'none';
            }
            openModal('place-modal');
        };

        // ========== VILLAGERS ==========
        let cachedV = [];
        async function loadVillagers() {
            const l = document.getElementById('villager-list');
            if(cachedV.length === 0) {
                l.innerHTML = "<p style='text-align:center;color:#94a3b8'>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>";
                const d = await getDocs(collection(db, "users")); cachedV = [];
                d.forEach(doc => cachedV.push({ id: doc.id, ...doc.data() }));
            }
            renderV(cachedV);
        }
        function renderV(list) {
            const l = document.getElementById('villager-list'); l.innerHTML = "";
            const v = list.filter(u => u.name && u.status !== 'banned');
            if(v.length===0) { l.innerHTML = "<p style='text-align:center'>‡¶ï‡¶æ‡¶â‡¶ï‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>"; return; }
            v.forEach(u => {
                const sData = encodeURIComponent(JSON.stringify(u));
                const avatarHtml = u.photoURL ? `<img src="${u.photoURL}">` : u.name.charAt(0);
                l.innerHTML += `
                <div class="list-item" onclick="window.showU('${sData}')">
                    <div style="display:flex;align-items:center"><div class="avatar">${avatarHtml}</div><div class="info"><h4>${u.name}</h4><p>${u.profession||'‡¶™‡ßá‡¶∂‡¶æ ‡¶®‡ßá‡¶á'}</p></div></div>
                    <a href="tel:${u.phone}" class="call-btn" onclick="event.stopPropagation()"><span class="material-icons-round">call</span></a>
                </div>`;
            });
        }
        document.getElementById('search-villager').addEventListener('input', (e) => {
            const q = e.target.value.toLowerCase();
            renderV(cachedV.filter(u => u.name?.toLowerCase().includes(q) || u.phone?.includes(q) || u.profession?.toLowerCase().includes(q)));
        });
        window.showU = (d) => {
            const u = JSON.parse(decodeURIComponent(d));
            document.getElementById('um-av-text').innerText = u.name.charAt(0);
            const avImg = document.getElementById('um-av-img');
            if (u.photoURL) {
                avImg.src = u.photoURL;
                avImg.style.display = 'block';
                document.getElementById('um-av-text').style.display = 'none';
            } else {
                avImg.style.display = 'none';
                document.getElementById('um-av-text').style.display = 'block';
            }
            document.getElementById('um-name').innerText = u.name;
            document.getElementById('um-role').innerText = u.profession||'-';
            document.getElementById('um-phone').innerText = u.phone||'-';
            document.getElementById('um-blood').innerText = u.bloodGroup||'-';
            document.getElementById('um-addr').innerText = u.address||'-';
            document.getElementById('um-call').href = `tel:${u.phone}`;
            openModal('user-modal');
        };

        // ========== BLOOD DONORS (admin & user) ==========
        // User blood modal functions
        window.loadDonors = async (filter) => {
            const list = document.getElementById('bd-list');
            list.innerHTML = '‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            const q = query(collection(db, "blood_donors"), orderBy("createdAt", "desc"));
            const snaps = await getDocs(q);
            list.innerHTML = '';
            snaps.forEach(doc => {
                const d = doc.data();
                if (filter === 'All' || d.bloodGroup === filter) {
                    list.innerHTML += `
                        <div class="list-item">
                            <div><b style="color:var(--danger)">${d.bloodGroup}</b> ${d.name}</div>
                            <a href="tel:${d.phone}" class="call-btn"><span class="material-icons-round">call</span></a>
                        </div>`;
                }
            });
        };

        document.getElementById('bd-add').onclick = async () => {
            const name = document.getElementById('bd-name').value;
            const grp = document.getElementById('bd-grp').value;
            const phone = document.getElementById('bd-phone').value;
            if (!name || !grp || !phone) return;
            await addDoc(collection(db, "blood_donors"), { name, bloodGroup: grp, phone, createdAt: serverTimestamp() });
            showToast('‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶§‡¶æ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            document.getElementById('bd-name').value = '';
            document.getElementById('bd-grp').value = '';
            document.getElementById('bd-phone').value = '';
            loadDonors(document.getElementById('bd-filter').value);
        };

        // Admin blood management
        async function loadAdminBlood() {
            const list = document.getElementById('admin-blood-list');
            list.innerHTML = '‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            const snaps = await getDocs(query(collection(db, "blood_donors"), orderBy("createdAt", "desc")));
            list.innerHTML = '';
            snaps.forEach(doc => {
                const d = doc.data();
                list.innerHTML += `
                    <div class="admin-banner-item">
                        <div><b>${d.name}</b> (${d.bloodGroup}) ${d.phone}</div>
                        <div>
                            <button onclick="editBloodDonor('${doc.id}', '${d.name}', '${d.bloodGroup}', '${d.phone}')" class="action-btn" style="background:var(--warning); margin-right:5px;">‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                            <button onclick="deleteBloodDonor('${doc.id}')" class="action-btn" style="background:var(--danger)">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    </div>`;
            });
        }

        window.editBloodDonor = (id, name, group, phone) => {
            const newName = prompt('‡¶®‡¶æ‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:', name);
            if (!newName) return;
            const newGroup = prompt('‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:', group);
            if (!newGroup) return;
            const newPhone = prompt('‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:', phone);
            if (!newPhone) return;
            updateDoc(doc(db, "blood_donors", id), { name: newName, bloodGroup: newGroup, phone: newPhone });
            showToast('‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            loadAdminBlood();
        };

        window.deleteBloodDonor = async (id) => {
            if (confirm('‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶§‡¶æ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                await deleteDoc(doc(db, "blood_donors", id));
                showToast('‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
                loadAdminBlood();
            }
        };

        document.getElementById('blood-add-btn').onclick = async () => {
            const name = document.getElementById('blood-name').value;
            const group = document.getElementById('blood-group').value;
            const phone = document.getElementById('blood-phone').value;
            if (!name || !group || !phone) return alert('‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®');
            await addDoc(collection(db, "blood_donors"), { name, bloodGroup: group, phone, createdAt: serverTimestamp() });
            showToast('‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            document.getElementById('blood-name').value = '';
            document.getElementById('blood-group').value = '';
            document.getElementById('blood-phone').value = '';
            loadAdminBlood();
        };

        // ========== EMERGENCY CONTACTS ==========
        async function loadEmergencyContacts() {
            const list = document.getElementById('emergency-list');
            list.innerHTML = '‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            const snaps = await getDocs(query(collection(db, "emergency"), orderBy("createdAt", "desc")));
            list.innerHTML = '';
            snaps.forEach(doc => {
                const d = doc.data();
                list.innerHTML += `
                    <div class="list-item">
                        <div><h4 style="margin:0">${d.name}</h4><small>${d.phone}</small></div>
                        <a href="tel:${d.phone}" class="call-btn"><span class="material-icons-round">call</span></a>
                    </div>`;
            });
        }

        async function loadAdminEmergency() {
            const list = document.getElementById('admin-emergency-list');
            list.innerHTML = '‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            const snaps = await getDocs(query(collection(db, "emergency"), orderBy("createdAt", "desc")));
            list.innerHTML = '';
            snaps.forEach(doc => {
                const d = doc.data();
                list.innerHTML += `
                    <div class="admin-banner-item">
                        <div><b>${d.name}</b> ${d.phone}</div>
                        <button onclick="deleteEmergency('${doc.id}')" class="action-btn" style="background:var(--danger)">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                    </div>`;
            });
        }

        window.deleteEmergency = async (id) => {
            if (confirm('‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                await deleteDoc(doc(db, "emergency", id));
                showToast('‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
                loadAdminEmergency();
            }
        };

        document.getElementById('emergency-add-btn').onclick = async () => {
            const name = document.getElementById('emergency-name').value;
            const phone = document.getElementById('emergency-phone').value;
            if (!name || !phone) return alert('‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®');
            await addDoc(collection(db, "emergency"), { name, phone, createdAt: serverTimestamp() });
            showToast('‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            document.getElementById('emergency-name').value = '';
            document.getElementById('emergency-phone').value = '';
            loadAdminEmergency();
        };

        // ========== AGRI INFO ==========
        async function loadLatestAgriPost() {
            const contentDiv = document.getElementById('agri-content-display');
            const imgDiv = document.getElementById('agri-image-display');
            const snaps = await getDocs(query(collection(db, "agri_posts"), orderBy("createdAt", "desc")));
            if (!snaps.empty) {
                const latest = snaps.docs[0].data();
                contentDiv.innerText = latest.content || '';
                if (latest.imageUrl) {
                    imgDiv.src = latest.imageUrl;
                    imgDiv.style.display = 'block';
                } else {
                    imgDiv.style.display = 'none';
                }
            } else {
                contentDiv.innerText = '‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶®‡ßá‡¶á';
                imgDiv.style.display = 'none';
            }
        }

        async function loadAdminAgri() {
            const list = document.getElementById('admin-agri-list');
            list.innerHTML = '‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            const snaps = await getDocs(query(collection(db, "agri_posts"), orderBy("createdAt", "desc")));
            list.innerHTML = '';
            snaps.forEach(doc => {
                const d = doc.data();
                list.innerHTML += `
                    <div class="admin-banner-item">
                        <div><b>${d.content?.substring(0,30)}...</b></div>
                        <button onclick="deleteAgriPost('${doc.id}')" class="action-btn" style="background:var(--danger)">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                    </div>`;
            });
        }

        window.deleteAgriPost = async (id) => {
            if (confirm('‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                await deleteDoc(doc(db, "agri_posts", id));
                showToast('‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
                loadAdminAgri();
            }
        };

        document.getElementById('agri-add-btn').onclick = async () => {
            const content = document.getElementById('agri-content').value;
            if (!content) return alert('‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®');
            let imageUrl = '';
            const file = document.getElementById('agri-image').files[0];
            if (file) {
                const finish = showLoading(document.getElementById('agri-add-btn'));
                try {
                    imageUrl = await uploadToCloudinary(file);
                } catch (err) {
                    finish();
                    alert('‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•');
                    return;
                }
                finish();
            }
            await addDoc(collection(db, "agri_posts"), { content, imageUrl, createdAt: serverTimestamp() });
            showToast('‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            document.getElementById('agri-content').value = '';
            document.getElementById('agri-image').value = '';
            document.getElementById('agri-preview').style.display = 'none';
            loadAdminAgri();
        };

        document.getElementById('agri-image').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    document.getElementById('agri-preview').src = event.target.result;
                    document.getElementById('agri-preview').style.display = 'block';
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        // ========== VEHICLES (DRIVERS) ==========
        // User view
        async function loadDrivers() {
            const list = document.getElementById('driver-list');
            list.innerHTML = '‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            const snaps = await getDocs(query(collection(db, "drivers"), orderBy("name")));
            list.innerHTML = '';
            snaps.forEach(doc => {
                const d = doc.data();
                const avatarHtml = d.photoURL ? `<img src="${d.photoURL}" style="width:40px; height:40px; border-radius:50%; object-fit:cover; margin-right:10px;">` : '<div class="avatar" style="width:40px; height:40px; font-size:16px;">'+(d.name.charAt(0))+'</div>';
                list.innerHTML += `
                    <div class="list-item" style="cursor:default;">
                        <div style="display:flex; align-items:center;">
                            ${avatarHtml}
                            <div>
                                <h4 style="margin:0;">${d.name}</h4>
                                <p style="margin:0; font-size:0.8rem;">${d.vehicleType} | ${d.phone}</p>
                            </div>
                        </div>
                        <a href="tel:${d.phone}" class="call-btn"><span class="material-icons-round">call</span></a>
                    </div>`;
            });
        }

        document.getElementById('search-driver').addEventListener('input', (e) => {
            const q = e.target.value.toLowerCase();
            const items = document.querySelectorAll('#driver-list .list-item');
            items.forEach(item => {
                const text = item.innerText.toLowerCase();
                item.style.display = text.includes(q) ? 'flex' : 'none';
            });
        });

        // Admin drivers management
        async function loadAdminDrivers() {
            const list = document.getElementById('admin-driver-list');
            list.innerHTML = '‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            const snaps = await getDocs(query(collection(db, "drivers"), orderBy("name")));
            list.innerHTML = '';
            snaps.forEach(doc => {
                const d = doc.data();
                list.innerHTML += `
                    <div class="admin-banner-item">
                        <div><b>${d.name}</b> (${d.vehicleType}) ${d.phone}</div>
                        <div>
                            <button onclick="editDriver('${doc.id}', '${d.name}', '${d.phone}', '${d.vehicleType}')" class="action-btn" style="background:var(--warning); margin-right:5px;">‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                            <button onclick="deleteDriver('${doc.id}')" class="action-btn" style="background:var(--danger)">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    </div>`;
            });
        }

        window.editDriver = (id, name, phone, vehicle) => {
            const newName = prompt('‡¶®‡¶æ‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:', name);
            if (!newName) return;
            const newPhone = prompt('‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:', phone);
            if (!newPhone) return;
            const newVehicle = prompt('‡¶ó‡¶æ‡ßú‡¶ø‡¶∞ ‡¶ß‡¶∞‡¶£ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:', vehicle);
            if (!newVehicle) return;
            updateDoc(doc(db, "drivers", id), { name: newName, phone: newPhone, vehicleType: newVehicle });
            showToast('‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            loadAdminDrivers();
        };

        window.deleteDriver = async (id) => {
            if (confirm('‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                await deleteDoc(doc(db, "drivers", id));
                showToast('‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
                loadAdminDrivers();
            }
        };

        document.getElementById('driver-add-btn').onclick = async () => {
            const name = document.getElementById('driver-name').value;
            const phone = document.getElementById('driver-phone').value;
            const vehicle = document.getElementById('driver-vehicle').value;
            if (!name || !phone || !vehicle) return alert('‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®');
            let photoURL = '';
            const file = document.getElementById('driver-photo').files[0];
            if (file) {
                const finish = showLoading(document.getElementById('driver-add-btn'));
                try {
                    photoURL = await uploadToCloudinary(file);
                } catch (err) {
                    finish();
                    alert('‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•');
                    return;
                }
                finish();
            }
            await addDoc(collection(db, "drivers"), { name, phone, vehicleType: vehicle, photoURL, createdAt: serverTimestamp() });
            showToast('‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡¶æ‡¶∞ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            document.getElementById('driver-name').value = '';
            document.getElementById('driver-phone').value = '';
            document.getElementById('driver-vehicle').value = '';
            document.getElementById('driver-photo').value = '';
            document.getElementById('driver-preview').style.display = 'none';
            loadAdminDrivers();
        };

        document.getElementById('driver-photo').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    document.getElementById('driver-preview').src = event.target.result;
                    document.getElementById('driver-preview').style.display = 'block';
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        // ========== PROFILE ==========
        async function loadProfile() {
            if(!auth.currentUser) return;
            const d = await getDoc(doc(db,"users",auth.currentUser.uid));
            if(d.exists()) {
                const u = d.data();
                currentUserData = u;
                document.getElementById('my-name').innerText = u.name;
                document.getElementById('my-role').innerText = u.email;
                document.getElementById('up-name').value = u.name || '';
                document.getElementById('up-prof').value = u.profession || '';
                document.getElementById('up-phone').value = u.phone || '';
                document.getElementById('up-blood').value = u.bloodGroup || '';
                document.getElementById('up-addr').value = u.address || '';

                // Conditional fields
                document.getElementById('up-vehicle').value = u.vehicleType || '';
                document.getElementById('up-country').value = u.country || '';
                document.getElementById('up-institution').value = u.institution || '';

                // Show/hide conditional fields based on profession
                document.getElementById('up-field-driver').style.display = u.profession === '‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡¶æ‡¶∞' ? 'block' : 'none';
                document.getElementById('up-field-probashi').style.display = u.profession === '‡¶™‡ßç‡¶∞‡¶¨‡¶æ‡¶∏‡ßÄ' ? 'block' : 'none';
                document.getElementById('up-field-student').style.display = u.profession === '‡¶õ‡¶æ‡¶§‡ßç‡¶∞' ? 'block' : 'none';

                if (u.photoURL) {
                    document.getElementById('profile-avatar-img').src = u.photoURL;
                    document.getElementById('profile-avatar-img').style.display = 'block';
                    document.getElementById('profile-avatar-icon').style.display = 'none';
                } else {
                    document.getElementById('profile-avatar-img').style.display = 'none';
                    document.getElementById('profile-avatar-icon').style.display = 'block';
                }

                document.getElementById('profile-info-grid').innerHTML = `
                    <div class="info-chip"><span class="material-icons-round">phone</span> ${u.phone || '‡¶®‡ßá‡¶á'}</div>
                    <div class="info-chip"><span class="material-icons-round">bloodtype</span> ${u.bloodGroup || '‡¶®‡ßá‡¶á'}</div>
                    <div class="info-chip"><span class="material-icons-round">location_on</span> ${u.address || '‡¶®‡ßá‡¶á'}</div>
                `;
            }
        }

        document.getElementById('edit-avatar-btn').onclick = () => {
            document.getElementById('profile-photo').click();
        };
        document.getElementById('profile-photo').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    document.getElementById('profile-preview').src = event.target.result;
                    document.getElementById('profile-preview').style.display = 'block';
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        // Profile update conditional fields
        const upProf = document.getElementById('up-prof');
        upProf.addEventListener('change', () => {
            document.getElementById('up-field-driver').style.display = 'none';
            document.getElementById('up-field-probashi').style.display = 'none';
            document.getElementById('up-field-student').style.display = 'none';
            const val = upProf.value;
            if (val === '‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡¶æ‡¶∞') document.getElementById('up-field-driver').style.display = 'block';
            else if (val === '‡¶™‡ßç‡¶∞‡¶¨‡¶æ‡¶∏‡ßÄ') document.getElementById('up-field-probashi').style.display = 'block';
            else if (val === '‡¶õ‡¶æ‡¶§‡ßç‡¶∞') document.getElementById('up-field-student').style.display = 'block';
        });

        document.getElementById('up-btn').onclick = async () => {
            const updates = {
                name: document.getElementById('up-name').value,
                profession: document.getElementById('up-prof').value,
                phone: document.getElementById('up-phone').value,
                bloodGroup: document.getElementById('up-blood').value,
                address: document.getElementById('up-addr').value,
                vehicleType: document.getElementById('up-vehicle').value,
                country: document.getElementById('up-country').value,
                institution: document.getElementById('up-institution').value
            };
            const fileInput = document.getElementById('profile-photo');
            if (fileInput.files[0]) {
                const finish = showLoading(document.getElementById('up-btn'));
                try {
                    updates.photoURL = await uploadToCloudinary(fileInput.files[0]);
                } catch (err) {
                    finish();
                    alert("‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡ßü‡ßá‡¶õ‡ßá");
                    return;
                }
                finish();
            }
            await updateDoc(doc(db, "users", auth.currentUser.uid), updates);
            await syncDriverWithUser(auth.currentUser.uid, updates);
            showToast('‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            loadProfile();
            document.getElementById('profile-preview').style.display = 'none';
            fileInput.value = '';
        };

        // ========== GALLERY ==========
        window.viewGalleryImage = (url) => {
            document.getElementById('gallery-modal-img').src = url;
            let downloadUrl = url;
            if (url.includes('/upload/')) {
                downloadUrl = url.replace('/upload/', '/upload/fl_attachment/');
            }
            document.getElementById('gallery-modal-download').href = downloadUrl;
            openModal('gallery-modal');
        };

        async function loadGallery() {
            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = '<p style="text-align:center; color:#94a3b8">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';
            const snaps = await getDocs(query(collection(db, "gallery"), orderBy("createdAt", "desc")));
            if (snaps.empty) {
                grid.innerHTML = '<p style="text-align:center; color:#94a3b8">‡¶ï‡ßã‡¶®‡ßã ‡¶õ‡¶¨‡¶ø ‡¶®‡ßá‡¶á</p>';
                return;
            }
            grid.innerHTML = '';
            snaps.forEach(doc => {
                const imgUrl = doc.data().imageUrl;
                grid.innerHTML += `
                    <div class="gallery-item" onclick="viewGalleryImage('${imgUrl}')" style="cursor: pointer;">
                        <img src="${imgUrl}" loading="lazy">
                    </div>
                `;
            });
        }

        // ========== SPORTS ==========
        async function loadSportsPosts() {
            const listDiv = document.getElementById('sports-list');
            listDiv.innerHTML = '<p style="text-align:center; color:#94a3b8;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';
            const snaps = await getDocs(query(collection(db, "sports_posts"), orderBy("createdAt", "desc")));
            if (snaps.empty) {
                listDiv.innerHTML = '<p style="text-align:center; color:#94a3b8;">‡¶ï‡ßã‡¶®‡ßã ‡¶ñ‡¶¨‡¶∞ ‡¶®‡ßá‡¶á</p>';
                return;
            }
            listDiv.innerHTML = '';
            snaps.forEach(doc => {
                const data = doc.data();
                const card = document.createElement('div');
                card.className = 'sports-card';
                card.onclick = () => showNoticeDetail(data);
                let html = '';
                if (data.imageUrl) html += `<img src="${data.imageUrl}" loading="lazy">`;
                html += `<h3>${data.title}</h3>`;
                if (data.description) html += `<p>${data.description}</p>`;
                card.innerHTML = html;
                listDiv.appendChild(card);
            });
        }

        // ========== MAP LINK MANAGEMENT ==========
        async function loadMapLink() {
            const mapDoc = await getDoc(doc(db, "settings", "map"));
            let mapUrl = "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3690.697669145946!2d91.78287341535794!3d22.32712954756306!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x30acd8000676fef3%3A0x6d9f8df5b6d519ff!2sChittagong!5e0!3m2!1sen!2sbd!4v1708240000000!5m2!1sen!2sbd";
            if (mapDoc.exists()) {
                mapUrl = mapDoc.data().url || mapUrl;
            }
            document.getElementById('map-iframe').src = mapUrl;
            document.getElementById('current-map-link').innerText = mapUrl;
        }

        document.getElementById('save-map-link')?.addEventListener('click', async () => {
            const newUrl = document.getElementById('map-link-input').value;
            if (!newUrl) return alert('URL ‡¶¶‡¶ø‡¶®');
            await setDoc(doc(db, "settings", "map"), { url: newUrl });
            showToast('‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            loadMapLink();
            closeAdminSub();
        });

        // ========== ADMIN PANEL ==========
        window.openAdminSub = (id) => {
            document.getElementById('admin-main').style.display = 'none';
            document.getElementById('admin-sub-places').style.display = 'none';
            document.getElementById('admin-sub-users').style.display = 'none';
            document.getElementById('admin-sub-notices').style.display = 'none';
            document.getElementById('admin-sub-banners').style.display = 'none';
            document.getElementById('admin-sub-gallery').style.display = 'none';
            document.getElementById('admin-sub-theme').style.display = 'none';
            document.getElementById('admin-sub-map').style.display = 'none';
            document.getElementById('admin-sub-sports').style.display = 'none';
            document.getElementById('admin-sub-blood').style.display = 'none';
            document.getElementById('admin-sub-emergency').style.display = 'none';
            document.getElementById('admin-sub-agri').style.display = 'none';
            document.getElementById('admin-sub-vehicles').style.display = 'none';
            document.getElementById('admin-sub-' + id).style.display = 'block';
            if (id === 'gallery') loadAdminGallery();
            if (id === 'theme') renderThemeGrid();
            if (id === 'map') loadMapLink();
            if (id === 'sports') loadAdminSportsPosts();
            if (id === 'blood') loadAdminBlood();
            if (id === 'emergency') loadAdminEmergency();
            if (id === 'agri') loadAdminAgri();
            if (id === 'vehicles') loadAdminDrivers();
        };

        window.closeAdminSub = () => {
            document.getElementById('admin-main').style.display = 'block';
            document.getElementById('admin-sub-places').style.display = 'none';
            document.getElementById('admin-sub-users').style.display = 'none';
            document.getElementById('admin-sub-notices').style.display = 'none';
            document.getElementById('admin-sub-banners').style.display = 'none';
            document.getElementById('admin-sub-gallery').style.display = 'none';
            document.getElementById('admin-sub-theme').style.display = 'none';
            document.getElementById('admin-sub-map').style.display = 'none';
            document.getElementById('admin-sub-sports').style.display = 'none';
            document.getElementById('admin-sub-blood').style.display = 'none';
            document.getElementById('admin-sub-emergency').style.display = 'none';
            document.getElementById('admin-sub-agri').style.display = 'none';
            document.getElementById('admin-sub-vehicles').style.display = 'none';
        };

        async function loadAdminData() {
            // Users
            const us = await getDocs(collection(db,"users")); 
            const ns = await getDocs(query(collection(db,"notices"), orderBy("createdAt", "desc")));
            document.getElementById('st-user').innerText = us.size; 
            document.getElementById('st-note').innerText = ns.size;
            
            // Enhanced user list with name, phone, profession
            const ul = document.getElementById('admin-users'); ul.innerHTML="";
            us.forEach(d => {
                const u = d.data();
                if (!u.name) return; // skip incomplete
                const btn = u.status==='banned'?`<button onclick="window.actU('${d.id}','active')" class="action-btn" style="background:var(--accent)">Unban</button>`:`<button onclick="window.actU('${d.id}','banned')" class="action-btn" style="background:var(--warning)">Ban</button>`;
                ul.innerHTML += `
                    <div class="list-item" style="cursor:default; flex-wrap:wrap;">
                        <div style="flex:1;">
                            <b>${u.name}</b><br>
                            <small>${u.email} | ${u.phone || '‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶®‡ßá‡¶á'} | ${u.profession || '‡¶™‡ßá‡¶∂‡¶æ ‡¶®‡ßá‡¶á'}</small>
                        </div>
                        <div>${u.role!=='admin'?btn+` <button onclick="window.delU('${d.id}')" class="action-btn" style="background:var(--danger)">Del</button>`:''}</div>
                    </div>`;
            });

            // Banners
            const bl = document.getElementById('admin-banners'); bl.innerHTML="";
            const bs = await getDocs(collection(db,"banners"));
            bs.forEach(d => { bl.innerHTML+=`<div class="admin-banner-item"><img src="${d.data().image}" class="admin-banner-img"><button onclick="window.delB('${d.id}')" class="action-btn" style="background:var(--danger)">Delete</button></div>`; });

            // Notices list
            const nl = document.getElementById('admin-notices-list'); nl.innerHTML="";
            ns.forEach(d => {
                nl.innerHTML += `<div class="list-item" style="padding:10px; cursor:default; align-items:center;">
                    <div><b style="font-size:0.95rem">${d.data().title}</b></div>
                    <button onclick="window.delNotice('${d.id}')" class="action-btn" style="background:var(--danger)"><span class="material-icons-round" style="font-size:16px; vertical-align:middle;">delete</span></button>
                </div>`;
            });

            window.loadAdminPlaces();
        }

        // User search in admin
        document.getElementById('au-search').addEventListener('input', (e) => {
            const q = e.target.value.toLowerCase();
            document.querySelectorAll('#admin-users .list-item').forEach(el => {
                const text = el.innerText.toLowerCase();
                el.style.display = text.includes(q) ? 'flex' : 'none';
            });
        });

        window.actU = async (id, s) => { await updateDoc(doc(db,"users",id),{status:s}); loadAdminData(); showToast('‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü'); };
        window.delU = async (id) => { if(confirm('‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')){ await deleteDoc(doc(db,"users",id)); loadAdminData(); showToast('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü'); } };
        window.delB = async (id) => { if(confirm('‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')){ await deleteDoc(doc(db,"banners",id)); loadAdminData(); showToast('‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü'); } };
        window.delNotice = async (id) => { if(confirm('‡¶è‡¶á ‡¶®‡ßã‡¶ü‡¶ø‡¶∂‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')){ await deleteDoc(doc(db,"notices",id)); loadAdminData(); showToast('‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü'); } };

        // Admin Places
        document.getElementById('ap-image').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    document.getElementById('ap-preview').src = event.target.result;
                    document.getElementById('ap-preview').style.display = 'block';
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        document.getElementById('ap-btn').onclick = async () => {
            const col = document.getElementById('ap-col').value;
            const name = document.getElementById('ap-name').value;
            const desc = document.getElementById('ap-desc').value;
            if(!name) return alert("‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï!");
            
            let imageUrl = "";
            const fileInput = document.getElementById('ap-image');
            if (fileInput.files[0]) {
                const finish = showLoading(document.getElementById('ap-btn'));
                try {
                    imageUrl = await uploadToCloudinary(fileInput.files[0]);
                } catch (err) {
                    finish();
                    alert("‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•");
                    return;
                }
                finish();
            }

            await addDoc(collection(db, col), { name: name, desc: desc, imageUrl: imageUrl, createdAt: serverTimestamp() });
            document.getElementById('ap-name').value = ""; document.getElementById('ap-desc').value = "";
            document.getElementById('ap-image').value = "";
            document.getElementById('ap-preview').style.display = 'none';
            showToast('‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶® ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            document.getElementById('ad-view-col').value = col;
            loadAdminPlaces();
        };

        window.loadAdminPlaces = async () => {
            const col = document.getElementById('ad-view-col').value;
            const l = document.getElementById('admin-places-list');
            l.innerHTML = "<p style='text-align:center; color:#94a3b8; font-size:0.9rem;'>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>";
            const d = await getDocs(query(collection(db, col), orderBy("createdAt", "desc")));
            l.innerHTML = "";
            if(d.empty) { l.innerHTML = "<p style='text-align:center; color:#94a3b8; font-size:0.9rem;'>‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á</p>"; return; }
            d.forEach(doc => {
                l.innerHTML += `<div class="list-item" style="padding:10px; cursor:default;">
                    <div><b style="font-size:0.95rem">${doc.data().name}</b></div>
                    <button onclick="window.delPlace('${col}', '${doc.id}')" class="action-btn" style="background:var(--danger)">Delete</button>
                </div>`;
            });
        };

        window.delPlace = async (col, id) => {
            if(confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                await deleteDoc(doc(db, col, id));
                loadAdminPlaces();
                showToast('‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
            }
        };

        // Admin Sports
        document.getElementById('sports-image')?.addEventListener('change', function(e) {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    document.getElementById('sports-preview').src = event.target.result;
                    document.getElementById('sports-preview').style.display = 'block';
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        document.getElementById('sports-add-btn').onclick = async () => {
            const title = document.getElementById('sports-title').value;
            if (!title) return alert('‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®');
            let imageUrl = '';
            const file = document.getElementById('sports-image').files[0];
            if (file) {
                const finish = showLoading(document.getElementById('sports-add-btn'));
                try {
                    imageUrl = await uploadToCloudinary(file);
                } catch (err) {
                    finish();
                    alert('‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•');
                    return;
                }
                finish();
            }
            await addDoc(collection(db, "sports_posts"), {
                title: title,
                description: document.getElementById('sports-desc').value,
                imageUrl: imageUrl,
                createdAt: serverTimestamp()
            });
            document.getElementById('sports-title').value = '';
            document.getElementById('sports-desc').value = '';
            document.getElementById('sports-image').value = '';
            document.getElementById('sports-preview').style.display = 'none';
            showToast('‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂‡¶ø‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá', 'sports_soccer');
            loadAdminSportsPosts();
        };

        async function loadAdminSportsPosts() {
            const listDiv = document.getElementById('admin-sports-list');
            listDiv.innerHTML = '<p style="text-align:center; color:#94a3b8;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';
            const snaps = await getDocs(query(collection(db, "sports_posts"), orderBy("createdAt", "desc")));
            if (snaps.empty) {
                listDiv.innerHTML = '<p style="text-align:center; color:#94a3b8;">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á</p>';
                return;
            }
            listDiv.innerHTML = '';
            snaps.forEach(doc => {
                const data = doc.data();
                listDiv.innerHTML += `
                    <div class="admin-banner-item">
                        <div style="flex:1"><b>${data.title}</b></div>
                        <button onclick="window.delSportsPost('${doc.id}')" class="action-btn" style="background:var(--danger)">Delete</button>
                    </div>
                `;
            });
        }

        window.delSportsPost = async (id) => {
            if (confirm('‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                await deleteDoc(doc(db, "sports_posts", id));
                loadAdminSportsPosts();
                if (document.getElementById('view-sports').style.display === 'block') loadSportsPosts();
                showToast('‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü');
            }
        };

        // Admin Gallery
        async function loadAdminGallery() {
            const listDiv = document.getElementById('admin-gallery-list');
            listDiv.innerHTML = '<p style="text-align:center; color:#94a3b8;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';
            const snaps = await getDocs(query(collection(db, "gallery"), orderBy("createdAt", "desc")));
            if (snaps.empty) {
                listDiv.innerHTML = '<p style="text-align:center; color:#94a3b8;">‡¶ï‡ßã‡¶®‡ßã ‡¶õ‡¶¨‡¶ø ‡¶®‡ßá‡¶á</p>';
                return;
            }
            listDiv.innerHTML = '';
            snaps.forEach(doc => {
                const imgUrl = doc.data().imageUrl;
                listDiv.innerHTML += `
                    <div class="admin-banner-item">
                        <img src="${imgUrl}" class="admin-banner-img">
                        <button onclick="window.delGalleryImage('${doc.id}')" class="action-btn" style="background:var(--danger)">Delete</button>
                    </div>
                `;
            });
        }

        window.delGalleryImage = async (id) => {
            if (confirm('‡¶õ‡¶¨‡¶ø‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                await deleteDoc(doc(db, "gallery", id));
                loadAdminGallery();
                if (document.getElementById('view-gallery').style.display === 'block') loadGallery();
                showToast('‡¶õ‡¶¨‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü');
            }
        };

        document.getElementById('gallery-upload-btn').onclick = async () => {
            const files = document.getElementById('gallery-upload').files;
            if (files.length === 0) return alert('‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
            const finish = showLoading(document.getElementById('gallery-upload-btn'));
            let successCount = 0;
            for (let file of files) {
                try {
                    const url = await uploadToCloudinary(file);
                    await addDoc(collection(db, "gallery"), { imageUrl: url, createdAt: serverTimestamp() });
                    successCount++;
                } catch (err) {
                    console.error(err);
                }
            }
            finish();
            showToast(`${successCount} ‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡ßü‡ßá‡¶õ‡ßá`);
            document.getElementById('gallery-upload').value = '';
            loadAdminGallery();
            if (document.getElementById('view-gallery').style.display === 'block') loadGallery();
        };

        // ========== INIT ==========
        updateDateTime();
    </script>
</body>
    </html>
