<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <style>
        /* ================== THEME & VARIABLES ================== */
        :root { 
            --primary: #2563eb; --primary-dark: #1e40af; --accent: #10b981; 
            --danger: #ef4444; --warning: #f97316; --bg: #f1f5f9; 
            --card: #ffffff; --text-main: #0f172a; --text-sub: #64748b;
            --shadow: 0 4px 15px rgba(0,0,0,0.05);
            --header-grad: linear-gradient(135deg, #2563eb, #0891b2);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Hind Siliguri', sans-serif; margin: 0; padding: 0; background: var(--bg); color: var(--text-main); padding-bottom: 90px; }
        .container { max-width: 480px; margin: 0 auto; min-height: 100vh; position: relative; background: var(--bg); box-shadow: 0 0 20px rgba(0,0,0,0.05); }

        /* ================== COMPONENTS ================== */
        header { background: var(--header-grad); color: white; padding: 1.5rem 1.2rem 2.5rem; border-bottom-left-radius: 25px; border-bottom-right-radius: 25px; position: relative; z-index: 10; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .app-title { font-size: 1.3rem; font-weight: 700; display: flex; align-items: center; gap: 5px; }
        .logout-btn { background: rgba(255,255,255,0.2); border: none; color: white; padding: 6px 15px; border-radius: 20px; font-weight: 600; display: none; align-items: center; gap: 5px; cursor: pointer; }
        .hero-text h2 { margin: 0; font-size: 1.6rem; }
        .hero-text p { margin: 0; font-size: 0.9rem; opacity: 0.9; }

        main { padding: 0 1rem; margin-top: -1.5rem; position: relative; z-index: 20; }
        .card { background: var(--card); padding: 1.2rem; border-radius: 16px; box-shadow: var(--shadow); margin-bottom: 1rem; }
        .title-sec { font-size: 1.1rem; font-weight: 700; display: flex; align-items: center; gap: 5px; margin-bottom: 15px; color: var(--primary); }

        .input-box { width: 100%; padding: 12px 15px; margin-bottom: 12px; border: 1px solid #e2e8f0; border-radius: 10px; font-family: inherit; font-size: 0.95rem; background: #f8fafc; }
        .input-box:focus { border-color: var(--primary); background: white; }
        
        .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: 0.2s; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(37,99,235,0.3); }
        .btn-success { background: var(--accent); color: white; box-shadow: 0 4px 10px rgba(16,185,129,0.3); }
        .btn-outline { background: white; color: var(--primary); border: 1px solid var(--primary); box-shadow: var(--shadow); }

        /* ================== 16:7 BANNER ================== */
        .banner-box { position: relative; width: 100%; padding-top: 43.75%; border-radius: 16px; overflow: hidden; background: #e2e8f0; margin-bottom: 15px; box-shadow: var(--shadow); }
        .banner-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: 0.5s; }
        .banner-img.active { opacity: 1; }

        /* ================== AT A GLANCE (NEW) ================== */
        .glance-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(75px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .glance-card { background: white; border-radius: 12px; padding: 12px 5px; text-align: center; box-shadow: var(--shadow); cursor: pointer; transition: 0.2s; border: 1px solid #f1f5f9; }
        .glance-card:active { transform: scale(0.95); }
        .glance-icon { width: 42px; height: 42px; margin: 0 auto 8px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; color: white; }
        .ic-mosque { background: #10b981; box-shadow: 0 4px 10px rgba(16,185,129,0.3); }
        .ic-school { background: #3b82f6; box-shadow: 0 4px 10px rgba(59,130,246,0.3); }
        .ic-shop { background: #f59e0b; box-shadow: 0 4px 10px rgba(245,158,11,0.3); }
        .ic-villager { background: #8b5cf6; box-shadow: 0 4px 10px rgba(139,92,246,0.3); }
        .ic-map { background: #ef4444; box-shadow: 0 4px 10px rgba(239,68,68,0.3); }
        .map-container iframe { width: 100%; height: 350px; border: none; border-radius: 12px; background: #f8fafc; }

        /* ================== LISTS & CARDS ================== */
        .list-item { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #f1f5f9; cursor: pointer; }
        .avatar { width: 45px; height: 45px; background: #eff6ff; color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: bold; margin-right: 15px; }
        .info h4 { margin: 0 0 3px; font-size: 1.05rem; }
        .info p { margin: 0; font-size: 0.85rem; color: var(--text-sub); }
        .call-btn { width: 40px; height: 40px; background: #dcfce7; color: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; }

        .service-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .service-card { background: white; padding: 15px; text-align: center; border-radius: 16px; box-shadow: var(--shadow); cursor: pointer; }
        .s-icon { width: 55px; height: 55px; margin: 0 auto 10px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 28px; }

        /* ================== BOTTOM NAV ================== */
        .bottom-nav { position: fixed; bottom: 15px; left: 15px; right: 15px; max-width: 450px; margin: 0 auto; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 8px 20px; border-radius: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); display: none; justify-content: space-between; align-items: center; z-index: 100; }
        .nav-btn { display: flex; flex-direction: column; align-items: center; color: #94a3b8; font-size: 0.75rem; font-weight: 600; cursor: pointer; flex: 1; }
        .nav-btn.active { color: var(--primary); }
        .nav-center { width: 60px; height: 60px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-top: -35px; border: 4px solid white; box-shadow: 0 5px 15px rgba(37,99,235,0.4); }

        /* ================== MODALS & ANIMATIONS ================== */
        .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 200; display: none; align-items: flex-end; justify-content: center; }
        .modal-content { background: white; width: 100%; max-width: 480px; padding: 20px; border-top-left-radius: 25px; border-top-right-radius: 25px; max-height: 85vh; overflow-y: auto; transform: translateY(100%); transition: 0.3s; }
        .modal-bg.show .modal-content { transform: translateY(0); }
        .close-icon { float: right; background: #f1f5f9; border-radius: 50%; padding: 5px; cursor: pointer; color: #64748b; }

        #splash { position: fixed; inset: 0; background: var(--header-grad); z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; transition: 0.5s; }
        .loader { border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-top: 20px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        .success-box { position: fixed; inset: 0; background: white; z-index: 999; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .check-anim { width: 80px; height: 80px; background: var(--accent); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 40px; margin-bottom: 15px; animation: pop 0.5s; }
        @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        /* Admin UI */
        .admin-stat { background: #1e293b; color: white; padding: 15px; border-radius: 12px; flex: 1; text-align: center; }
        .admin-banner-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8fafc; border-radius: 10px; margin-bottom: 10px; }
        .admin-banner-img { height: 50px; width: 80px; object-fit: cover; border-radius: 6px; }
        .action-btn { padding: 6px 12px; border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="splash">
        <span class="material-icons-round" style="font-size: 70px;">holiday_village</span>
        <h2>‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ</h2><p>‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶≠‡¶ø‡¶≤‡ßá‡¶ú ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™</p><div class="loader"></div>
    </div>

    <div id="success-view" class="success-box">
        <div class="check-anim"><span class="material-icons-round">check</span></div>
        <h2 style="color: var(--text-main); margin:0;">‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!</h2>
        <p style="color: var(--text-sub);">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡ßü‡ßá‡¶õ‡ßá</p>
    </div>

    <div class="container">
        <header>
            <div class="header-top">
                <div class="app-title"><span class="material-icons-round">widgets</span> ‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ</div>
                <button id="logoutBtn" class="logout-btn"><span class="material-icons-round">logout</span> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
            <div class="hero-text">
                <h2 id="h-title">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2><p id="h-sub">‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶∏‡ßá‡¶¨‡¶æ‡¶Ø‡¶º ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</p>
            </div>
        </header>

        <main>
            <div id="view-auth" style="display: none; padding-top: 15px;">
                <div class="card" style="text-align: center;">
                    <h3 id="auth-head" style="color: var(--primary);">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    <input type="email" id="auth-email" class="input-box" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏">
                    <input type="password" id="auth-pass" class="input-box" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
                    <button id="auth-action" class="btn btn-primary">‡¶≤‡¶ó‡¶á‡¶®</button>
                    <p style="margin-top: 20px; font-size: 0.9rem;">
                        <span id="auth-hint">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á?</span> 
                        <b id="auth-toggle" style="color: var(--primary); cursor: pointer;">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</b>
                    </p>
                </div>
            </div>

            <div id="view-setup" style="display: none;">
                <div class="card">
                    <div class="title-sec">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®</div>
                    <p style="font-size: 0.85rem; color: var(--text-sub); margin-top:-10px; margin-bottom:15px">‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ‡ßü ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶§‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®</p>
                    <input id="set-name" class="input-box" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ">
                    <input id="set-prof" class="input-box" placeholder="‡¶™‡ßá‡¶∂‡¶æ (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶õ‡¶æ‡¶§‡ßç‡¶∞, ‡¶ï‡ßÉ‡¶∑‡¶ï)">
                    <select id="set-blood" class="input-box">
                        <option value="">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option><option>A+</option><option>A-</option><option>B+</option><option>B-</option><option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
                    </select>
                    <input type="tel" id="set-phone" class="input-box" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
                    <input id="set-addr" class="input-box" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶™‡¶æ‡ßú‡¶æ/‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
                    <button id="save-setup" class="btn btn-success">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® <span class="material-icons-round">check_circle</span></button>
                </div>
            </div>

            <div id="view-home" style="display: none;">
                <div class="banner-box" id="banner-slider">
                    <div style="display:flex; justify-content:center; align-items:center; height:100%; color:#94a3b8">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
                </div>

                <div class="title-sec" style="margin-bottom: 12px; font-size: 1.15rem;">‡¶è‡¶ï ‡¶®‡¶ú‡¶∞‡ßá ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶ü‡¶ø</div>
                <div class="glance-grid">
                    <div class="glance-card" onclick="openDirectory('mosque', '‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶‡¶∏‡¶Æ‡ßÇ‡¶π')">
                        <div class="glance-icon ic-mosque"><span class="material-icons-round">mosque</span></div>
                        <div style="font-size: 0.8rem; font-weight: 600;">‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶</div>
                    </div>
                    <div class="glance-card" onclick="openDirectory('school', '‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡ßü‡¶∏‡¶Æ‡ßÇ‡¶π')">
                        <div class="glance-icon ic-school"><span class="material-icons-round">school</span></div>
                        <div style="font-size: 0.8rem; font-weight: 600;">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡ßü</div>
                    </div>
                    <div class="glance-card" onclick="openDirectory('shop', '‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡¶∏‡¶Æ‡ßÇ‡¶π')">
                        <div class="glance-icon ic-shop"><span class="material-icons-round">storefront</span></div>
                        <div style="font-size: 0.8rem; font-weight: 600;">‡¶¶‡ßã‡¶ï‡¶æ‡¶®</div>
                    </div>
                    <div class="glance-card" onclick="switchTab('villagers')">
                        <div class="glance-icon ic-villager"><span class="material-icons-round">groups</span></div>
                        <div style="font-size: 0.8rem; font-weight: 600;">‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ</div>
                    </div>
                    <div class="glance-card" onclick="openMapModal()">
                        <div class="glance-icon ic-map"><span class="material-icons-round">map</span></div>
                        <div style="font-size: 0.8rem; font-weight: 600;">Map</div>
                    </div>
                </div>

                <button class="btn btn-outline" onclick="switchTab('villagers')" style="margin-bottom: 15px;">
                    <span class="material-icons-round">groups</span> ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                </button>

                <div class="card" style="padding: 15px 10px;">
                    <div class="title-sec" style="margin-left: 5px;"><span class="material-icons-round">campaign</span> ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¨‡ßã‡¶∞‡ßç‡¶°</div>
                    <div id="notice-list"><p style="text-align:center; color:#94a3b8">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p></div>
                </div>
            </div>

            <div id="view-services" style="display: none;">
                <div class="title-sec" style="margin-bottom: 20px; font-size: 1.2rem;">‡¶ú‡¶®‡¶™‡ßç‡¶∞‡¶ø‡ßü ‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π</div>
                <div class="service-grid">
                    <div class="service-card" onclick="openModal('blood-modal'); loadDonors('All')">
                        <div class="s-icon" style="background:#fee2e2; color:var(--danger)"><span class="material-icons-round">bloodtype</span></div>
                        <b>‡¶¨‡ßç‡¶≤‡¶æ‡¶° ‡¶°‡ßã‡¶®‡¶æ‡¶∞</b>
                    </div>
                    <div class="service-card" onclick="openModal('emergency-modal')">
                        <div class="s-icon" style="background:#ffedd5; color:var(--warning)"><span class="material-icons-round">support_agent</span></div>
                        <b>‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ</b>
                    </div>
                    <div class="service-card" onclick="openModal('agri-modal')">
                        <div class="s-icon" style="background:#dcfce7; color:var(--accent)"><span class="material-icons-round">agriculture</span></div>
                        <b>‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶§‡¶•‡ßç‡¶Ø</b>
                    </div>
                </div>
            </div>

            <div id="view-villagers" style="display: none;">
                <div style="position: sticky; top: 0; background: var(--bg); padding-bottom: 10px; z-index: 30;">
                    <input type="text" id="search-villager" class="input-box" placeholder="üîç ‡¶®‡¶æ‡¶Æ, ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¨‡¶æ ‡¶™‡ßá‡¶∂‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." style="border-radius: 30px; margin: 0;">
                </div>
                <div id="villager-list">
                    <p style="text-align:center; color:#94a3b8">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>
            </div>

            <div id="view-profile" style="display: none;">
                <div class="card" style="text-align: center;">
                    <div style="width:70px; height:70px; background:var(--primary); color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:35px; margin:0 auto 10px"><span class="material-icons-round">person</span></div>
                    <h3 id="my-name" style="margin: 0;">Name</h3>
                    <p id="my-role" style="color:var(--text-sub); margin: 5px 0;">Role</p>
                </div>
                <div class="card">
                    <div class="title-sec">‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</div>
                    <input id="up-name" class="input-box" placeholder="‡¶®‡¶æ‡¶Æ">
                    <input id="up-prof" class="input-box" placeholder="‡¶™‡ßá‡¶∂‡¶æ">
                    <input id="up-phone" class="input-box" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤">
                    <button id="up-btn" class="btn btn-primary">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <div id="view-admin" style="display: none;">
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <div class="admin-stat"><h2 id="st-user" style="margin:0">0</h2><small>Users</small></div>
                    <div class="admin-stat" style="background:var(--accent)"><h2 id="st-note" style="margin:0">0</h2><small>Notices</small></div>
                </div>

                <div class="card">
                    <div class="title-sec">‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    <input id="ab-img" class="input-box" placeholder="Image URL (16:7)">
                    <input id="ab-link" class="input-box" placeholder="Link URL">
                    <button id="ab-btn" class="btn btn-primary" style="background:#db2777">‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <div id="admin-banners" style="margin-top: 15px;"></div>
                </div>

                <div class="card">
                    <div class="title-sec">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶® ‡¶ì ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    <select id="ad-dir-type" class="input-box">
                        <option value="mosque">‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶</option>
                        <option value="school">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡ßü</option>
                        <option value="shop">‡¶¶‡ßã‡¶ï‡¶æ‡¶®</option>
                    </select>
                    <input id="ad-dir-name" class="input-box" placeholder="‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá‡¶∞/‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
                    <textarea id="ad-dir-desc" class="input-box" rows="2" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶•‡ßç‡¶Ø / ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ"></textarea>
                    <button id="ad-dir-btn" class="btn btn-primary" style="background:#8b5cf6">‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ‡ßü ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <div id="admin-dir-list" style="margin-top: 15px; max-height:200px; overflow-y:auto"></div>
                </div>

                <div class="card">
                    <div class="title-sec">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ (Map) ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    <input id="ad-map-url" class="input-box" placeholder="Google Maps Embed Code / Link">
                    <button id="ad-map-btn" class="btn btn-primary" style="background:#ef4444">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>

                <div class="card">
                    <div class="title-sec">‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    <input id="an-title" class="input-box" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ">
                    <textarea id="an-desc" class="input-box" rows="2" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§"></textarea>
                    <button id="an-btn" class="btn btn-primary">‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>

                <div class="card">
                    <div class="title-sec">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤</div>
                    <input id="au-search" class="input-box" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
                    <div id="admin-users" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
            </div>
        </main>

        <nav class="bottom-nav" id="b-nav">
            <div class="nav-btn active" id="tab-home"><span class="material-icons-round" style="font-size:26px">home</span>‡¶π‡ßã‡¶Æ</div>
            <div class="nav-btn" id="tab-services"><div class="nav-center"><span class="material-icons-round" style="font-size:30px">grid_view</span></div></div>
            <div class="nav-btn" id="tab-admin" style="display: none;"><span class="material-icons-round" style="font-size:26px">admin_panel_settings</span>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</div>
            <div class="nav-btn" id="tab-profile"><span class="material-icons-round" style="font-size:26px">person</span>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</div>
        </nav>

        <div id="user-modal" class="modal-bg">
            <div class="modal-content" style="text-align: center;">
                <span class="material-icons-round close-icon" onclick="closeModal('user-modal')">close</span>
                <div id="um-av" style="width:60px; height:60px; background:#eff6ff; color:var(--primary); border-radius:50%; font-size:28px; font-weight:bold; display:flex; align-items:center; justify-content:center; margin: 0 auto 10px;">A</div>
                <h3 id="um-name" style="margin: 0;">Name</h3>
                <p id="um-role" style="color:var(--text-sub); margin: 5px 0 15px;">Role</p>
                <div style="background:#f8fafc; padding:15px; border-radius:12px; text-align:left; font-size:0.95rem;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px"><span>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤:</span><b id="um-phone">-</b></div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px"><span>‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™:</span><b id="um-blood" style="color:var(--danger)">-</b></div>
                    <div style="display:flex; justify-content:space-between"><span>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</span><b id="um-addr">-</b></div>
                </div>
                <a id="um-call" href="#" class="btn btn-success" style="margin-top: 15px; text-decoration: none;"><span class="material-icons-round">call</span> ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
            </div>
        </div>

        <div id="blood-modal" class="modal-bg">
            <div class="modal-content">
                <span class="material-icons-round close-icon" onclick="closeModal('blood-modal')">close</span>
                <h3 style="color:var(--danger); margin:0 0 15px;"><span class="material-icons-round" style="vertical-align:middle">bloodtype</span> ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶§‡¶æ</h3>
                <div style="background:#fef2f2; padding:12px; border-radius:12px; margin-bottom:15px;">
                    <input id="bd-name" class="input-box" placeholder="‡¶®‡¶æ‡¶Æ" style="margin-bottom:8px">
                    <select id="bd-grp" class="input-box" style="margin-bottom:8px"><option value="">‡¶ó‡ßç‡¶∞‡ßÅ‡¶™...</option><option>A+</option><option>B+</option><option>O+</option><option>AB+</option><option>A-</option><option>B-</option><option>O-</option><option>AB-</option></select>
                    <input id="bd-phone" type="tel" class="input-box" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤" style="margin-bottom:8px">
                    <button id="bd-add" class="btn btn-primary" style="background:var(--danger); padding:10px">‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
                <select id="bd-filter" class="input-box" onchange="loadDonors(this.value)"><option value="All">‡¶∏‡¶ï‡¶≤ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</option><option>A+</option><option>B+</option><option>O+</option><option>AB+</option><option>A-</option><option>B-</option><option>O-</option><option>AB-</option></select>
                <div id="bd-list" style="max-height: 250px; overflow-y:auto"></div>
            </div>
        </div>

        <div id="emergency-modal" class="modal-bg">
            <div class="modal-content">
                <span class="material-icons-round close-icon" onclick="closeModal('emergency-modal')">close</span>
                <h3 style="color:var(--warning); margin:0 0 15px;">‚òéÔ∏è ‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ</h3>
                <div class="list-item"><div><h4 style="margin:0">‡¶ú‡¶æ‡¶§‡ßÄ‡ßü ‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ</h4><small>999</small></div><a href="tel:999" class="call-btn" style="background:#fff7ed; color:var(--warning)"><span class="material-icons-round">call</span></a></div>
                <div class="list-item"><div><h4 style="margin:0">‡¶á‡¶â‡¶®‡¶ø‡¶Ø‡¶º‡¶® ‡¶ö‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®</h4><small>01700000000</small></div><a href="tel:01700000000" class="call-btn" style="background:#eff6ff; color:var(--primary)"><span class="material-icons-round">call</span></a></div>
            </div>
        </div>

        <div id="agri-modal" class="modal-bg">
            <div class="modal-content">
                <span class="material-icons-round close-icon" onclick="closeModal('agri-modal')">close</span>
                <h3 style="color:var(--accent); margin:0 0 15px;">üåæ ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶§‡¶•‡ßç‡¶Ø</h3>
                <div style="background:#f0fdf4; color:#166534; padding:12px; border-radius:12px; margin-bottom:15px; font-size:0.9rem">‡¶¨‡ßã‡¶∞‡ßã ‡¶ß‡¶æ‡¶®‡ßá‡¶∞ ‡¶ö‡¶æ‡¶∞‡¶æ ‡¶∞‡ßã‡¶™‡¶£‡ßá‡¶∞ ‡¶â‡¶™‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶∏‡¶Æ‡ßü ‡¶ö‡¶≤‡¶õ‡ßá‡•§ ‡¶ú‡¶Æ‡¶ø‡¶§‡ßá ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶∏‡ßá‡¶ö ‡¶¶‡¶ø‡¶®‡•§</div>
                <div class="list-item"><div><h4 style="margin:0">‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶ï‡¶≤ ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</h4><small>16123</small></div><a href="tel:16123" class="call-btn"><span class="material-icons-round">call</span></a></div>
            </div>
        </div>

        <div id="dir-modal" class="modal-bg">
            <div class="modal-content">
                <span class="material-icons-round close-icon" onclick="closeModal('dir-modal')">close</span>
                <h3 id="dir-title" style="margin:0 0 15px;">Title</h3>
                <div id="dir-list" style="max-height: 400px; overflow-y:auto;"></div>
            </div>
        </div>

        <div id="map-modal" class="modal-bg">
            <div class="modal-content">
                <span class="material-icons-round close-icon" onclick="closeModal('map-modal')">close</span>
                <h3 style="margin:0 0 15px;">‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™</h3>
                <div id="map-wrapper" class="map-container"></div>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc, setDoc, updateDoc, deleteDoc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyAuqcDRrtuQi2tdWXA2E_UWyq7pCrGpoy4", authDomain: "parkhali-village.firebaseapp.com", projectId: "parkhali-village" };
        const app = initializeApp(firebaseConfig); const auth = getAuth(app); const db = getFirestore(app); const adminEmail = "admin@parkhali.com";

        // Global Modal Controls
        window.openModal = (id) => { const m=document.getElementById(id); m.style.display='flex'; setTimeout(()=>m.classList.add('show'), 10); }
        window.closeModal = (id) => { const m=document.getElementById(id); m.classList.remove('show'); setTimeout(()=>m.style.display='none', 300); }

        // Navigation Manager
        const tabs = { home:'view-home', services:'view-services', villagers:'view-villagers', profile:'view-profile', admin:'view-admin', auth:'view-auth', setup:'view-setup' };
        const navBtns = { home:'tab-home', services:'tab-services', profile:'tab-profile', admin:'tab-admin' };

        window.switchTab = (tabName) => {
            Object.values(tabs).forEach(id => document.getElementById(id).style.display = 'none');
            Object.values(navBtns).forEach(id => document.getElementById(id).classList.remove('active'));

            document.getElementById(tabs[tabName]).style.display = 'block';

            if(tabName === 'villagers') { document.getElementById('tab-home').classList.add('active'); }
            else if(navBtns[tabName]) { document.getElementById(navBtns[tabName]).classList.add('active'); }

            const hTitle = document.getElementById('h-title'); const hSub = document.getElementById('h-sub');
            if(tabName === 'home') { hTitle.innerText="‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!"; hSub.innerText=auth.currentUser?.email.split('@')[0]||''; loadBanners(); loadNotices(); }
            else if(tabName === 'services') { hTitle.innerText="‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π"; hSub.innerText="‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü ‡¶∏‡¶ï‡¶≤ ‡¶∏‡ßá‡¶¨‡¶æ"; }
            else if(tabName === 'villagers') { hTitle.innerText="‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ"; hSub.innerText="‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶ì ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó"; loadVillagers(); }
            else if(tabName === 'profile') { hTitle.innerText="‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤"; hSub.innerText="‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶§‡¶•‡ßç‡¶Ø"; loadProfile(); }
            else if(tabName === 'admin') { hTitle.innerText="‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®"; hSub.innerText="‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤"; loadAdminData(); }
        };

        Object.keys(navBtns).forEach(k => document.getElementById(navBtns[k]).addEventListener('click', () => switchTab(k)));

        // Auth Logic
        onAuthStateChanged(auth, async (user) => {
            setTimeout(() => document.getElementById('splash').style.display = 'none', 1500);
            if(user) {
                const uDoc = await getDoc(doc(db, "users", user.uid));
                if(uDoc.exists()) {
                    const data = uDoc.data();
                    if(data.status === "banned" && user.email !== adminEmail) { signOut(auth); alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); return; }
                    
                    document.getElementById('logoutBtn').style.display = "flex";
                    
                    if(!data.name && user.email !== adminEmail) {
                        document.getElementById('b-nav').style.display = "none";
                        switchTab('setup');
                    } else {
                        document.getElementById('b-nav').style.display = "flex";
                        document.getElementById('tab-admin').style.display = (user.email === adminEmail) ? "flex" : "none";
                        switchTab('home');
                    }
                } else {
                    await setDoc(doc(db, "users", user.uid), { email:user.email, role:"user", status:"active" });
                    switchTab('setup');
                }
            } else {
                document.getElementById('logoutBtn').style.display = "none";
                document.getElementById('b-nav').style.display = "none";
                switchTab('auth');
            }
        });

        // Login / Register Toggle
        let isLog = true;
        document.getElementById('auth-toggle').onclick = () => {
            isLog = !isLog;
            document.getElementById('auth-head').innerText = isLog ? "‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®" : "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü";
            document.getElementById('auth-action').innerText = isLog ? "‡¶≤‡¶ó‡¶á‡¶®" : "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞";
            document.getElementById('auth-hint').innerText = isLog ? "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á?" : "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá?";
            document.getElementById('auth-toggle').innerText = isLog ? "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®" : "‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
        };

        document.getElementById('auth-action').onclick = async () => {
            const e = document.getElementById('auth-email').value; const p = document.getElementById('auth-pass').value;
            if(!e || !p) return;
            try {
                if(isLog) await signInWithEmailAndPassword(auth, e, p);
                else {
                    const c = await createUserWithEmailAndPassword(auth, e, p);
                    await setDoc(doc(db, "users", c.user.uid), { email:e, role: e===adminEmail?"admin":"user", status:"active", createdAt:serverTimestamp() });
                }
            } catch(er) { alert("Error: " + er.message); }
        };
        document.getElementById('logoutBtn').onclick = () => signOut(auth);

        // Save Profile (Step 2 Reg)
        document.getElementById('save-setup').onclick = async () => {
            const n = document.getElementById('set-name').value; const a = document.getElementById('set-addr').value;
            if(!n || !a) return alert("‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶¶‡¶ø‡¶®!");
            await updateDoc(doc(db, "users", auth.currentUser.uid), {
                name: n, profession: document.getElementById('set-prof').value,
                bloodGroup: document.getElementById('set-blood').value,
                phone: document.getElementById('set-phone').value, address: a
            });
            const s = document.getElementById('success-view'); s.style.display='flex';
            setTimeout(() => { s.style.display='none'; document.getElementById('b-nav').style.display='flex'; switchTab('home'); }, 2000);
        };

        // Banner Slider
        let sInt;
        async function loadBanners() {
            const b = document.getElementById('banner-slider');
            const d = await getDocs(query(collection(db, "banners"), orderBy("createdAt", "desc")));
            if(d.empty) { b.innerHTML = "<div style='display:flex;justify-content:center;align-items:center;height:100%;color:#94a3b8'>‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</div>"; return; }
            b.innerHTML = ""; let i=0;
            d.forEach(doc => { b.innerHTML += `<a href="${doc.data().link||'#'}"><img src="${doc.data().image}" class="banner-img ${i===0?'active':''}"></a>`; i++; });
            if(sInt) clearInterval(sInt);
            if(i>1) sInt = setInterval(()=>{
                const imgs = document.querySelectorAll('.banner-img'); let a=0;
                imgs.forEach((el,x)=>{if(el.classList.contains('active')){el.classList.remove('active');a=x;}});
                imgs[(a+1)%imgs.length].classList.add('active');
            }, 3500);
        }

        // Notices
        async function loadNotices() {
            const n = document.getElementById('notice-list');
            const d = await getDocs(query(collection(db, "notices"), orderBy("createdAt", "desc")));
            n.innerHTML = d.empty ? "<p style='text-align:center;color:#94a3b8'>‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶®‡ßá‡¶á</p>" : "";
            d.forEach(doc => { n.innerHTML += `<div style="background:white; padding:12px; border-left:4px solid var(--primary); border-radius:8px; margin-bottom:10px; box-shadow:0 1px 3px rgba(0,0,0,0.05)"><h4 style="margin:0 0 5px">${doc.data().title}</h4><p style="margin:0; font-size:0.85rem; color:#64748b">${doc.data().description}</p></div>`; });
        }

        // Villagers List
        let cachedV = [];
        async function loadVillagers() {
            const l = document.getElementById('villager-list');
            if(cachedV.length === 0) {
                l.innerHTML = "<p style='text-align:center;color:#94a3b8'>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>";
                const d = await getDocs(collection(db, "users")); cachedV = [];
                d.forEach(doc => cachedV.push(doc.data()));
            }
            renderV(cachedV);
        }
        function renderV(list) {
            const l = document.getElementById('villager-list'); l.innerHTML = "";
            const v = list.filter(u => u.name && u.status !== 'banned');
            if(v.length===0) { l.innerHTML = "<p style='text-align:center'>‡¶ï‡¶æ‡¶â‡¶ï‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>"; return; }
            v.forEach(u => {
                const sData = encodeURIComponent(JSON.stringify(u));
                l.innerHTML += `
                <div class="list-item" onclick="window.showU('${sData}')">
                    <div style="display:flex;align-items:center"><div class="avatar">${u.name.charAt(0)}</div><div class="info"><h4>${u.name}</h4><p>${u.profession||'‡¶™‡ßá‡¶∂‡¶æ ‡¶®‡ßá‡¶á'}</p></div></div>
                    <a href="tel:${u.phone}" class="call-btn" onclick="event.stopPropagation()"><span class="material-icons-round">call</span></a>
                </div>`;
            });
        }
        document.getElementById('search-villager').addEventListener('input', (e) => {
            const q = e.target.value.toLowerCase();
            renderV(cachedV.filter(u => u.name?.toLowerCase().includes(q) || u.phone?.includes(q) || u.profession?.toLowerCase().includes(q)));
        });
        window.showU = (d) => {
            const u = JSON.parse(decodeURIComponent(d));
            document.getElementById('um-av').innerText = u.name.charAt(0);
            document.getElementById('um-name').innerText = u.name;
            document.getElementById('um-role').innerText = u.profession||'-';
            document.getElementById('um-phone').innerText = u.phone||'-';
            document.getElementById('um-blood').innerText = u.bloodGroup||'-';
            document.getElementById('um-addr').innerText = u.address||'-';
            document.getElementById('um-call').href = `tel:${u.phone}`;
            openModal('user-modal');
        };

        // Blood Donors
        window.loadDonors = async (f) => {
            const l = document.getElementById('bd-list'); l.innerHTML = "‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            const d = await getDocs(query(collection(db, "blood_donors"), orderBy("createdAt", "desc"))); l.innerHTML="";
            d.forEach(doc => {
                const v = doc.data();
                if(f==='All' || v.bloodGroup===f) l.innerHTML += `<div class="list-item"><div><b style="color:var(--danger)">${v.bloodGroup}</b> ${v.name}</div><a href="tel:${v.phone}" class="call-btn"><span class="material-icons-round">call</span></a></div>`;
            });
        };
        document.getElementById('bd-add').onclick = async () => {
            const n=document.getElementById('bd-name').value; const g=document.getElementById('bd-grp').value; const p=document.getElementById('bd-phone').value;
            if(!n||!g||!p)return; await addDoc(collection(db,"blood_donors"),{name:n,bloodGroup:g,phone:p,createdAt:serverTimestamp()}); alert("‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); loadDonors('All');
        };

        // NEW: Directory Logic (Mosque, School, Shop)
        window.openDirectory = async (type, title) => {
            document.getElementById('dir-title').innerText = title;
            openModal('dir-modal');
            const l = document.getElementById('dir-list');
            l.innerHTML = "<p style='text-align:center; color:#94a3b8'>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>";
            const d = await getDocs(query(collection(db, "directory"), orderBy("createdAt", "desc")));
            l.innerHTML = "";
            let count = 0;
            d.forEach(doc => {
                const v = doc.data();
                if(v.type === type) {
                    count++;
                    l.innerHTML += `
                    <div style="background:#f8fafc; padding:15px; border-radius:12px; margin-bottom:10px; border-left:4px solid var(--primary);">
                        <h4 style="margin:0 0 5px; color:var(--text-main); font-size:1.05rem;">${v.name}</h4>
                        <p style="margin:0; font-size:0.85rem; color:var(--text-sub); white-space:pre-wrap;">${v.desc}</p>
                    </div>`;
                }
            });
            if(count === 0) l.innerHTML = "<p style='text-align:center; color:#94a3b8'>‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>";
        };

        // NEW: Map Logic
        window.openMapModal = async () => {
            openModal('map-modal');
            const w = document.getElementById('map-wrapper');
            w.innerHTML = "<p style='text-align:center; color:#94a3b8'>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>";
            const docRef = await getDoc(doc(db, "settings", "map"));
            if(docRef.exists() && docRef.data().url) {
                const url = docRef.data().url;
                if(url.includes('<iframe')) { w.innerHTML = url; } 
                else { w.innerHTML = `<iframe src="${url}"></iframe>`; }
            } else {
                w.innerHTML = "<p style='text-align:center; color:#94a3b8'>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶ñ‡¶®‡¶ì ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßá‡¶®‡¶ø</p>";
            }
        };

        // Profile
        async function loadProfile() {
            if(!auth.currentUser) return;
            const d = await getDoc(doc(db,"users",auth.currentUser.uid));
            if(d.exists()) {
                const u=d.data(); document.getElementById('my-name').innerText=u.name; document.getElementById('my-role').innerText=u.email;
                document.getElementById('up-name').value=u.name; document.getElementById('up-prof').value=u.profession; document.getElementById('up-phone').value=u.phone;
            }
        }
        document.getElementById('up-btn').onclick = async () => {
            await updateDoc(doc(db,"users",auth.currentUser.uid),{name:document.getElementById('up-name').value, profession:document.getElementById('up-prof').value, phone:document.getElementById('up-phone').value}); alert("‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá"); loadProfile();
        };

        // Admin
        async function loadAdminData() {
            const us = await getDocs(collection(db,"users")); const ns = await getDocs(collection(db,"notices"));
            document.getElementById('st-user').innerText = us.size; document.getElementById('st-note').innerText = ns.size;
            
            // Users list
            const ul = document.getElementById('admin-users'); ul.innerHTML="";
            us.forEach(d => {
                const u=d.data();
                const btn = u.status==='banned'?`<button onclick="window.actU('${d.id}','active')" class="action-btn" style="background:var(--accent)">Unban</button>`:`<button onclick="window.actU('${d.id}','banned')" class="action-btn" style="background:var(--warning)">Ban</button>`;
                ul.innerHTML += `<div class="list-item" style="cursor:default"><div><b>${u.email}</b><br><small>${u.role}</small></div><div>${u.role!=='admin'?btn+` <button onclick="window.delU('${d.id}')" class="action-btn" style="background:var(--danger)">Del</button>`:''}</div></div>`;
            });

            // Banners list
            const bl = document.getElementById('admin-banners'); bl.innerHTML="";
            const bs = await getDocs(collection(db,"banners"));
            bs.forEach(d => { bl.innerHTML+=`<div class="admin-banner-item"><img src="${d.data().image}" class="admin-banner-img"><button onclick="window.delB('${d.id}')" class="action-btn" style="background:var(--danger)">Delete</button></div>`; });

            // NEW: Directory list
            const dl = document.getElementById('admin-dir-list'); dl.innerHTML = "";
            const ds = await getDocs(query(collection(db, "directory"), orderBy("createdAt", "desc")));
            ds.forEach(d => {
                const v = d.data();
                let tName = v.type==='mosque'?'‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶':v.type==='school'?'‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡ßü':'‡¶¶‡ßã‡¶ï‡¶æ‡¶®';
                dl.innerHTML += `<div class="list-item" style="cursor:default; padding:10px;">
                    <div><b>${v.name}</b><br><small>${tName}</small></div>
                    <button onclick="window.delDir('${d.id}')" class="action-btn" style="background:var(--danger)">Del</button>
                </div>`;
            });

            // NEW: Map Pre-fill
            const mDoc = await getDoc(doc(db, "settings", "map"));
            if(mDoc.exists() && mDoc.data().url) document.getElementById('ad-map-url').value = mDoc.data().url;
        }

        document.getElementById('ab-btn').onclick = async () => { const i=document.getElementById('ab-img').value; if(!i)return; await addDoc(collection(db,"banners"),{image:i,link:document.getElementById('ab-link').value,createdAt:serverTimestamp()}); document.getElementById('ab-img').value=""; loadAdminData(); };
        document.getElementById('an-btn').onclick = async () => { const t=document.getElementById('an-title').value; if(!t)return; await addDoc(collection(db,"notices"),{title:t,description:document.getElementById('an-desc').value,createdAt:serverTimestamp()}); alert("Published"); };
        
        // NEW: Directory Save
        document.getElementById('ad-dir-btn').onclick = async () => {
            const type = document.getElementById('ad-dir-type').value;
            const name = document.getElementById('ad-dir-name').value;
            const desc = document.getElementById('ad-dir-desc').value;
            if(!name) return;
            await addDoc(collection(db, "directory"), { type, name, desc, createdAt: serverTimestamp() });
            alert("‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ‡ßü ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            document.getElementById('ad-dir-name').value = ""; document.getElementById('ad-dir-desc').value = "";
            loadAdminData();
        };

        // NEW: Map Save
        document.getElementById('ad-map-btn').onclick = async () => {
            const url = document.getElementById('ad-map-url').value;
            if(!url) return;
            await setDoc(doc(db, "settings", "map"), { url });
            alert("‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        };
        
        document.getElementById('au-search').addEventListener('input',(e)=>{ const v=e.target.value.toLowerCase(); document.querySelectorAll('#admin-users .list-item').forEach(el=>{ el.style.display=el.innerText.toLowerCase().includes(v)?'flex':'none'; }); });

        window.actU=async(id,s)=>{await updateDoc(doc(db,"users",id),{status:s}); loadAdminData();};
        window.delU=async(id)=>{if(confirm('Delete User?')){await deleteDoc(doc(db,"users",id)); loadAdminData();}};
        window.delB=async(id)=>{if(confirm('Delete Banner?')){await deleteDoc(doc(db,"banners",id)); loadAdminData();}};
        window.delDir=async(id)=>{if(confirm('‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')){await deleteDoc(doc(db,"directory",id)); loadAdminData();}};

    </script>
</body>
</html>
