<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ - ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶∏‡ßá‡¶¨‡¶æ</title>
    <style>
        /* --- CSS Styles --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7f6;
            color: #333;
        }

        header {
            background-color: #2e7d32;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header button {
            background-color: #d32f2f;
            color: white;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
        }

        main {
            padding: 2rem;
            max-width: 900px;
            margin: 0 auto;
        }

        .form-container, .dashboard-section, .admin-section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .form-container {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }

        input, textarea {
            width: 100%;
            box-sizing: border-box;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        button.action-btn {
            width: 100%;
            padding: 10px;
            background-color: #2e7d32;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        button.action-btn:hover { background-color: #1b5e20; }

        .link {
            color: #1976d2;
            cursor: pointer;
            font-weight: bold;
        }

        .error { color: red; font-size: 14px; margin-top: 10px; }
        .success { color: green; font-size: 14px; margin-top: 10px; }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .card {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            border: 1px solid #c8e6c9;
        }

        .card:hover { transform: translateY(-5px); background-color: #c8e6c9; }

        /* Notice Board Styles */
        .notice-item {
            background: #fff3e0;
            padding: 15px;
            border-left: 5px solid #ff9800;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .notice-date { font-size: 12px; color: #666; }
        
        #admin-panel { border: 2px solid #0277bd; }
        .admin-title { color: #0277bd; }
    </style>
</head>
<body>

    <header>
        <h1>‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</h1>
        <button id="logout-btn" style="display: none;">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
    </header>

    <main>
        <section id="auth-section" class="form-container">
            <h2 id="form-title">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <input type="email" id="email" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤" required>
            <input type="password" id="password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°" required>
            <button id="auth-action-btn" class="action-btn">‡¶≤‡¶ó‡¶á‡¶®</button>
            <p id="toggle-auth">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? <span class="link">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span></p>
            <p id="error-msg" class="error"></p>
        </section>

        <section id="admin-panel" class="admin-section" style="display: none;">
            <h2 class="admin-title">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ (‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶∞‡ßÅ‡¶Æ)</h2>
            <p>‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®:</p>
            <input type="text" id="notice-title" placeholder="‡¶®‡ßã‡¶ü‡¶ø‡¶∂‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ">
            <textarea id="notice-desc" rows="3" placeholder="‡¶®‡ßã‡¶ü‡¶ø‡¶∂‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§..."></textarea>
            <button id="publish-notice-btn" class="action-btn" style="background-color: #0277bd;">‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <p id="admin-msg"></p>
        </section>

        <section id="user-dashboard" class="dashboard-section" style="display: none;">
            <h2>‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, <span id="user-email-display" style="color:#2e7d32;"></span></h2>
            
            <h3>‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
            <div class="services-grid">
                <div class="card">ü©∏ ‡¶¨‡ßç‡¶≤‡¶æ‡¶° ‡¶°‡ßã‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</div>
                <div class="card">‚òéÔ∏è ‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó</div>
                <div class="card">üåæ ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂</div>
            </div>

            <h3 style="margin-top: 30px;">üì¢ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¨‡ßã‡¶∞‡ßç‡¶°</h3>
            <div id="notice-board-container">
                <p>‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
            </div>
        </section>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAuqcDRrtuQi2tdWXA2E_UWyq7pCrGpoy4",
            authDomain: "parkhali-village.firebaseapp.com",
            projectId: "parkhali-village",
            storageBucket: "parkhali-village.firebasestorage.app",
            messagingSenderId: "645968583344",
            appId: "1:645968583344:web:89a049e6ffaba4af33b975",
            measurementId: "G-WD2LSS97KC"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // UI Elements
        const authSection = document.getElementById('auth-section');
        const userDashboard = document.getElementById('user-dashboard');
        const adminPanel = document.getElementById('admin-panel');
        const logoutBtn = document.getElementById('logout-btn');
        const errorMsg = document.getElementById('error-msg');
        
        let isLogin = true;
        const adminEmail = "admin@parkhali.com"; // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®

        // Auth Toggle
        document.getElementById('toggle-auth').addEventListener('click', () => {
            isLogin = !isLogin;
            document.getElementById('form-title').innerText = isLogin ? "‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®" : "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
            document.getElementById('auth-action-btn').innerText = isLogin ? "‡¶≤‡¶ó‡¶á‡¶®" : "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞";
            document.getElementById('toggle-auth').innerHTML = isLogin ? '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? <span class="link">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span>' : '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? <span class="link">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span>';
            errorMsg.innerText = "";
        });

        // Login / Register Action
        document.getElementById('auth-action-btn').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if(!email || !password) return errorMsg.innerText = "‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®!";

            if(isLogin) {
                signInWithEmailAndPassword(auth, email, password).catch(e => errorMsg.innerText = "‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: " + e.message);
            } else {
                createUserWithEmailAndPassword(auth, email, password).catch(e => errorMsg.innerText = "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: " + e.message);
            }
        });

        // Logout
        logoutBtn.addEventListener('click', () => signOut(auth));

        // Auth State Observer
        onAuthStateChanged(auth, (user) => {
            if (user) {
                authSection.style.display = "none";
                logoutBtn.style.display = "block";
                userDashboard.style.display = "block";
                document.getElementById('user-email-display').innerText = user.email;

                adminPanel.style.display = (user.email === adminEmail) ? "block" : "none";
                loadNotices(); // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶≤‡ßá‡¶á ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá
            } else {
                authSection.style.display = "block";
                logoutBtn.style.display = "none";
                userDashboard.style.display = "none";
                adminPanel.style.display = "none";
            }
        });

        // --- Firestore: Notice Board Logic --- //

        // 1. Add Notice (Admin Only)
        document.getElementById('publish-notice-btn').addEventListener('click', async () => {
            const title = document.getElementById('notice-title').value;
            const desc = document.getElementById('notice-desc').value;
            const msgBox = document.getElementById('admin-msg');

            if(!title || !desc) {
                msgBox.className = "error";
                msgBox.innerText = "‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶Ö‡¶Ç‡¶∂ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!";
                return;
            }

            try {
                await addDoc(collection(db, "notices"), {
                    title: title,
                    description: desc,
                    createdAt: serverTimestamp()
                });
                msgBox.className = "success";
                msgBox.innerText = "‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶π‡ßü‡ßá‡¶õ‡ßá!";
                document.getElementById('notice-title').value = "";
                document.getElementById('notice-desc').value = "";
                loadNotices(); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶¨‡ßá
            } catch (e) {
                msgBox.className = "error";
                msgBox.innerText = "‡¶è‡¶∞‡¶∞: " + e.message;
            }
        });

        // 2. Load Notices (Visible to all logged-in users)
        async function loadNotices() {
            const container = document.getElementById('notice-board-container');
            container.innerHTML = "‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá..."; // Loading state
            
            try {
                // ‡¶®‡ßã‡¶ü‡¶ø‡¶∂‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶Æ‡ßü‡ßá‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶§‡ßá ‡¶∏‡¶æ‡¶ú‡¶ø‡ßü‡ßá ‡¶Ü‡¶®‡¶æ (‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶Ü‡¶ó‡ßá)
                const q = query(collection(db, "notices"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                
                container.innerHTML = ""; // Clear loading text
                
                if(querySnapshot.empty) {
                    container.innerHTML = "<p>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶®‡ßá‡¶á‡•§</p>";
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const notice = doc.data();
                    const dateObj = notice.createdAt ? notice.createdAt.toDate() : new Date();
                    const dateString = dateObj.toLocaleDateString('bn-BD') + " " + dateObj.toLocaleTimeString('bn-BD');

                    const noticeDiv = document.createElement('div');
                    noticeDiv.className = 'notice-item';
                    noticeDiv.innerHTML = `
                        <h4>${notice.title}</h4>
                        <p>${notice.description}</p>
                        <p class="notice-date">üìÖ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂‡¶ø‡¶§: ${dateString}</p>
                    `;
                    container.appendChild(noticeDiv);
                });
            } catch (e) {
                container.innerHTML = `<p class="error">‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá: ${e.message}</p>`;
            }
        }
    </script>
</body>
</html>
