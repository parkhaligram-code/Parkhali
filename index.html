<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‚µ£</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * { scroll-behavior: smooth; }
        body { font-family: 'Hind Siliguri', sans-serif; background: #e8f0e8; margin: 0; overflow-x: hidden; }
        .app-container { max-width: 480px; margin: 0 auto; background: white; min-height: 100vh; position: relative; box-shadow: 0 20px 40px rgba(0,40,0,0.1); border-radius: 24px 24px 0 0; overflow: hidden; }
        .hidden-section { display: none !important; }
        .content-area { padding-bottom: 80px; padding-top: 70px; height: 100vh; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        
        /* splash */
        #splash-screen { background: linear-gradient(145deg, #0b4f2b, #1b8c4a); z-index: 2000; }
        .letter { display: inline-block; opacity: 0; transform: scale(0.4) rotate(-5deg); font-size: 3.2rem; font-weight: 800; color: white; text-shadow: 0 8px 15px #0a3b1e; }
        .animate-letter { animation: popRubber 0.7s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
        @keyframes popRubber { 0%{ opacity:0; transform:scale(0.4) rotate(-10deg); } 70%{ opacity:1; transform:scale(1.1) rotate(1deg); } 100%{ opacity:1; transform:scale(1) rotate(0); } }

        /* modal */
        .modal-overlay { background: rgba(0,30,10,0.6); backdrop-filter: blur(8px); z-index: 300; opacity: 0; visibility: hidden; transition: 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { transform: translateY(60px); transition: 0.4s cubic-bezier(0.2, 0.9, 0.3, 1.2); }
        .modal-overlay.active .modal-content { transform: translateY(0); }

        /* tab animation */
        .page-tab { animation: fadeSlide 0.3s ease; }
        @keyframes fadeSlide { from{ opacity:0.4; transform:translateY(8px); } to{ opacity:1; transform:translateY(0); } }

        /* pull to refresh */
        #ptr-indicator { height: 0; transition: height 0.2s; overflow: hidden; background: #16a34a; color: white; text-align: center; font-size: 14px; font-weight: bold; }
        
        /* custom scroll */
        .content-area::-webkit-scrollbar { width: 4px; }
        .content-area::-webkit-scrollbar-thumb { background: #16a34a; border-radius: 10px; }

        /* avatar preview */
        .avatar-preview { width: 90px; height: 90px; border-radius: 999px; object-fit: cover; border: 4px solid white; box-shadow: 0 6px 15px rgba(0,80,20,0.3); background: #ddd; }
        .avatar-edit-overlay { position: relative; display: inline-block; cursor: pointer; }
        .avatar-edit-overlay:hover::after { content: "\f030"; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; bottom: 0; right: 0; background: #16a34a; color: white; border-radius: 50%; padding: 8px; font-size: 14px; border: 2px solid white; }
        .blood-badge { background: #fee2e2; color: #b91c1c; font-weight: 700; padding: 4px 10px; border-radius: 40px; font-size: 0.8rem; display: inline-block; }
        
        /* slider */
        .slider-wrapper { position: relative; overflow: hidden; border-radius: 1rem; height: 140px; background: #ddd; }
        .slider-track { display: flex; transition: transform 0.3s ease; height: 100%; }
        .slider-slide { flex: 0 0 100%; height: 100%; background-size: cover; background-position: center; }
        .slider-dot { width: 8px; height: 8px; border-radius: 50%; background: rgba(255,255,255,0.5); margin: 0 4px; cursor: pointer; }
        .slider-dot.active { background: white; transform: scale(1.2); }
        
        /* theme transition */
        * { transition: background-color 0.2s, border-color 0.2s; }
    </style>
</head>
<body>
<div class="app-container relative" id="appContainer">

    <!-- splash screen -->
    <div id="splash-screen" class="absolute inset-0 flex flex-col items-center justify-center z-[2000]">
        <div class="w-24 h-24 bg-white/30 rounded-3xl rotate-12 flex items-center justify-center mb-5 shadow-2xl backdrop-blur-sm"><i class="fas fa-tree text-5xl text-white drop-shadow-lg"></i></div>
        <div class="flex space-x-1" id="splash-text"><span class="letter">‡¶™‡¶æ</span><span class="letter">‡¶∞</span><span class="letter">‡¶ñ‡¶æ</span><span class="letter">‡¶≤‡ßÄ</span></div>
        <p class="text-white/90 mt-5 text-xl font-light tracking-widest">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</p>
    </div>

    <!-- global loader (premium) -->
    <div id="loading-overlay" class="absolute inset-0 bg-white/70 backdrop-blur-md z-[1000] hidden-section flex items-center justify-center">
        <div class="bg-white/90 p-5 rounded-2xl shadow-2xl flex flex-col items-center"><div class="w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"></div><p class="mt-2 font-semibold text-primary">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p></div>
    </div>

    <!-- PULL TO REFRESH indicator -->
    <div id="ptr-indicator" class="absolute top-0 left-0 w-full z-30 text-sm"><i class="fas fa-arrow-down mr-1"></i> ‡¶ü‡ßá‡¶®‡ßá ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</div>

    <!-- AUTH SECTION (glass premium) -->
    <div id="auth-section" class="hidden-section flex flex-col min-h-screen bg-gradient-to-b from-[#c8e6c9] to-[#e8f5e9]">
        <div class="backdrop-blur-md bg-white/40 mx-4 mt-16 p-6 rounded-3xl shadow-2xl border border-white/50">
            <div class="w-20 h-20 mx-auto bg-primary/80 text-white rounded-2xl rotate-6 flex items-center justify-center text-3xl shadow-xl"><i class="fas fa-leaf"></i></div>
            <h2 class="text-3xl font-black text-center text-gray-800 mt-2">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ</h2>
            <p class="text-center text-gray-600">‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡¶æ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</p>

            <!-- toggle tabs: login / register -->
            <div class="flex bg-gray-200/70 p-1 rounded-full mt-6">
                <button id="auth-toggle-login" class="w-1/2 py-2 rounded-full font-bold bg-white text-primary shadow-sm transition-all">‡¶≤‡¶ó‡¶á‡¶®</button>
                <button id="auth-toggle-register" class="w-1/2 py-2 rounded-full font-bold text-gray-600 hover:text-primary transition-all">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</button>
            </div>

            <!-- login container -->
            <div id="login-container" class="mt-6 space-y-4">
                <div class="flex border-b border-gray-300">
                    <button id="login-phone-tab" class="w-1/2 py-2 text-center font-semibold border-b-3 border-primary text-primary">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</button>
                    <button id="login-email-tab" class="w-1/2 py-2 text-center font-semibold text-gray-500">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</button>
                </div>
                <!-- login phone -->
                <div id="login-phone-div">
                    <div id="login-phone-step1">
                        <label class="text-sm font-semibold text-gray-700">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                        <div class="flex mt-1"><span class="bg-gray-100 border border-r-0 border-gray-300 px-3 py-3 rounded-l-lg font-bold">+88</span><input type="tel" id="login-phone-input" placeholder="01XXX-XXXXXX" class="w-full px-4 py-3 border rounded-r-lg focus:border-primary outline-none"></div>
                        <button id="login-send-otp" class="w-full bg-primary text-white py-3 rounded-xl mt-5 font-bold shadow-md hover:bg-secondary transition">OTP ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
                    </div>
                    <div id="login-otp-step" class="hidden-section">
                        <label class="text-sm font-semibold text-gray-700">OTP ‡¶ï‡ßã‡¶°</label>
                        <input type="text" id="login-otp-input" placeholder="6-digit" class="w-full px-4 py-3 border rounded-lg mt-1 text-center tracking-widest">
                        <button id="login-verify-otp" class="w-full bg-primary text-white py-3 rounded-xl mt-5 font-bold">‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                </div>
                <!-- login email -->
                <div id="login-email-div" class="hidden-section space-y-3">
                    <input type="email" id="login-email" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤" class="w-full px-4 py-3 border rounded-xl">
                    <input type="password" id="login-password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°" class="w-full px-4 py-3 border rounded-xl">
                    <button id="login-email-btn" class="w-full bg-primary text-white py-3 rounded-xl font-bold">‡¶≤‡¶ó‡¶á‡¶®</button>
                </div>
            </div>

            <!-- register container -->
            <div id="register-container" class="hidden-section mt-6 space-y-4">
                <div class="flex border-b">
                    <button id="reg-phone-tab" class="w-1/2 py-2 text-center font-semibold border-b-3 border-primary text-primary">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</button>
                    <button id="reg-email-tab" class="w-1/2 py-2 text-center font-semibold text-gray-500">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</button>
                </div>
                <!-- register phone -->
                <div id="reg-phone-div">
                    <div id="reg-phone-step1">
                        <label class="text-sm font-semibold">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ (OTP)</label>
                        <div class="flex"><span class="bg-gray-100 border px-3 py-3 rounded-l-lg">+88</span><input type="tel" id="reg-phone" placeholder="01XXX..." class="w-full border p-3 rounded-r-lg"></div>
                        <button id="reg-send-otp" class="w-full bg-primary text-white py-3 rounded-xl mt-4">OTP ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
                    </div>
                    <div id="reg-otp-step" class="hidden-section">
                        <input type="text" id="reg-otp" placeholder="OTP" class="w-full border p-3 rounded-lg text-center">
                        <button id="reg-verify-otp" class="w-full bg-primary text-white py-3 mt-4 rounded-xl">‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á</button>
                    </div>
                </div>
                <!-- register email -->
                <div id="reg-email-div" class="hidden-section space-y-3">
                    <input type="email" id="reg-email" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤" class="w-full p-3 border rounded-xl">
                    <input type="password" id="reg-password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° (6+)" class="w-full p-3 border rounded-xl">
                    <button id="reg-email-btn" class="w-full bg-primary text-white py-3 rounded-xl">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</button>
                </div>
                <p class="text-xs text-gray-500 text-center">OTP ‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            </div>
        </div>
        <div id="recaptcha-container" class="invisible"></div>
    </div>

    <!-- SETUP SECTION (profile after auth) -->
    <div id="setup-section" class="hidden-section flex flex-col min-h-screen bg-gradient-to-br from-green-50 to-white">
        <div class="bg-primary/90 text-white p-7 rounded-b-[40px] shadow-xl text-center">
            <h2 class="text-3xl font-black">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø</h2>
            <p class="opacity-90">‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡ßü‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßã‡¶®</p>
        </div>
        <div class="px-5 py-6 space-y-5 overflow-auto">
            <!-- profile image upload with overlay -->
            <div class="flex flex-col items-center">
                <div class="avatar-edit-overlay" onclick="document.getElementById('setup-avatar-input').click()">
                    <img id="setup-avatar-preview" class="avatar-preview" src="https://res.cloudinary.com/dwnpdwnvc/image/upload/v1739876543/default_avatar_jkly7r.png" alt="avatar">
                </div>
                <label for="setup-avatar-input" class="mt-2 bg-gray-200 px-4 py-1 rounded-full text-sm font-bold cursor-pointer"><i class="fas fa-camera"></i> ‡¶õ‡¶¨‡¶ø ‡¶§‡ßÅ‡¶≤‡ßÅ‡¶®</label>
                <input type="file" id="setup-avatar-input" accept="image/*" class="hidden">
            </div>
            <input type="text" id="setup-name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ *" class="w-full p-3 border rounded-xl">
            <input type="text" id="setup-phone" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ (‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶õ‡ßá‡ßú‡ßá ‡¶¶‡¶ø‡¶®)" class="w-full p-3 border rounded-xl" readonly hidden> 
            <input type="text" id="setup-profession" placeholder="‡¶™‡ßá‡¶∂‡¶æ (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶ï‡ßÉ‡¶∑‡¶ï, ‡¶ó‡ßÉ‡¶π‡¶ø‡¶£‡ßÄ)" class="w-full p-3 border rounded-xl">
            <div class="grid grid-cols-2 gap-3">
                <select id="setup-blood" class="w-full p-3 border rounded-xl bg-white"><option value="">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</option><option>A+</option><option>A-</option><option>B+</option><option>B-</option><option>O+</option><option>O-</option><option>AB+</option><option>AB-</option></select>
                <input type="text" id="setup-para" placeholder="‡¶™‡¶æ‡ßú‡¶æ *" class="w-full p-3 border rounded-xl">
            </div>
            <!-- social links -->
            <div class="bg-gray-100 p-4 rounded-2xl space-y-3">
                <p class="font-bold text-sm flex items-center"><i class="fab fa-facebook text-blue-600 mr-2"></i> ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶ú‡¶ø‡¶ï ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</p>
                <input type="text" id="setup-fb" placeholder="Facebook username ‡¶¨‡¶æ ‡¶≤‡¶ø‡¶Ç‡¶ï" class="w-full p-2 border rounded-lg text-sm">
                <input type="text" id="setup-wa" placeholder="WhatsApp ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (‡¶∏‡¶π +‡ßÆ‡ßÆ‡ß¶)" class="w-full p-2 border rounded-lg text-sm">
                <input type="text" id="setup-tg" placeholder="Telegram username" class="w-full p-2 border rounded-lg text-sm">
            </div>
            <button id="btn-save-profile" class="w-full bg-gradient-to-r from-primary to-secondary text-white py-4 rounded-xl text-xl font-bold shadow-xl hover:scale-[1.02] transition"><i class="fas fa-check-circle mr-2"></i> ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="main-app" class="hidden-section flex flex-col h-full relative">
        <header class="absolute top-0 w-full text-white px-4 py-3 flex items-center justify-between z-40 shadow-lg" style="background: linear-gradient(135deg, var(--primary-color, #16a34a), var(--secondary-color, #15803d));">
            <h2 class="text-xl font-bold flex items-center"><i class="fas fa-leaf mr-2 drop-shadow"></i> ‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ</h2>
            <div class="relative w-1/2"><input type="text" placeholder="‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." class="w-full bg-white/20 text-white placeholder-white/70 px-4 py-1.5 rounded-full text-sm border border-white/30"></div>
        </header>

        <main class="content-area bg-gray-100 relative" id="main-content-area">
            <!-- HOME -->
            <div id="tab-home" class="p-4 page-tab space-y-4">
                <div class="bg-white rounded-2xl p-4 shadow-sm flex items-center justify-between border-l-8 border-primary"><div><span class="text-gray-500 text-xs">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ</span><h3 class="text-xl font-bold text-gray-800" id="welcome-name">---</h3></div><img id="home-avatar" class="w-14 h-14 rounded-full border-2 border-primary object-cover" src="https://res.cloudinary.com/dwnpdwnvc/image/upload/v1739876543/default_avatar_jkly7r.png"></div>
                <!-- banner slider (enhanced) -->
                <div class="slider-wrapper rounded-2xl shadow-lg bg-white" id="banner-slider">
                    <div id="banner-track" class="slider-track"></div>
                    <div id="banner-dots" class="absolute bottom-2 left-0 right-0 flex justify-center space-x-2"></div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white p-4 rounded-xl flex items-center space-x-3 shadow-md"><div class="w-12 h-12 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xl"><i class="fas fa-users"></i></div><div><h5 class="text-xs text-gray-500">‡¶Æ‡ßã‡¶ü ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</h5><p id="total-users-count" class="text-2xl font-black text-gray-800">0</p></div></div>
                    <div class="bg-white p-4 rounded-xl flex items-center space-x-3 shadow-md"><div class="w-12 h-12 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center"><i class="fas fa-mosque text-xl"></i></div><div><h5 class="text-xs">‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶</h5><p class="text-2xl font-black">‡ß© ‡¶ü‡¶ø</p></div></div>
                </div>
            </div>

            <!-- VILLAGERS -->
            <div id="tab-villagers" class="hidden-section p-4 page-tab"><input type="text" id="search-villager" placeholder="‡¶®‡¶æ‡¶Æ, ‡¶™‡ßá‡¶∂‡¶æ, ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" class="w-full p-3 rounded-xl border mb-4"><div id="villagers-list" class="space-y-2"></div></div>

            <!-- SERVICES (icons updated) -->
            <div id="tab-services" class="hidden-section p-4 page-tab">
                <h3 class="text-xl font-bold text-center mb-5">üìã ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶∏‡ßá‡¶¨‡¶æ</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-xl shadow-md text-center"><i class="fas fa-ambulance text-3xl text-red-500 mb-2"></i><p class="font-bold">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡ßç‡¶¨‡ßÅ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><p class="text-sm">‡ß¶‡ßß‡ß≠‡ßß‡ßß-‡ß®‡ß®‡ß©‡ß©‡ß™‡ß™</p></div>
                    <div class="bg-white p-4 rounded-xl shadow-md text-center"><i class="fas fa-fire-extinguisher text-3xl text-orange-600 mb-2"></i><p class="font-bold">‡¶´‡¶æ‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏</p><p class="text-sm">‡ß¶‡ßß‡ßÆ‡ßß‡ß®-‡ß©‡ß©‡ß™‡ß™‡ß´‡ß´</p></div>
                    <div class="bg-white p-4 rounded-xl shadow-md text-center"><i class="fas fa-hand-holding-heart text-3xl text-pink-600 mb-2"></i><p class="font-bold">‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®</p><p class="text-sm">‡ß¶‡ßß‡ßØ‡ßØ‡ßØ-‡ßÆ‡ßÆ‡ß≠‡ß≠‡ß¨‡ß¨</p></div>
                    <div class="bg-white p-4 rounded-xl shadow-md text-center"><i class="fas fa-gavel text-3xl text-purple-700 mb-2"></i><p class="font-bold">‡¶Æ‡¶ß‡ßç‡¶Ø‡¶∏‡ßç‡¶•‡¶§‡¶æ</p><p class="text-sm">‡ß¶‡ßß‡ß≠‡ß®‡ß®-‡ßØ‡ßØ‡ßÆ‡ßÆ‡ß≠‡ß≠</p></div>
                </div>
            </div>

            <!-- NOTICE -->
            <div id="tab-notice" class="hidden-section p-4 page-tab"><h3 class="font-bold text-xl mb-4 flex items-center"><i class="fas fa-bullhorn text-primary mr-2"></i> ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¨‡ßã‡¶∞‡ßç‡¶°</h3><div id="notice-board" class="space-y-3"></div></div>

            <!-- PROFILE (enhanced) -->
            <div id="tab-profile" class="hidden-section p-4 page-tab">
                <div class="bg-white rounded-3xl p-5 text-center relative shadow-xl">
                    <div class="relative inline-block">
                        <img id="prof-avatar" class="w-28 h-28 rounded-full mx-auto border-4 border-white shadow-xl object-cover" src="">
                        <button id="edit-avatar-btn" class="absolute bottom-0 right-0 bg-primary text-white rounded-full p-2 text-xs border-2 border-white"><i class="fas fa-camera"></i></button>
                    </div>
                    <h2 id="prof-name" class="text-2xl font-bold mt-2">---</h2>
                    <p id="prof-profession" class="text-primary font-semibold">---</p>
                    <p id="prof-para" class="text-gray-500"><i class="fas fa-map-marker-alt mr-1"></i>---</p>
                    <div class="flex justify-center space-x-4 my-3">
                        <a href="#" id="prof-fb" target="_blank" class="text-blue-600 text-2xl hidden"><i class="fab fa-facebook"></i></a>
                        <a href="#" id="prof-wa" target="_blank" class="text-green-600 text-2xl hidden"><i class="fab fa-whatsapp"></i></a>
                        <a href="#" id="prof-tg" target="_blank" class="text-sky-500 text-2xl hidden"><i class="fab fa-telegram"></i></a>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mt-4"><div class="bg-gray-100 p-3 rounded-xl"><i class="fas fa-tint text-red-500"></i> <span id="prof-blood">---</span></div><div class="bg-gray-100 p-3 rounded-xl truncate"><i class="fas fa-phone-alt"></i> <span id="prof-phone">---</span></div></div>
                    <button id="btn-edit-profile" class="mt-5 w-full bg-blue-50 text-blue-600 py-3 rounded-xl font-bold border"><i class="fas fa-pen mr-2"></i>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü</button>
                    <button id="btn-logout" class="w-full bg-red-50 text-red-500 py-3 rounded-xl font-bold mt-3"><i class="fas fa-sign-out-alt mr-2"></i>‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
                </div>
            </div>

            <!-- ADMIN PANEL (expanded with all features) -->
            <div id="tab-admin" class="hidden-section p-4 page-tab space-y-5">
                <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white p-5 rounded-2xl shadow-2xl"><h2 class="text-2xl font-bold"><i class="fas fa-user-shield mr-2"></i>‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2></div>

                <!-- banner upload with cloudinary -->
                <div class="bg-white p-4 rounded-xl shadow"><h4 class="font-bold mb-2 flex items-center"><i class="fas fa-images text-primary mr-2"></i> ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</h4>
                    <input type="file" id="admin-banner-file" accept="image/*" class="mb-2 w-full text-sm">
                    <img id="admin-banner-preview" class="h-20 rounded-lg mb-2 hidden object-cover">
                    <button id="btn-upload-banner" class="bg-primary text-white p-2 rounded w-full hover:bg-secondary transition"><i class="fas fa-cloud-upload-alt mr-2"></i>‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶°‡¶ø‡¶®‡¶æ‡¶∞‡¶ø‡¶§‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ì ‡¶∏‡ßá‡¶≠</button>
                </div>

                <!-- user manage -->
                <div class="bg-white p-4 rounded-xl shadow"><h4 class="font-bold mb-2"><i class="fas fa-users-cog mr-2 text-primary"></i>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú</h4>
                    <input type="text" id="admin-user-search" placeholder="‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." class="w-full p-2 border rounded mb-2">
                    <div id="admin-user-list" class="max-h-60 overflow-y-auto space-y-2 text-sm"></div>
                </div>

                <!-- notice post with image -->
                <div class="bg-white p-4 rounded-xl shadow"><h4 class="font-bold mb-2"><i class="fas fa-bullhorn mr-2 text-primary"></i>‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ (‡¶õ‡¶¨‡¶ø ‡¶∏‡¶π)</h4>
                    <input type="text" id="admin-notice-title" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ" class="w-full p-2 border rounded mt-2">
                    <textarea id="admin-notice-body" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§..." class="w-full p-2 border rounded mt-2"></textarea>
                    <div class="flex items-center mt-2"><input type="file" id="admin-notice-image" accept="image/*" class="text-sm"><img id="admin-notice-preview" class="h-10 w-10 rounded ml-2 hidden object-cover"></div>
                    <button id="btn-post-notice" class="bg-primary text-white p-2 rounded w-full mt-3"><i class="fas fa-paper-plane mr-2"></i>‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>

                <!-- theme color premium gradients -->
                <div class="bg-white p-4 rounded-xl shadow"><h4 class="font-bold mb-2"><i class="fas fa-palette mr-2 text-primary"></i>‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡ßü‡¶æ‡¶Æ ‡¶•‡¶ø‡¶Æ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞</h4>
                    <div class="flex flex-wrap gap-3 mt-2" id="theme-color-palette">
                        <button class="w-10 h-10 rounded-full shadow-md transition-transform hover:scale-110" style="background: linear-gradient(145deg, #16a34a, #15803d);" data-primary="#16a34a" data-secondary="#15803d"></button>
                        <button class="w-10 h-10 rounded-full shadow-md hover:scale-110" style="background: linear-gradient(145deg, #2563eb, #1d4ed8);" data-primary="#2563eb" data-secondary="#1d4ed8"></button>
                        <button class="w-10 h-10 rounded-full shadow-md hover:scale-110" style="background: linear-gradient(145deg, #b45309, #92400e);" data-primary="#b45309" data-secondary="#92400e"></button>
                        <button class="w-10 h-10 rounded-full shadow-md hover:scale-110" style="background: linear-gradient(145deg, #6d28d9, #5b21b6);" data-primary="#6d28d9" data-secondary="#5b21b6"></button>
                        <button class="w-10 h-10 rounded-full shadow-md hover:scale-110" style="background: linear-gradient(145deg, #be123c, #9f1239);" data-primary="#be123c" data-secondary="#9f1239"></button>
                        <button class="w-10 h-10 rounded-full shadow-md hover:scale-110" style="background: linear-gradient(145deg, #0f766e, #115e59);" data-primary="#0f766e" data-secondary="#115e59"></button>
                    </div>
                </div>
            </div>
        </main>

        <!-- bottom nav (premium) -->
        <nav class="absolute bottom-0 w-full bg-white/90 backdrop-blur-lg shadow-[0_-5px_20px_rgba(0,0,0,0.1)] flex justify-around items-center px-2 py-2 z-40 rounded-t-3xl border-t border-white/50">
            <button class="nav-btn text-gray-500 hover:text-primary transition-colors" data-tab="home"><i class="fas fa-home text-xl"></i><span class="text-xs block">‡¶π‡ßã‡¶Æ</span></button>
            <button class="nav-btn text-gray-500 hover:text-primary" data-tab="villagers"><i class="fas fa-users text-xl"></i><span class="text-xs block">‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ</span></button>
            <button class="nav-btn text-gray-500 hover:text-primary" data-tab="services"><i class="fas fa-hand-holding-heart text-xl"></i><span class="text-xs block">‡¶∏‡ßá‡¶¨‡¶æ</span></button>
            <button class="nav-btn text-gray-500 hover:text-primary" data-tab="notice"><i class="fas fa-bullhorn text-xl"></i><span class="text-xs block">‡¶®‡ßã‡¶ü‡¶ø‡¶∂</span></button>
            <button class="nav-btn text-gray-500 hover:text-primary" data-tab="profile"><i class="fas fa-user text-xl"></i><span class="text-xs block">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</span></button>
            <button class="nav-btn text-gray-500 hover:text-primary hidden" id="admin-tab-btn" data-tab="admin"><i class="fas fa-shield-alt text-xl"></i><span class="text-xs block">‡¶è‡¶°‡¶Æ‡¶ø‡¶®</span></button>
        </nav>
    </div>

    <!-- modals: edit profile (enhanced), villager details, success -->
    <div id="edit-profile-modal" class="fixed inset-0 modal-overlay flex items-center justify-center p-4">
        <div class="modal-content bg-white w-full max-w-sm rounded-3xl p-5 max-h-[90vh] overflow-auto">
            <h3 class="font-bold text-xl flex items-center"><i class="fas fa-pen text-primary mr-2"></i>‡¶è‡¶°‡¶ø‡¶ü ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h3>
            <div class="flex flex-col items-center my-3">
                <div class="relative">
                    <img id="edit-avatar-preview" class="w-20 h-20 rounded-full border-4 border-primary object-cover" src="">
                    <button id="edit-avatar-btn" class="absolute bottom-0 right-0 bg-primary text-white rounded-full p-1 text-xs border-2 border-white"><i class="fas fa-camera"></i></button>
                </div>
                <input type="file" id="edit-avatar-input" accept="image/*" class="hidden">
            </div>
            <input type="text" id="edit-name" placeholder="‡¶®‡¶æ‡¶Æ" class="w-full p-2 border rounded mt-2">
            <input type="text" id="edit-prof" placeholder="‡¶™‡ßá‡¶∂‡¶æ" class="w-full p-2 border rounded mt-2">
            <select id="edit-blood" class="w-full p-2 border rounded mt-2"><option>A+</option><option>A-</option><option>B+</option><option>B-</option><option>O+</option><option>O-</option><option>AB+</option><option>AB-</option></select>
            <input type="text" id="edit-para" placeholder="‡¶™‡¶æ‡ßú‡¶æ" class="w-full p-2 border rounded mt-2">
            <input type="text" id="edit-fb" placeholder="Facebook link" class="w-full p-2 border rounded mt-2">
            <input type="text" id="edit-wa" placeholder="WhatsApp number" class="w-full p-2 border rounded mt-2">
            <input type="text" id="edit-tg" placeholder="Telegram username" class="w-full p-2 border rounded mt-2">
            <button id="save-edit" class="bg-primary text-white w-full py-3 mt-4 rounded-xl font-bold"><i class="fas fa-save mr-2"></i>‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>
    <div id="villager-modal" class="fixed inset-0 modal-overlay flex items-center justify-center p-4"><div class="modal-content bg-white rounded-3xl p-5 w-full max-w-sm"><div id="v-details"></div></div></div>
    <div id="success-modal" class="fixed inset-0 modal-overlay flex items-center justify-center"><div class="modal-content bg-white p-6 rounded-3xl text-center shadow-2xl"><i class="fas fa-check-circle text-5xl text-green-500"></i><p class="text-xl font-bold mt-2">‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!</p></div></div>
</div>

<script type="module">
    // Firebase & cloudinary config
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getAuth, RecaptchaVerifier, signInWithPhoneNumber, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, getDocs, collection, addDoc, updateDoc, deleteDoc, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = { apiKey:"AIzaSyAuqcDRrtuQi2tdWXA2E_UWyq7pCrGpoy4", authDomain:"parkhali-village.firebaseapp.com", projectId:"parkhali-village", storageBucket:"parkhali-village.firebasestorage.app", messagingSenderId:"645968583344", appId:"1:645968583344:web:89a049e6ffaba4af33b975" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const cloudName = 'dwnpdwnvc', uploadPreset = 'Parkhali';

    // global vars
    let currentUserData = null, allVillagers = [], confirmationResult = null, isAdmin = false;

    // helpers
    const showLoader = (show) => document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none';
    const showSection = (id) => ['auth-section','setup-section','main-app'].forEach(s => document.getElementById(s).classList.add('hidden-section')) || document.getElementById(id).classList.remove('hidden-section');
    const openModal = (id) => document.getElementById(id).classList.add('active');
    const closeModal = (id) => document.getElementById(id).classList.remove('active');
    const showSuccess = () => { openModal('success-modal'); setTimeout(()=> closeModal('success-modal'), 1500); };

    // cloudinary upload
    async function uploadToCloudinary(file) {
        const formData = new FormData(); formData.append('file', file); formData.append('upload_preset', uploadPreset);
        const res = await axios.post(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, formData);
        return res.data.secure_url;
    }

    // apply theme
    function applyTheme(primary, secondary) {
        document.documentElement.style.setProperty('--primary-color', primary || '#16a34a');
        document.documentElement.style.setProperty('--secondary-color', secondary || '#15803d');
        document.querySelectorAll('header, .bg-primary, .from-primary, .to-secondary').forEach(el => { /* handled by variables */ });
    }

    // fetch theme from firestore
    async function loadTheme() {
        const themeRef = doc(db, 'settings', 'theme');
        const snap = await getDoc(themeRef);
        if(snap.exists()) {
            applyTheme(snap.data().primary, snap.data().secondary);
        } else {
            applyTheme('#16a34a', '#15803d');
        }
    }

    // splash & auth listener
    window.onload = () => {
        document.querySelectorAll('.letter').forEach((l,i)=> setTimeout(()=> l.classList.add('animate-letter'), i*150));
        setTimeout(() => {
            onAuthStateChanged(auth, async (user) => {
                document.getElementById('splash-screen').classList.add('hidden-section');
                await loadTheme();
                if (user) { 
                    const ref = doc(db,'users',user.uid); const snap = await getDoc(ref);
                    if(snap.exists()) { 
                        currentUserData = snap.data(); 
                        isAdmin = currentUserData.email === 'admin@parkhali.com' || currentUserData.isAdmin === true; // demo admin
                        setupMainApp(user, currentUserData); 
                        showSection('main-app'); 
                        switchTab('home');
                        if(isAdmin) document.getElementById('admin-tab-btn').classList.remove('hidden');
                    } else { 
                        if(user.phoneNumber) document.getElementById('setup-phone').value = user.phoneNumber;
                        showSection('setup-section'); 
                    }
                } else showSection('auth-section');
            });
        }, 2500);
    };

    // auth tabs toggle
    document.getElementById('auth-toggle-login').addEventListener('click',()=>{ 
        document.getElementById('auth-toggle-login').classList.add('bg-white','text-primary'); 
        document.getElementById('auth-toggle-register').classList.remove('bg-white','text-primary'); 
        document.getElementById('login-container').classList.remove('hidden-section'); 
        document.getElementById('register-container').classList.add('hidden-section'); 
    });
    document.getElementById('auth-toggle-register').addEventListener('click',()=>{ 
        document.getElementById('auth-toggle-register').classList.add('bg-white','text-primary'); 
        document.getElementById('auth-toggle-login').classList.remove('bg-white','text-primary'); 
        document.getElementById('register-container').classList.remove('hidden-section'); 
        document.getElementById('login-container').classList.add('hidden-section'); 
    });

    // recaptcha
    window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', { size: 'invisible' });

    // login phone
    document.getElementById('login-send-otp').addEventListener('click', async ()=>{
        let p = document.getElementById('login-phone-input').value; if(p.startsWith('0')) p = p.substring(1);
        showLoader(true);
        try { confirmationResult = await signInWithPhoneNumber(auth, '+880'+p, window.recaptchaVerifier); showLoader(false); document.getElementById('login-phone-step1').classList.add('hidden-section'); document.getElementById('login-otp-step').classList.remove('hidden-section'); } 
        catch(e){ alert('OTP error:'+e.message); showLoader(false); }
    });
    document.getElementById('login-verify-otp').addEventListener('click', async ()=>{
        showLoader(true); try { await confirmationResult.confirm(document.getElementById('login-otp-input').value); showSuccess(); } catch(e){ alert('‡¶≠‡ßÅ‡¶≤ OTP'); showLoader(false); }
    });

    // login email
    document.getElementById('login-email-btn').addEventListener('click', async ()=>{
        showLoader(true); try { await signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-password').value); showSuccess(); } catch(e){ alert('‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø'); showLoader(false); }
    });

    // register phone
    document.getElementById('reg-send-otp').addEventListener('click', async ()=>{
        let p = document.getElementById('reg-phone').value; if(p.startsWith('0')) p = p.substring(1);
        showLoader(true); try { confirmationResult = await signInWithPhoneNumber(auth, '+880'+p, window.recaptchaVerifier); showLoader(false); document.getElementById('reg-phone-step1').classList.add('hidden-section'); document.getElementById('reg-otp-step').classList.remove('hidden-section'); } catch(e){ alert(e.message); showLoader(false); }
    });
    document.getElementById('reg-verify-otp').addEventListener('click', async ()=>{
        showLoader(true); try { await confirmationResult.confirm(document.getElementById('reg-otp').value); showSuccess(); } catch(e){ alert('‡¶≠‡ßÅ‡¶≤ OTP'); showLoader(false); }
    });

    // register email
    document.getElementById('reg-email-btn').addEventListener('click', async ()=>{
        const email = document.getElementById('reg-email').value, pass = document.getElementById('reg-password').value;
        if(pass.length<6) return alert('‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞');
        showLoader(true); try { await createUserWithEmailAndPassword(auth, email, pass); showSuccess(); } catch(e){ alert(e.message); showLoader(false); }
    });

    // setup profile
    document.getElementById('setup-avatar-input').addEventListener('change', function(e){
        const file = e.target.files[0]; if(file){ const reader = new FileReader(); reader.onload = (ev)=> document.getElementById('setup-avatar-preview').src = ev.target.result; reader.readAsDataURL(file); }
    });

    document.getElementById('btn-save-profile').addEventListener('click', async ()=>{
        const name = document.getElementById('setup-name').value, profession = document.getElementById('setup-profession').value, blood = document.getElementById('setup-blood').value, para = document.getElementById('setup-para').value;
        if(!name || !profession || !para) return alert('‡¶®‡¶æ‡¶Æ, ‡¶™‡ßá‡¶∂‡¶æ, ‡¶™‡¶æ‡ßú‡¶æ ‡¶¶‡¶ø‡¶®');
        showLoader(true);
        let photoURL = document.getElementById('setup-avatar-preview').src;
        if(document.getElementById('setup-avatar-input').files.length>0){
            photoURL = await uploadToCloudinary(document.getElementById('setup-avatar-input').files[0]);
        }
        const fb = document.getElementById('setup-fb').value, wa = document.getElementById('setup-wa').value, tg = document.getElementById('setup-tg').value;
        await setDoc(doc(db,'users', auth.currentUser.uid), { uid: auth.currentUser.uid, email: auth.currentUser.email||'', name, phone: auth.currentUser.phoneNumber||'', profession, blood, para, photoURL, facebook: fb, whatsapp: wa, telegram: tg, joined: new Date().toISOString(), banned: false });
        showLoader(false); showSuccess(); setTimeout(()=> location.reload(), 1500);
    });

    // main app setup
    function setupMainApp(user, data) {
        document.getElementById('welcome-name').innerText = data.name || '‡¶™‡ßç‡¶∞‡¶ø‡ßü ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø';
        document.getElementById('home-avatar').src = data.photoURL || 'https://res.cloudinary.com/dwnpdwnvc/image/upload/v1739876543/default_avatar_jkly7r.png';
        document.getElementById('prof-avatar').src = data.photoURL || '';
        document.getElementById('prof-name').innerText = data.name || '';
        document.getElementById('prof-profession').innerText = data.profession || '';
        document.getElementById('prof-para').innerText = data.para || '';
        document.getElementById('prof-blood').innerText = data.blood || '';
        document.getElementById('prof-phone').innerText = data.phone || '';
        if(data.facebook) { document.getElementById('prof-fb').href = data.facebook; document.getElementById('prof-fb').classList.remove('hidden'); }
        if(data.whatsapp) { document.getElementById('prof-wa').href = 'https://wa.me/'+data.whatsapp; document.getElementById('prof-wa').classList.remove('hidden'); }
        if(data.telegram) { document.getElementById('prof-tg').href = 'https://t.me/'+data.telegram; document.getElementById('prof-tg').classList.remove('hidden'); }
        loadAllVillagers();
        loadBanners();
        loadNotices();
    }

    // switch tabs
    function switchTab(tabId) {
        document.querySelectorAll('.page-tab').forEach(t => t.classList.add('hidden-section'));
        document.getElementById(`tab-${tabId}`).classList.remove('hidden-section');
    }
    document.querySelectorAll('.nav-btn').forEach(btn => btn.addEventListener('click', (e) => switchTab(btn.dataset.tab)));

    // load villagers
    async function loadAllVillagers() {
        const snap = await getDocs(collection(db,'users'));
        allVillagers = snap.docs.map(d=>d.data());
        document.getElementById('total-users-count').innerText = allVillagers.length;
        renderVillagers(allVillagers);
        if(isAdmin) renderAdminUserList(allVillagers);
    }
    function renderVillagers(list) {
        const container = document.getElementById('villagers-list');
        container.innerHTML = list.map(v => `<div class="bg-white p-3 rounded-xl flex items-center space-x-3 shadow-sm"><img src="${v.photoURL||'default'}" class="w-12 h-12 rounded-full"><div><p class="font-bold">${v.name}</p><p class="text-sm">${v.profession} ‚Ä¢ ${v.para}</p></div></div>`).join('');
    }
    document.getElementById('search-villager').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = allVillagers.filter(v => v.name?.toLowerCase().includes(term) || v.profession?.toLowerCase().includes(term) || v.phone?.includes(term));
        renderVillagers(filtered);
    });

    // banners
    async function loadBanners() {
        const snap = await getDocs(collection(db, 'banners'));
        const banners = snap.docs.map(d => d.data().url);
        const track = document.getElementById('banner-track');
        const dots = document.getElementById('banner-dots');
        if(banners.length===0) { track.innerHTML = '<div class="slider-slide" style="background-image: url(\'https://res.cloudinary.com/dwnpdwnvc/image/upload/v1739876543/default_banner.jpg\')"></div>'; return; }
        track.innerHTML = banners.map(url => `<div class="slider-slide" style="background-image: url('${url}')"></div>`).join('');
        dots.innerHTML = banners.map((_,i) => `<span class="slider-dot" data-index="${i}"></span>`).join('');
        let current = 0;
        setInterval(() => { current = (current+1)%banners.length; track.style.transform = `translateX(-${current*100}%)`; document.querySelectorAll('.slider-dot').forEach((d,i)=> d.classList.toggle('active', i===current)); }, 4000);
    }

    // admin upload banner
    document.getElementById('admin-banner-file').addEventListener('change', function(e){
        const file = e.target.files[0]; if(file){ const reader = new FileReader(); reader.onload = (ev)=> { document.getElementById('admin-banner-preview').src = ev.target.result; document.getElementById('admin-banner-preview').classList.remove('hidden'); }; reader.readAsDataURL(file); }
    });
    document.getElementById('btn-upload-banner').addEventListener('click', async ()=>{
        const file = document.getElementById('admin-banner-file').files[0];
        if(!file) return alert('‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
        showLoader(true);
        const url = await uploadToCloudinary(file);
        await addDoc(collection(db, 'banners'), { url, uploadedAt: new Date() });
        showLoader(false); showSuccess();
        loadBanners();
    });

    // notices with image
    document.getElementById('admin-notice-image').addEventListener('change', function(e){
        const file = e.target.files[0]; if(file){ const reader = new FileReader(); reader.onload = (ev)=> { document.getElementById('admin-notice-preview').src = ev.target.result; document.getElementById('admin-notice-preview').classList.remove('hidden'); }; reader.readAsDataURL(file); }
    });
    document.getElementById('btn-post-notice').addEventListener('click', async ()=>{
        const title = document.getElementById('admin-notice-title').value;
        const body = document.getElementById('admin-notice-body').value;
        const file = document.getElementById('admin-notice-image').files[0];
        if(!title || !body) return alert('‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶¶‡¶ø‡¶®');
        showLoader(true);
        let imageUrl = '';
        if(file) imageUrl = await uploadToCloudinary(file);
        await addDoc(collection(db, 'notices'), { title, body, imageUrl, time: new Date().toISOString() });
        showLoader(false); showSuccess();
        loadNotices();
    });

    async function loadNotices() {
        const snap = await getDocs(collection(db, 'notices'));
        const container = document.getElementById('notice-board');
        container.innerHTML = snap.docs.map(d => {
            const n = d.data();
            return `<div class="bg-white p-4 rounded-xl shadow"><h4 class="font-bold">üìå ${n.title}</h4><p class="text-sm">${n.body}</p>${n.imageUrl ? `<img src="${n.imageUrl}" class="mt-2 rounded-lg max-h-32 object-cover">` : ''}<span class="text-xs text-gray-400">${new Date(n.time).toLocaleDateString('bn')}</span></div>`;
        }).join('');
    }

    // theme change
    document.querySelectorAll('#theme-color-palette button').forEach(btn => btn.addEventListener('click', async function(){
        const primary = this.dataset.primary;
        const secondary = this.dataset.secondary;
        applyTheme(primary, secondary);
        await setDoc(doc(db, 'settings', 'theme'), { primary, secondary });
        showSuccess();
    }));

    // edit profile modal
    document.getElementById('btn-edit-profile').addEventListener('click', ()=>{
        document.getElementById('edit-name').value = currentUserData.name || '';
        document.getElementById('edit-prof').value = currentUserData.profession || '';
        document.getElementById('edit-blood').value = currentUserData.blood || '';
        document.getElementById('edit-para').value = currentUserData.para || '';
        document.getElementById('edit-fb').value = currentUserData.facebook || '';
        document.getElementById('edit-wa').value = currentUserData.whatsapp || '';
        document.getElementById('edit-tg').value = currentUserData.telegram || '';
        document.getElementById('edit-avatar-preview').src = currentUserData.photoURL || '';
        openModal('edit-profile-modal');
    });
    document.getElementById('edit-avatar-btn').addEventListener('click', ()=> document.getElementById('edit-avatar-input').click());
    document.getElementById('edit-avatar-input').addEventListener('change', function(e){
        const file = e.target.files[0]; if(file){ const reader = new FileReader(); reader.onload = (ev)=> document.getElementById('edit-avatar-preview').src = ev.target.result; reader.readAsDataURL(file); }
    });
    document.getElementById('save-edit').addEventListener('click', async ()=>{
        showLoader(true);
        let photoURL = document.getElementById('edit-avatar-preview').src;
        if(document.getElementById('edit-avatar-input').files.length>0){
            photoURL = await uploadToCloudinary(document.getElementById('edit-avatar-input').files[0]);
        }
        const updates = {
            name: document.getElementById('edit-name').value,
            profession: document.getElementById('edit-prof').value,
            blood: document.getElementById('edit-blood').value,
            para: document.getElementById('edit-para').value,
            facebook: document.getElementById('edit-fb').value,
            whatsapp: document.getElementById('edit-wa').value,
            telegram: document.getElementById('edit-tg').value,
            photoURL
        };
        await updateDoc(doc(db, 'users', auth.currentUser.uid), updates);
        showLoader(false); showSuccess(); closeModal('edit-profile-modal'); location.reload();
    });

    // logout
    document.getElementById('btn-logout').addEventListener('click', async ()=>{ await signOut(auth); location.reload(); });

    // admin user list (simplified)
    async function renderAdminUserList(users) {
        const container = document.getElementById('admin-user-list');
        container.innerHTML = users.map(u => `<div class="flex justify-between items-center border-b pb-1"><span>${u.name} (${u.phone})</span><div><button class="text-red-500 text-sm ban-user" data-uid="${u.uid}"><i class="fas fa-ban"></i></button></div></div>`).join('');
    }
    // pull to refresh
    let startY = 0; const content = document.getElementById('main-content-area');
    content.addEventListener('touchstart', (e)=> startY = e.touches[0].screenY);
    content.addEventListener('touchmove', (e)=>{ if(content.scrollTop===0 && e.touches[0].screenY - startY > 70) document.getElementById('ptr-indicator').style.height = '40px'; });
    content.addEventListener('touchend', (e)=>{ if(document.getElementById('ptr-indicator').style.height==='40px'){ location.reload(); } document.getElementById('ptr-indicator').style.height = '0'; });
</script>
</body>
</html>
