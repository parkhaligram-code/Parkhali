<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‚Äì ‡¶™‡ßç‡¶∞‡¶æ‡¶£‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Cloudinary upload widget (optional but helpful) -->
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>  
    <style>
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #f3f4f6; margin: 0; padding: 0; overflow-x: hidden; }
        .hidden-section { display: none !important; }
        :root { --primary: #16a34a; --secondary: #15803d; --accent: #facc15; }
        .bg-primary { background-color: var(--primary); }
        .text-primary { color: var(--primary); }
        .border-primary { border-color: var(--primary); }
        .hover\:bg-primary:hover { background-color: var(--primary); }
        .bg-secondary { background-color: var(--secondary); }
        .text-secondary { color: var(--secondary); }
        
        /* Splash Animation */
        .letter { display: inline-block; opacity: 0; transform: scale(0.5); font-size: 3.5rem; font-weight: bold; color: white; text-shadow: 2px 2px 10px rgba(0,0,0,0.2); }
        .animate-letter { animation: popIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes popIn { to { opacity: 1; transform: scale(1); } }

        /* Banner Slider */
        .slider-wrapper { aspect-ratio: 16/7; overflow: hidden; position: relative; width: 100%; border-radius: 0.5rem; }
        .slider-track { display: flex; transition: transform 0.5s ease-in-out; height: 100%; }
        .slide { min-width: 100%; height: 100%; object-fit: cover; cursor: pointer; }

        /* Modals */
        .modal-overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { transform: translateY(50px); transition: all 0.3s ease; }
        .modal-overlay.active .modal-content { transform: translateY(0); }

        /* Auth Tabs */
        .auth-tab-active { border-bottom: 3px solid var(--primary); color: var(--primary); font-weight: bold; }
        .auth-tab-inactive { color: #6b7280; }

        /* App Container & Bottom Nav */
        .app-container { max-width: 480px; margin: 0 auto; background: white; min-height: 100vh; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        .content-area { padding-bottom: 80px; padding-top: 60px; height: 100vh; overflow-y: auto; }
        .nav-center { transform: translateY(-25px); border: 5px solid #f3f4f6; }
        #loading-overlay { background: rgba(255,255,255,0.8); backdrop-filter: blur(4px); z-index: 2000; }

        /* Gradient themes preview */
        .gradient-option { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .gradient-option.selected { border-color: #000; transform: scale(1.1); }
    </style>
</head>
<body>
<div class="app-container relative">

    <!-- Splash Screen -->
    <div id="splash-screen" class="absolute inset-0 z-[3000] flex flex-col items-center justify-center bg-gradient-to-br from-[#16a34a] to-[#14532d]">
        <div class="w-24 h-24 bg-white/20 rounded-full flex items-center justify-center mb-6 animate-pulse">
            <i class="fas fa-leaf text-5xl text-white"></i>
        </div>
        <div id="splash-text" class="flex space-x-1">
            <span class="letter">‡¶™‡¶æ</span><span class="letter">‡¶∞</span><span class="letter">‡¶ñ‡¶æ</span><span class="letter">‡¶≤‡ßÄ</span>
        </div>
        <p class="text-white mt-4 opacity-90 text-lg tracking-wider">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶æ‡¶£‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</p>
    </div>

    <!-- Global Loader -->
    <div id="loading-overlay" class="hidden-section absolute inset-0 flex items-center justify-center bg-white/70 z-[2500]">
        <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-primary"></div>
    </div>

    <!-- Auth Section (Login/Register combined) -->
    <div id="auth-section" class="flex flex-col min-h-screen bg-gray-50">
        <div class="bg-primary pt-16 pb-8 px-6 text-center text-white rounded-b-3xl shadow-lg relative overflow-hidden">
            <div class="absolute inset-0 bg-black/10"></div>
            <div class="w-20 h-20 bg-white text-primary rounded-full flex items-center justify-center text-4xl mx-auto mb-4 shadow-lg animate-bounce"><i class="fas fa-home"></i></div>
            <h1 class="text-3xl font-bold relative z-10">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ</h1>
            <p class="opacity-80 mt-1 relative z-10">‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        </div>
        <div class="px-6 py-8 flex-grow">
            <div class="flex border-b mb-6 bg-white rounded-t-xl p-1 shadow-sm">
                <button id="tab-phone-auth" class="w-1/2 py-3 auth-tab-active text-lg transition">üì± ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</button>
                <button id="tab-email-auth" class="w-1/2 py-3 auth-tab-inactive text-lg transition">‚úâÔ∏è ‡¶á‡¶Æ‡ßá‡¶á‡¶≤</button>
            </div>

            <!-- Phone Auth Div -->
            <div id="auth-phone-div" class="space-y-4">
                <div id="phone-input-step" class="transition-all">
                    <label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                    <div class="flex">
                        <span class="inline-flex items-center px-3 bg-gray-100 border border-r-0 border-gray-300 rounded-l-lg text-gray-600 font-bold">+88</span>
                        <input type="tel" id="auth-phone" placeholder="01XXX-XXXXXX" class="w-full px-4 py-3 border border-gray-300 rounded-r-lg focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <button id="btn-send-otp" class="w-full bg-primary text-white rounded-lg py-3 mt-6 font-bold shadow-md hover:bg-secondary transition transform hover:scale-[1.02] active:scale-100"><i class="fas fa-paper-plane mr-2"></i>OTP ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
                </div>
                <div id="otp-input-step" class="hidden-section">
                    <label class="block text-gray-700 text-sm mb-1 font-semibold">OTP ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®</label>
                    <input type="number" id="auth-otp" placeholder="6-digit code" class="w-full px-4 py-3 rounded-lg border border-gray-300 text-center tracking-widest text-lg focus:outline-none focus:ring-2 focus:ring-primary">
                    <button id="btn-verify-otp" class="w-full bg-primary text-white rounded-lg py-3 mt-6 font-bold shadow-md hover:bg-secondary transition"><i class="fas fa-check-circle mr-2"></i>‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <!-- Email Auth Div -->
            <div id="auth-email-div" class="hidden-section space-y-4">
                <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label><input type="email" id="auth-email" placeholder="example@mail.com" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"></div>
                <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°</label><input type="password" id="auth-password" placeholder="******" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"></div>
                <div class="flex space-x-3 pt-2">
                    <button id="btn-login-email" class="w-1/2 bg-primary text-white rounded-lg py-3 font-bold shadow-md hover:bg-secondary transition">‡¶≤‡¶ó‡¶á‡¶®</button>
                    <button id="btn-register-email" class="w-1/2 bg-white text-primary border-2 border-primary rounded-lg py-3 font-bold hover:bg-gray-50 transition">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</button>
                </div>
            </div>
            <p class="text-xs text-gray-400 text-center mt-6">‡¶®‡¶§‡ßÅ‡¶® ‡¶π‡¶≤‡ßá ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤)</p>
        </div>
        <div id="recaptcha-container"></div>
    </div>

    <!-- Profile Setup Section (after first login) -->
    <div id="setup-section" class="hidden-section flex flex-col min-h-screen bg-white">
        <div class="bg-gradient-to-r from-primary to-secondary p-6 text-white text-center rounded-b-3xl shadow-lg">
            <h2 class="text-2xl font-bold mt-4">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <p class="opacity-90">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßã‡¶®</p>
        </div>
        <div class="px-6 py-8 space-y-4 overflow-y-auto">
            <!-- Profile image upload -->
            <div class="flex flex-col items-center mb-4">
                <div class="relative">
                    <div id="setup-profile-preview" class="w-28 h-28 rounded-full bg-gray-200 border-4 border-white shadow-md flex items-center justify-center text-gray-400 text-4xl overflow-hidden">
                        <i class="fas fa-user"></i>
                    </div>
                    <label for="setup-profile-upload" class="absolute bottom-0 right-0 bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center cursor-pointer shadow-lg hover:bg-secondary transition"><i class="fas fa-camera text-sm"></i></label>
                </div>
                <input type="file" id="setup-profile-upload" accept="image/*" class="hidden">
                <p class="text-xs text-gray-500 mt-2">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</p>
            </div>
            <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="setup-name" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶Æ‡ßã: ‡¶ì‡ßü‡¶æ‡¶≤‡¶ø‡¶¶"></div>
            <div id="setup-phone-container"><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label><input type="tel" id="setup-phone" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary" placeholder="01XXX-XXXXXX"></div>
            <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶™‡ßá‡¶∂‡¶æ / ‡¶ö‡¶æ‡¶ï‡ßÅ‡¶∞‡ßÄ</label><input type="text" id="setup-profession" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶õ‡¶æ‡¶§‡ßç‡¶∞, ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡ßü‡ßÄ, ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï"></div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</label><select id="setup-blood" class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white focus:border-primary"><option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option><option value="A+">A+</option><option value="A-">A-</option><option value="B+">B+</option><option value="B-">B-</option><option value="O+">O+</option><option value="O-">O-</option><option value="AB+">AB+</option><option value="AB-">AB-</option></select></div>
                <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶™‡¶æ‡ßú‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="setup-para" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨ ‡¶™‡¶æ‡ßú‡¶æ"></div>
            </div>
            <button id="btn-save-profile" class="w-full bg-primary text-white rounded-lg py-4 mt-6 font-bold text-lg shadow-lg hover:bg-secondary transition"><i class="fas fa-check-circle mr-2"></i> ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden-section h-full flex flex-col">
        <header class="absolute top-0 w-full bg-primary text-white px-4 py-3 flex items-center justify-between z-40 shadow-md" style="background: var(--primary);">
            <h2 class="text-xl font-bold flex items-center"><i class="fas fa-leaf mr-2 text-accent"></i> ‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ</h2>
            <div class="relative w-[55%]">
                <input type="text" id="global-search" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." class="w-full bg-white/20 text-white placeholder-white/70 px-4 py-1.5 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-white">
                <i class="fas fa-search absolute right-3 top-2.5 text-white/70 text-xs"></i>
            </div>
        </header>

        <main class="content-area bg-gray-100 relative" id="main-content">
            <!-- Home Tab -->
            <div id="tab-home" class="p-4 page-tab space-y-5">
                <div class="flex items-center justify-between bg-white p-4 rounded-xl shadow-sm border-l-4 border-primary">
                    <div><p class="text-gray-500 text-xs font-semibold">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ</p><h3 class="text-lg font-bold text-gray-800" id="welcome-name">---</h3></div>
                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-primary overflow-hidden" id="home-profile-pic"><i class="fas fa-user-circle text-2xl"></i></div>
                </div>
                <!-- Banner Slider -->
                <div class="slider-wrapper shadow-md bg-white">
                    <div id="banner-track" class="slider-track"></div>
                    <div id="banner-dots" class="absolute bottom-2 left-0 right-0 flex justify-center space-x-2"></div>
                </div>
                <h4 class="font-bold text-gray-800 text-lg px-1">‡¶è‡¶ï ‡¶®‡¶ú‡¶∞‡ßá ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center space-x-3">
                        <div class="w-12 h-12 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center text-xl"><i class="fas fa-users"></i></div>
                        <div><h5 class="font-semibold text-gray-700 text-sm">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</h5><p id="total-users-count" class="text-lg font-bold text-gray-900">0</p></div>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center space-x-3">
                        <div class="w-12 h-12 rounded-full bg-emerald-50 text-emerald-500 flex items-center justify-center text-xl"><i class="fas fa-mosque"></i></div>
                        <div><h5 class="font-semibold text-gray-700 text-sm">‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶</h5><p class="text-lg font-bold text-gray-900">‡ß© ‡¶ü‡¶ø</p></div>
                    </div>
                </div>
            </div>

            <!-- Villagers Tab -->
            <div id="tab-villagers" class="hidden-section p-4 page-tab">
                <div class="relative mb-5">
                    <input type="text" id="search-villager" placeholder="‡¶®‡¶æ‡¶Æ, ‡¶™‡ßá‡¶∂‡¶æ ‡¶¨‡¶æ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." class="w-full px-4 py-3 pl-11 rounded-xl border border-gray-200 shadow-sm focus:border-primary focus:ring-1 focus:ring-primary outline-none">
                    <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
                </div>
                <div id="villagers-list" class="space-y-3"></div>
            </div>

            <!-- Services Tab -->
            <div id="tab-services" class="hidden-section p-4 page-tab">
                <h3 class="text-xl font-bold text-gray-800 mb-5 text-center mt-2">‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-5 rounded-xl shadow-sm text-center border border-gray-100 hover:shadow-md transition"><div class="w-14 h-14 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl"><i class="fas fa-ambulance"></i></div><h5 class="font-bold text-gray-700">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡ßç‡¶¨‡ßÅ‡¶≤‡ßá‡¶®‡ßç‡¶∏</h5></div>
                    <div class="bg-white p-5 rounded-xl shadow-sm text-center border border-gray-100 hover:shadow-md transition"><div class="w-14 h-14 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl"><i class="fas fa-user-md"></i></div><h5 class="font-bold text-gray-700">‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞</h5></div>
                    <div class="bg-white p-5 rounded-xl shadow-sm text-center border border-gray-100 hover:shadow-md transition"><div class="w-14 h-14 bg-yellow-50 text-yellow-600 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl"><i class="fas fa-bolt"></i></div><h5 class="font-bold text-gray-700">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶Ö‡¶´‡¶ø‡¶∏</h5></div>
                    <div class="bg-white p-5 rounded-xl shadow-sm text-center border border-gray-100 hover:shadow-md transition"><div class="w-14 h-14 bg-green-50 text-green-600 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl"><i class="fas fa-shield-alt"></i></div><h5 class="font-bold text-gray-700">‡¶•‡¶æ‡¶®‡¶æ ‡¶™‡ßÅ‡¶≤‡¶ø‡¶∂</h5></div>
                </div>
            </div>

            <!-- Notice Tab -->
            <div id="tab-notice" class="hidden-section p-4 page-tab">
                <h3 class="font-bold text-gray-800 mb-4 text-lg flex items-center"><i class="fas fa-bullhorn text-primary mr-2"></i>‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¨‡ßã‡¶∞‡ßç‡¶°</h3>
                <div id="notice-list" class="space-y-3"></div>
            </div>

            <!-- Profile Tab -->
            <div id="tab-profile" class="hidden-section p-4 page-tab">
                <div class="bg-white rounded-2xl shadow-sm p-6 text-center border border-gray-100 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-24" style="background: var(--primary); opacity:0.1;"></div>
                    <div class="w-24 h-24 rounded-full mx-auto mb-3 relative z-10 overflow-hidden border-4 border-white shadow-md flex items-center justify-center bg-gray-100" id="profile-pic-container">
                        <img id="profile-pic-img" class="hidden w-full h-full object-cover" src="" alt="profile">
                        <i id="profile-pic-icon" class="fas fa-user text-4xl text-gray-400"></i>
                    </div>
                    <h2 id="prof-name" class="text-2xl font-bold text-gray-800">---</h2>
                    <p id="prof-profession" class="text-primary font-semibold text-sm mb-1">---</p>
                    <p id="prof-para" class="text-gray-500 text-sm mb-5"><i class="fas fa-map-marker-alt mr-1"></i>---</p>
                    
                    <div class="grid grid-cols-2 gap-3 text-left mb-6">
                        <div class="bg-gray-50 p-3 rounded-lg border border-gray-100 flex items-center space-x-3"><i class="fas fa-tint text-red-500 text-xl"></i><div><p class="text-xs text-gray-500">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</p><p id="prof-blood" class="font-bold text-gray-800">---</p></div></div>
                        <div class="bg-gray-50 p-3 rounded-lg border border-gray-100 flex items-center space-x-3"><i class="fas fa-phone-alt text-green-500 text-xl"></i><div class="overflow-hidden"><p class="text-xs text-gray-500">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</p><p id="prof-phone" class="font-bold text-gray-800 text-sm truncate">---</p></div></div>
                    </div>

                    <!-- Social links display -->
                    <div class="flex justify-center space-x-4 mb-6" id="profile-social-links"></div>

                    <button id="btn-edit-profile" class="w-full bg-primary/10 text-primary font-bold py-3 rounded-xl border border-primary/30 hover:bg-primary/20 transition mb-3"><i class="fas fa-edit mr-2"></i> ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button id="btn-logout" class="w-full bg-red-50 text-red-500 font-bold py-3 rounded-xl border border-red-100 hover:bg-red-100 transition"><i class="fas fa-sign-out-alt mr-2"></i> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <!-- Admin Tab -->
            <div id="tab-admin" class="hidden-section p-4 page-tab">
                <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white rounded-2xl shadow-lg p-6 text-center mb-6 relative overflow-hidden">
                    <i class="fas fa-user-shield text-5xl mb-3 text-accent opacity-90"></i>
                    <h2 class="text-2xl font-bold">‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
                    <p class="text-sm opacity-80">‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</p>
                </div>
                
                <!-- Banner management -->
                <h3 class="font-bold text-gray-700 mb-3 ml-1 flex items-center"><i class="fas fa-images text-primary mr-2"></i>‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞</h3>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 mb-6">
                    <div class="flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg p-3 mb-3 cursor-pointer hover:bg-gray-50" id="admin-banner-upload-area">
                        <i class="fas fa-cloud-upload-alt text-2xl text-primary mr-2"></i>
                        <span class="text-sm text-gray-600">‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶ú ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</span>
                    </div>
                    <input type="file" id="admin-banner-file" accept="image/*" class="hidden">
                    <input type="text" id="admin-banner-url" placeholder="‡¶≤‡¶ø‡¶Ç‡¶ï URL (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" class="w-full px-4 py-2 mb-3 rounded-lg border border-gray-300 text-sm">
                    <button id="btn-add-banner" class="w-full bg-dark text-white rounded-lg py-2 font-bold hover:bg-black transition"><i class="fas fa-plus-circle mr-1"></i> ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>

                <!-- Notice management -->
                <h3 class="font-bold text-gray-700 mb-3 ml-1 flex items-center"><i class="fas fa-bullhorn text-primary mr-2"></i>‡¶®‡ßã‡¶ü‡¶ø‡¶∂</h3>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 mb-6">
                    <textarea id="admin-notice-text" rows="2" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." class="w-full px-4 py-2 mb-3 rounded-lg border border-gray-300 text-sm"></textarea>
                    <button id="btn-add-notice" class="w-full bg-primary text-white rounded-lg py-2 font-bold hover:bg-secondary transition"><i class="fas fa-paper-plane mr-1"></i> ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>

                <!-- User Management -->
                <h3 class="font-bold text-gray-700 mb-3 ml-1 flex items-center"><i class="fas fa-users-cog text-primary mr-2"></i>‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú</h3>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                    <input type="text" id="admin-user-search" placeholder="‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." class="w-full px-4 py-2 mb-3 rounded-lg border border-gray-300 text-sm">
                    <div id="admin-user-list" class="max-h-60 overflow-y-auto space-y-2"></div>
                </div>

                <!-- Theme customization -->
                <h3 class="font-bold text-gray-700 mt-6 mb-3 ml-1 flex items-center"><i class="fas fa-palette text-primary mr-2"></i>‡¶•‡¶ø‡¶Æ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞</h3>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                    <div class="flex flex-wrap gap-3 justify-center" id="theme-gradient-options">
                        <!-- gradients injected by js -->
                    </div>
                    <button id="btn-save-theme" class="w-full mt-4 bg-primary text-white rounded-lg py-2 font-bold hover:bg-secondary transition">‡¶•‡¶ø‡¶Æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="absolute bottom-0 w-full bg-white shadow-[0_-5px_15px_rgba(0,0,0,0.05)] flex justify-around items-center px-2 py-2 z-40 rounded-t-2xl border-t border-gray-100">
            <button onclick="switchTab('home')" class="nav-btn flex flex-col items-center text-gray-400 hover:text-primary w-1/5" data-target="tab-home"><i class="fas fa-home text-xl mb-1"></i><span class="text-[10px] font-bold">‡¶π‡ßã‡¶Æ</span></button>
            <button onclick="switchTab('villagers')" class="nav-btn flex flex-col items-center text-gray-400 hover:text-primary w-1/5" data-target="tab-villagers"><i class="fas fa-users text-xl mb-1"></i><span class="text-[10px] font-bold">‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ</span></button>
            <div class="w-1/5 flex justify-center relative">
                <button onclick="switchTab('services')" class="nav-btn nav-center w-14 h-14 bg-gradient-to-br from-primary to-secondary text-white rounded-full flex items-center justify-center shadow-[0_5px_15px_rgba(22,163,74,0.4)] hover:scale-105 transition-transform" data-target="tab-services"><i class="fas fa-th-large text-2xl"></i></button>
            </div>
            <button onclick="switchTab('notice')" class="nav-btn flex flex-col items-center text-gray-400 hover:text-primary w-1/5" data-target="tab-notice"><i class="fas fa-bell text-xl mb-1"></i><span class="text-[10px] font-bold">‡¶®‡ßã‡¶ü‡¶ø‡¶∂</span></button>
            <button onclick="switchTab('profile')" class="nav-btn flex flex-col items-center text-gray-400 hover:text-primary w-1/5" data-target="tab-profile"><i class="fas fa-user text-xl mb-1"></i><span class="text-[10px] font-bold">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</span></button>
            <button id="admin-nav-btn" onclick="switchTab('admin')" class="hidden-section nav-btn flex flex-col items-center text-dark hover:text-primary w-1/5" data-target="tab-admin"><i class="fas fa-shield-alt text-xl mb-1"></i><span class="text-[10px] font-bold">‡¶è‡¶°‡¶Æ‡¶ø‡¶®</span></button>
        </nav>
    </div>

    <!-- Modals -->
    <div id="success-modal" class="fixed inset-0 modal-overlay flex items-center justify-center px-4 z-[4000]">
        <div class="modal-content bg-white w-full max-w-sm rounded-2xl p-6 text-center shadow-2xl">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-check text-4xl text-green-500"></i></div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!</h3>
            <p class="text-gray-600 font-medium">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§</p>
        </div>
    </div>

    <div id="villager-modal" class="fixed inset-0 modal-overlay flex items-center justify-center px-4 z-[4000]">
        <div class="modal-content bg-white w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl relative">
            <button onclick="closeModal('villager-modal')" class="absolute top-3 right-3 w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-200 z-10"><i class="fas fa-times"></i></button>
            <div class="bg-primary/10 h-24 w-full absolute top-0 left-0"></div>
            <div class="px-6 pt-12 pb-6 text-center relative z-10">
                <div class="w-20 h-20 bg-white border-4 border-white shadow-md rounded-full mx-auto mb-3 flex items-center justify-center text-3xl text-gray-400 overflow-hidden" id="v-modal-pic"><i class="fas fa-user"></i></div>
                <h3 id="v-modal-name" class="text-2xl font-bold text-gray-800">---</h3>
                <p id="v-modal-prof" class="text-primary font-semibold text-sm mb-4">---</p>
                <div class="space-y-3 text-left bg-gray-50 p-4 rounded-xl border border-gray-100">
                    <div class="flex items-center"><i class="fas fa-map-marker-alt w-6 text-gray-400"></i> <span id="v-modal-para" class="text-gray-700 font-medium">---</span></div>
                    <div class="flex items-center"><i class="fas fa-phone-alt w-6 text-gray-400"></i> <a id="v-modal-phone" href="#" class="text-blue-600 font-bold">---</a></div>
                    <div class="flex items-center"><i class="fas fa-tint w-6 text-gray-400"></i> <span id="v-modal-blood" class="font-bold text-red-500 bg-red-100 px-2 rounded">---</span></div>
                    <div class="flex justify-around pt-2" id="v-modal-social"></div>
                </div>
                <div class="mt-5 flex space-x-3">
                    <a id="v-modal-call" href="#" class="w-full bg-green-500 text-white py-2 rounded-lg font-bold shadow hover:bg-green-600"><i class="fas fa-phone mr-1"></i> ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="fixed inset-0 modal-overlay flex items-center justify-center px-4 z-[4000]">
        <div class="modal-content bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold text-gray-800 mb-4">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü</h3>
            <div class="flex flex-col items-center mb-4">
                <div class="relative">
                    <div id="edit-profile-preview" class="w-24 h-24 rounded-full bg-gray-200 border-4 border-white shadow-md flex items-center justify-center text-gray-400 text-4xl overflow-hidden"><i class="fas fa-user"></i></div>
                    <label for="edit-profile-upload" class="absolute bottom-0 right-0 bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center cursor-pointer shadow-lg"><i class="fas fa-camera text-sm"></i></label>
                </div>
                <input type="file" id="edit-profile-upload" accept="image/*" class="hidden">
            </div>
            <div class="space-y-3">
                <input type="text" id="edit-name" placeholder="‡¶®‡¶æ‡¶Æ" class="w-full px-4 py-2 rounded-lg border border-gray-300">
                <input type="text" id="edit-profession" placeholder="‡¶™‡ßá‡¶∂‡¶æ" class="w-full px-4 py-2 rounded-lg border border-gray-300">
                <input type="text" id="edit-para" placeholder="‡¶™‡¶æ‡ßú‡¶æ" class="w-full px-4 py-2 rounded-lg border border-gray-300">
                <select id="edit-blood" class="w-full px-4 py-2 rounded-lg border border-gray-300"><option value="">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</option><option value="A+">A+</option><option value="A-">A-</option><option value="B+">B+</option><option value="B-">B-</option><option value="O+">O+</option><option value="O-">O-</option><option value="AB+">AB+</option><option value="AB-">AB-</option></select>
                <input type="url" id="edit-facebook" placeholder="‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶≤‡¶ø‡¶Ç‡¶ï (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" class="w-full px-4 py-2 rounded-lg border border-gray-300">
                <input type="text" id="edit-whatsapp" placeholder="‡¶π‡ßã‡ßü‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" class="w-full px-4 py-2 rounded-lg border border-gray-300">
                <input type="text" id="edit-telegram" placeholder="‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞/‡¶≤‡¶ø‡¶Ç‡¶ï (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" class="w-full px-4 py-2 rounded-lg border border-gray-300">
            </div>
            <div class="flex space-x-3 mt-6">
                <button id="btn-save-profile-edit" class="w-full bg-primary text-white py-2 rounded-lg font-bold">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button onclick="closeModal('edit-profile-modal')" class="w-full bg-gray-200 text-gray-800 py-2 rounded-lg font-bold">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getAuth, RecaptchaVerifier, signInWithPhoneNumber, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, collection, getDocs, addDoc, updateDoc, deleteDoc, query, where } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAuqcDRrtuQi2tdWXA2E_UWyq7pCrGpoy4",
      authDomain: "parkhali-village.firebaseapp.com",
      projectId: "parkhali-village",
      storageBucket: "parkhali-village.firebasestorage.app",
      messagingSenderId: "645968583344",
      appId: "1:645968583344:web:89a049e6ffaba4af33b975"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Cloudinary config
    const CLOUD_NAME = 'dwnpdwnvc';
    const UPLOAD_PRESET = 'Parkhali';

    // Global vars
    let currentUserData = null;
    let allVillagers = [];
    let confirmationResult = null;
    let bannersLoaded = false;
    let currentTheme = '#16a34a'; // default primary

    const showLoader = (show) => document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none';
    const showSection = (id) => {
        ['auth-section','setup-section','main-app'].forEach(s => document.getElementById(s).classList.add('hidden-section'));
        document.getElementById(id).classList.remove('hidden-section');
    };
    window.closeModal = (id) => document.getElementById(id).classList.remove('active');
    window.openModal = (id) => document.getElementById(id).classList.add('active');

    // Cloudinary upload function
    async function uploadToCloudinary(file) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', UPLOAD_PRESET);
        try {
            const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, { method: 'POST', body: formData });
            const data = await res.json();
            return data.secure_url;
        } catch (e) {
            console.error('Upload error', e);
            return null;
        }
    }

    // Splash and auth state
    window.onload = () => {
        document.querySelectorAll('.letter').forEach((l,i)=> setTimeout(()=> l.classList.add('animate-letter'), i*150));
        setTimeout(() => {
            onAuthStateChanged(auth, async (user) => {
                document.getElementById('splash-screen').classList.add('hidden-section');
                if (user) {
                    // Check if banned
                    const userDoc = await getDoc(doc(db, 'users', user.uid));
                    if (userDoc.exists() && userDoc.data().banned) {
                        await signOut(auth);
                        alert('‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ï‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶°‡•§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§');
                        showSection('auth-section');
                        return;
                    }
                    checkProfileAndRedirect(user);
                } else showSection('auth-section');
            });
        }, 2500);
    };

    async function checkProfileAndRedirect(user) {
        showLoader(true);
        const docRef = doc(db, "users", user.uid);
        const docSnap = await getDoc(docRef);
        showLoader(false);
        if (docSnap.exists()) {
            currentUserData = docSnap.data();
            setupMainApp(user, currentUserData);
            showSection('main-app');
            switchTab('home');
            loadBanners();
        } else {
            if(user.phoneNumber) document.getElementById('setup-phone').value = user.phoneNumber;
            showSection('setup-section');
        }
    }

    // Tab switching
    window.switchTab = (tab) => {
        document.querySelectorAll('.page-tab').forEach(t => t.classList.add('hidden-section'));
        document.getElementById(`tab-${tab}`).classList.remove('hidden-section');
        document.querySelectorAll('.nav-btn').forEach(b => {
            if(!b.classList.contains('nav-center')) b.classList.remove('text-primary');
        });
        const active = document.querySelector(`[data-target="tab-${tab}"]`);
        if(active && !active.classList.contains('nav-center')) active.classList.add('text-primary');
        if(tab === 'villagers') loadVillagers();
        if(tab === 'notice') loadNotices();
        if(tab === 'admin' && currentUserData?.email === 'mdwld2005@gmail.com') loadAdminUsers();
    };

    // Auth UI tabs
    document.getElementById('tab-phone-auth').addEventListener('click', (e) => {
        e.target.className = "w-1/2 py-3 auth-tab-active text-lg";
        document.getElementById('tab-email-auth').className = "w-1/2 py-3 auth-tab-inactive text-lg";
        document.getElementById('auth-phone-div').classList.remove('hidden-section');
        document.getElementById('auth-email-div').classList.add('hidden-section');
    });
    document.getElementById('tab-email-auth').addEventListener('click', (e) => {
        e.target.className = "w-1/2 py-3 auth-tab-active text-lg";
        document.getElementById('tab-phone-auth').className = "w-1/2 py-3 auth-tab-inactive text-lg";
        document.getElementById('auth-email-div').classList.remove('hidden-section');
        document.getElementById('auth-phone-div').classList.add('hidden-section');
    });

    // Phone auth
    window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', { size: 'invisible' });
    document.getElementById('btn-send-otp').addEventListener('click', () => {
        let phone = document.getElementById('auth-phone').value;
        if(phone.startsWith('0')) phone = phone.substring(1);
        const phoneNumber = "+880" + phone;
        showLoader(true);
        signInWithPhoneNumber(auth, phoneNumber, window.recaptchaVerifier)
            .then(res => { confirmationResult = res; showLoader(false); document.getElementById('phone-input-step').classList.add('hidden-section'); document.getElementById('otp-input-step').classList.remove('hidden-section'); })
            .catch(err => { showLoader(false); alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + err.message); });
    });
    document.getElementById('btn-verify-otp').addEventListener('click', () => {
        const code = document.getElementById('auth-otp').value;
        showLoader(true);
        confirmationResult.confirm(code).catch(e => { showLoader(false); alert('‡¶≠‡ßÅ‡¶≤ OTP'); });
    });

    // Email auth
    document.getElementById('btn-register-email').addEventListener('click', () => {
        const email = document.getElementById('auth-email').value;
        const pass = document.getElementById('auth-password').value;
        if(email && pass) { showLoader(true); createUserWithEmailAndPassword(auth, email, pass).catch(e => { showLoader(false); alert(e.message); }); }
    });
    document.getElementById('btn-login-email').addEventListener('click', () => {
        const email = document.getElementById('auth-email').value;
        const pass = document.getElementById('auth-password').value;
        if(email && pass) { showLoader(true); signInWithEmailAndPassword(auth, email, pass).catch(e => { showLoader(false); alert('‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°'); }); }
    });

    // Profile picture upload preview (setup)
    document.getElementById('setup-profile-upload').addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if(file) {
            const preview = document.getElementById('setup-profile-preview');
            preview.innerHTML = `<img src="${URL.createObjectURL(file)}" class="w-full h-full object-cover">`;
            // upload later at save
        }
    });

    // Save profile (setup)
    document.getElementById('btn-save-profile').addEventListener('click', async () => {
        const name = document.getElementById('setup-name').value;
        let phone = document.getElementById('setup-phone').value;
        if(auth.currentUser?.phoneNumber) phone = auth.currentUser.phoneNumber;
        const profession = document.getElementById('setup-profession').value;
        const blood = document.getElementById('setup-blood').value;
        const para = document.getElementById('setup-para').value;
        if(!name || !phone || !profession || !para) return alert('‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®');
        showLoader(true);
        try {
            let profilePic = '';
            const fileInput = document.getElementById('setup-profile-upload');
            if(fileInput.files.length) {
                profilePic = await uploadToCloudinary(fileInput.files[0]);
            }
            await setDoc(doc(db, "users", auth.currentUser.uid), {
                uid: auth.currentUser.uid, email: auth.currentUser.email || '', name, phone, profession, blood, para, profilePic,
                joined: new Date().toISOString()
            });
            showLoader(false);
            openModal('success-modal');
            setTimeout(() => { closeModal('success-modal'); checkProfileAndRedirect(auth.currentUser); }, 2000);
        } catch(e) { showLoader(false); alert('‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ'); }
    });

    function setupMainApp(user, data) {
        document.getElementById('welcome-name').innerText = data.name;
        document.getElementById('prof-name').innerText = data.name;
        document.getElementById('prof-profession').innerText = data.profession;
        document.getElementById('prof-para').innerText = data.para;
        document.getElementById('prof-blood').innerText = data.blood || 'N/A';
        document.getElementById('prof-phone').innerText = data.phone;
        if(data.profilePic) {
            document.getElementById('profile-pic-img').src = data.profilePic;
            document.getElementById('profile-pic-img').classList.remove('hidden');
            document.getElementById('profile-pic-icon').classList.add('hidden');
        }
        renderSocialLinks(data, 'profile-social-links');
        if(user.email === 'mdwld2005@gmail.com') {
            document.getElementById('admin-nav-btn').classList.remove('hidden-section');
        }
    }

    function renderSocialLinks(data, containerId) {
        const cont = document.getElementById(containerId);
        if(!cont) return;
        cont.innerHTML = '';
        if(data.facebook) cont.innerHTML += `<a href="${data.facebook}" target="_blank" class="text-blue-600 text-xl"><i class="fab fa-facebook"></i></a>`;
        if(data.whatsapp) {
            let wa = data.whatsapp.startsWith('+') ? data.whatsapp : '+88'+data.whatsapp;
            cont.innerHTML += `<a href="https://wa.me/${wa.replace('+','')}" target="_blank" class="text-green-500 text-xl"><i class="fab fa-whatsapp"></i></a>`;
        }
        if(data.telegram) {
            let tg = data.telegram.startsWith('http') ? data.telegram : `https://t.me/${data.telegram}`;
            cont.innerHTML += `<a href="${tg}" target="_blank" class="text-blue-400 text-xl"><i class="fab fa-telegram"></i></a>`;
        }
    }

    // Banner management
    async function loadBanners() {
        if(bannersLoaded) return;
        try {
            const snap = await getDocs(collection(db, "banners"));
            const banners = [];
            snap.forEach(d => banners.push(d.data()));
            const track = document.getElementById('banner-track');
            if(banners.length) {
                track.innerHTML = banners.map(b => `<img src="${b.imgUrl}" onclick="window.open('${b.linkUrl || '#'}', '_blank')" class="slide">`).join('');
                startSlider(banners.length);
            } else track.innerHTML = '<div class="slide bg-gray-200 flex items-center justify-center"><i class="fas fa-image text-4xl text-gray-400"></i></div>';
            bannersLoaded = true;
        } catch(e) { console.log(e); }
    }
    function startSlider(count) {
        if(count<=1) return;
        let i=0;
        setInterval(() => { i=(i+1)%count; document.getElementById('banner-track').style.transform = `translateX(-${i*100}%)`; }, 3500);
    }

    // Villagers
    async function loadVillagers() {
        if(!allVillagers.length) {
            showLoader(true);
            const snap = await getDocs(collection(db, "users"));
            allVillagers = [];
            snap.forEach(d => { if(!d.data().banned) allVillagers.push(d.data()); });
            document.getElementById('total-users-count').innerText = allVillagers.length;
            showLoader(false);
        }
        renderVillagers(allVillagers);
    }
    function renderVillagers(list) {
        const container = document.getElementById('villagers-list');
        container.innerHTML = '';
        list.forEach(v => {
            const enc = encodeURIComponent(JSON.stringify(v));
            container.innerHTML += `<div onclick='showVillagerDetails("${enc}")' class="bg-white p-3 rounded-xl shadow-sm border border-gray-100 flex items-center cursor-pointer hover:bg-green-50"><div class="w-12 h-12 bg-gray-100 rounded-full flex-shrink-0 flex items-center justify-center mr-4 overflow-hidden">${v.profilePic ? `<img src="${v.profilePic}" class="w-full h-full object-cover">` : '<i class="fas fa-user text-gray-400"></i>'}</div><div class="flex-grow"><h4 class="font-bold">${v.name}</h4><p class="text-xs text-primary">${v.profession||''}</p><p class="text-xs text-gray-500"><i class="fas fa-map-marker-alt mr-1"></i>${v.para}</p></div><i class="fas fa-chevron-right text-gray-300"></i></div>`;
        });
    }

    window.showVillagerDetails = (enc) => {
        const v = JSON.parse(decodeURIComponent(enc));
        document.getElementById('v-modal-name').innerText = v.name;
        document.getElementById('v-modal-prof').innerText = v.profession || '';
        document.getElementById('v-modal-para').innerText = v.para;
        document.getElementById('v-modal-phone').innerText = v.phone;
        document.getElementById('v-modal-phone').href = `tel:${v.phone}`;
        document.getElementById('v-modal-call').href = `tel:${v.phone}`;
        document.getElementById('v-modal-blood').innerText = v.blood || 'N/A';
        if(v.profilePic) document.getElementById('v-modal-pic').innerHTML = `<img src="${v.profilePic}" class="w-full h-full object-cover">`;
        const socialDiv = document.getElementById('v-modal-social');
        socialDiv.innerHTML = '';
        if(v.facebook) socialDiv.innerHTML += `<a href="${v.facebook}" target="_blank" class="text-blue-600 text-2xl"><i class="fab fa-facebook"></i></a>`;
        if(v.whatsapp) socialDiv.innerHTML += `<a href="https://wa.me/${v.whatsapp.replace('+88','')}" target="_blank" class="text-green-500 text-2xl"><i class="fab fa-whatsapp"></i></a>`;
        if(v.telegram) socialDiv.innerHTML += `<a href="${v.telegram.startsWith('http')?v.telegram:'https://t.me/'+v.telegram}" target="_blank" class="text-blue-400 text-2xl"><i class="fab fa-telegram"></i></a>`;
        openModal('villager-modal');
    };

    // Search villagers
    document.getElementById('search-villager').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = allVillagers.filter(v => v.name.toLowerCase().includes(term) || v.phone.includes(term) || (v.profession||'').toLowerCase().includes(term));
        renderVillagers(filtered);
    });

    // Notice functions
    async function loadNotices() {
        const snap = await getDocs(collection(db, "notices"));
        const container = document.getElementById('notice-list');
        container.innerHTML = '';
        snap.forEach(doc => {
            const n = doc.data();
            container.innerHTML += `<div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-primary"><h4 class="font-bold">${n.title || '‡¶®‡ßã‡¶ü‡¶ø‡¶∂'}</h4><p class="text-sm text-gray-600">${n.content}</p><span class="text-xs text-gray-400">${new Date(n.timestamp?.toDate()).toLocaleDateString('bn-BD')}</span></div>`;
        });
    }

    // Admin: add banner with upload
    document.getElementById('admin-banner-upload-area').addEventListener('click', ()=> document.getElementById('admin-banner-file').click());
    document.getElementById('admin-banner-file').addEventListener('change', async function(e) {
        const file = e.target.files[0];
        if(file) {
            showLoader(true);
            const url = await uploadToCloudinary(file);
            showLoader(false);
            if(url) document.getElementById('admin-banner-img')?.value = url; // we'll create hidden input
        }
    });
    // add hidden input for banner img url
    const bannerImgInput = document.createElement('input');
    bannerImgInput.type = 'hidden';
    bannerImgInput.id = 'admin-banner-img';
    document.getElementById('admin-banner-upload-area').parentNode.appendChild(bannerImgInput);

    document.getElementById('btn-add-banner').addEventListener('click', async () => {
        const imgUrl = document.getElementById('admin-banner-img').value;
        const linkUrl = document.getElementById('admin-banner-url').value || '#';
        if(!imgUrl) return alert('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®');
        showLoader(true);
        await addDoc(collection(db, "banners"), { imgUrl, linkUrl, addedAt: new Date() });
        showLoader(false);
        alert('‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá');
        bannersLoaded = false;
    });

    // Admin: add notice
    document.getElementById('btn-add-notice').addEventListener('click', async () => {
        const text = document.getElementById('admin-notice-text').value;
        if(!text) return;
        await addDoc(collection(db, "notices"), { content: text, timestamp: new Date() });
        document.getElementById('admin-notice-text').value = '';
        alert('‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
    });

    // Admin: load users
    async function loadAdminUsers() {
        const snap = await getDocs(collection(db, "users"));
        const users = [];
        snap.forEach(d => users.push({ id: d.id, ...d.data() }));
        renderAdminUsers(users);
    }
    function renderAdminUsers(users) {
        const cont = document.getElementById('admin-user-list');
        cont.innerHTML = '';
        users.forEach(u => {
            cont.innerHTML += `<div class="flex items-center justify-between bg-gray-50 p-2 rounded-lg border"><span>${u.name} (${u.phone})</span><div><button class="ban-btn text-xs bg-red-100 px-2 py-1 rounded mr-1" data-id="${u.id}" data-banned="${u.banned}">${u.banned?'Unban':'Ban'}</button><button class="delete-btn text-xs bg-gray-200 px-2 py-1 rounded" data-id="${u.id}">Del</button></div></div>`;
        });
        document.querySelectorAll('.ban-btn').forEach(b => b.addEventListener('click', async (e) => {
            const id = e.target.dataset.id;
            const banned = e.target.dataset.banned === 'true' ? false : true;
            await updateDoc(doc(db, 'users', id), { banned });
            loadAdminUsers();
        }));
        document.querySelectorAll('.delete-btn').forEach(b => b.addEventListener('click', async (e) => {
            if(confirm('‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) await deleteDoc(doc(db, 'users', e.target.dataset.id));
            loadAdminUsers();
        }));
    }

    // Admin theme gradients
    const gradients = [
        'linear-gradient(135deg, #16a34a, #15803d)',
        'linear-gradient(135deg, #2563eb, #1e40af)',
        'linear-gradient(135deg, #dc2626, #991b1b)',
        'linear-gradient(135deg, #9333ea, #6b21a5)',
        'linear-gradient(135deg, #f59e0b, #b45309)',
        'linear-gradient(135deg, #0f172a, #334155)'
    ];
    const themeContainer = document.getElementById('theme-gradient-options');
    gradients.forEach((g, idx) => {
        const div = document.createElement('div');
        div.className = 'gradient-option';
        div.style.background = g;
        div.dataset.index = idx;
        div.addEventListener('click', () => {
            document.querySelectorAll('.gradient-option').forEach(o => o.classList.remove('selected'));
            div.classList.add('selected');
        });
        themeContainer.appendChild(div);
    });
    document.getElementById('btn-save-theme').addEventListener('click', async () => {
        const selected = document.querySelector('.gradient-option.selected');
        if(!selected) return;
        const idx = selected.dataset.index;
        // save to firestore settings
        await setDoc(doc(db, 'settings', 'theme'), { gradient: gradients[idx] });
        alert('‡¶•‡¶ø‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá (‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞)');
    });

    // Logout
    document.getElementById('btn-logout').addEventListener('click', () => signOut(auth).then(()=>location.reload()));

    // Edit profile modal
    document.getElementById('btn-edit-profile').addEventListener('click', () => {
        const d = currentUserData;
        document.getElementById('edit-name').value = d.name || '';
        document.getElementById('edit-profession').value = d.profession || '';
        document.getElementById('edit-para').value = d.para || '';
        document.getElementById('edit-blood').value = d.blood || '';
        document.getElementById('edit-facebook').value = d.facebook || '';
        document.getElementById('edit-whatsapp').value = d.whatsapp || '';
        document.getElementById('edit-telegram').value = d.telegram || '';
        openModal('edit-profile-modal');
    });

    document.getElementById('edit-profile-upload').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if(file) {
            const preview = document.getElementById('edit-profile-preview');
            preview.innerHTML = `<img src="${URL.createObjectURL(file)}" class="w-full h-full object-cover">`;
        }
    });

    document.getElementById('btn-save-profile-edit').addEventListener('click', async () => {
        showLoader(true);
        let profilePic = currentUserData.profilePic || '';
        const fileInput = document.getElementById('edit-profile-upload');
        if(fileInput.files.length) {
            profilePic = await uploadToCloudinary(fileInput.files[0]);
        }
        const updates = {
            name: document.getElementById('edit-name').value,
            profession: document.getElementById('edit-profession').value,
            para: document.getElementById('edit-para').value,
            blood: document.getElementById('edit-blood').value,
            facebook: document.getElementById('edit-facebook').value,
            whatsapp: document.getElementById('edit-whatsapp').value,
            telegram: document.getElementById('edit-telegram').value,
            profilePic
        };
        await updateDoc(doc(db, 'users', auth.currentUser.uid), updates);
        showLoader(false);
        closeModal('edit-profile-modal');
        alert('‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá');
        location.reload(); // simple refresh
    });
</script>
</body>
</html>
