<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <style>
        /* ================== PREMIUM CSS VARIABLES ================== */
        :root { 
            --primary: #0F62FE; /* IBM Blue style */
            --primary-dark: #0043CE;
            --accent: #198038; /* Green for Agri/Success */
            --danger: #DA1E28;
            --warning: #FF832B;
            --bg-body: #F2F4F8;
            --bg-card: #FFFFFF;
            --text-main: #161616;
            --text-muted: #525252;
            --shadow-soft: 0 4px 20px rgba(0,0,0,0.05);
            --shadow-float: 0 10px 30px rgba(0,0,0,0.1);
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 30px;
        }

        /* ================== GLOBAL RESET ================== */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Hind Siliguri', 'Poppins', sans-serif; 
            margin: 0; padding: 0; 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            overflow-x: hidden; 
            padding-bottom: 90px; /* Space for Bottom Nav */
        }
        
        .container { 
            max-width: 480px; 
            margin: 0 auto; 
            min-height: 100vh; 
            position: relative; 
            background: var(--bg-card); 
            box-shadow: 0 0 30px rgba(0,0,0,0.05); 
        }

        /* ================== SPLASH SCREEN ================== */
        #splash-screen {
            position: fixed; inset: 0; max-width: 480px; margin: 0 auto;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s ease, visibility 0.5s;
        }
        .splash-icon { font-size: 80px; color: white; animation: pulse 1.5s infinite; }
        .splash-title { color: white; font-size: 2rem; font-weight: 700; margin: 10px 0 0; letter-spacing: 1px; }
        .spinner { width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; margin-top: 30px; animation: spin 0.8s linear infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes spin { to { transform: rotate(360deg); } }
        .hidden { opacity: 0; visibility: hidden; pointer-events: none; }

        /* ================== HEADER ================== */
        header { 
            background: var(--primary); 
            color: white; 
            padding: 2rem 1.5rem 3rem; 
            border-bottom-left-radius: var(--radius-xl); 
            border-bottom-right-radius: var(--radius-xl); 
            position: relative; z-index: 10;
        }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .header-logo { font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .logout-btn { 
            background: rgba(255,255,255,0.2); color: white; border: none; 
            padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; 
            cursor: pointer; display: none; align-items: center; gap: 5px; backdrop-filter: blur(4px);
        }

        /* ================== LAYOUT & CARDS ================== */
        main { padding: 0 1.2rem; margin-top: -2rem; position: relative; z-index: 20; }
        
        .card { 
            background: white; padding: 1.2rem; border-radius: var(--radius-lg); 
            box-shadow: var(--shadow-soft); margin-bottom: 1.2rem; 
            border: 1px solid #F2F4F8;
        }
        .section-header { font-size: 1.1rem; font-weight: 700; color: var(--text-main); margin-bottom: 1rem; display: flex; align-items: center; gap: 8px; }
        
        /* ================== FORMS & BUTTONS ================== */
        .input-group { width: 100%; padding: 14px; margin-bottom: 12px; border: 1px solid #E0E0E0; border-radius: var(--radius-md); font-family: inherit; font-size: 0.95rem; background: #FAFAFA; transition: 0.3s; }
        .input-group:focus { border-color: var(--primary); background: white; outline: none; box-shadow: 0 0 0 3px rgba(15, 98, 254, 0.1); }
        
        .btn { 
            width: 100%; padding: 14px; border: none; border-radius: var(--radius-md); 
            font-size: 1rem; font-weight: 600; cursor: pointer; transition: 0.2s; 
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(15, 98, 254, 0.3); }
        .btn-primary:active { transform: scale(0.98); }
        .btn-secondary { background: #e0e7ff; color: var(--primary); }
        .link { color: var(--primary); font-weight: 700; cursor: pointer; }

        /* ================== BANNER SLIDER (16:9) ================== */
        .banner-wrapper {
            position: relative; width: 100%; padding-top: 56.25%; /* 16:9 Aspect Ratio */
            border-radius: var(--radius-lg); overflow: hidden; background: #E0E0E0;
            box-shadow: var(--shadow-soft); margin-bottom: 20px;
        }
        .banner-slide {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; opacity: 0; transition: opacity 0.8s ease;
        }
        .banner-slide.active { opacity: 1; }

        /* ================== SERVICES GRID ================== */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .service-card {
            background: white; padding: 1.5rem 1rem; border-radius: var(--radius-lg);
            text-align: center; cursor: pointer; box-shadow: var(--shadow-soft);
            border: 1px solid #F2F4F8; transition: 0.2s;
        }
        .service-card:active { transform: scale(0.96); background: #fafafa; }
        .service-icon { 
            width: 55px; height: 55px; margin: 0 auto 10px; border-radius: 16px; 
            display: flex; align-items: center; justify-content: center; font-size: 28px;
        }
        .icon-red { background: #FFEBEE; color: var(--danger); }
        .icon-orange { background: #FFF3E0; color: var(--warning); }
        .icon-green { background: #E8F5E9; color: var(--accent); }
        .service-title { font-size: 0.9rem; font-weight: 600; color: var(--text-main); }

        /* ================== VILLAGER LIST & SEARCH ================== */
        .search-box { position: sticky; top: 0; background: var(--bg-card); z-index: 30; padding-bottom: 10px; }
        .villager-item {
            display: flex; align-items: center; justify-content: space-between;
            background: white; padding: 12px; border-radius: var(--radius-md);
            margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); border: 1px solid #f0f0f0;
            cursor: pointer;
        }
        .v-avatar { width: 45px; height: 45px; background: #E3F2FD; color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 12px; font-size: 18px; }
        .v-details h4 { margin: 0 0 2px; font-size: 1rem; color: var(--text-main); }
        .v-details p { margin: 0; font-size: 0.8rem; color: var(--text-muted); }
        .v-call { width: 40px; height: 40px; background: var(--accent); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; box-shadow: 0 4px 10px rgba(25, 128, 56, 0.2); }

        /* ================== NOTICES ================== */
        .notice-card { 
            padding: 1rem; border-left: 4px solid var(--primary); 
            background: #F8F9FA; border-radius: 8px; margin-bottom: 10px; 
        }
        .notice-card h4 { margin: 0 0 5px; font-size: 1rem; }
        .notice-card p { margin: 0; font-size: 0.9rem; color: var(--text-muted); }

        /* ================== BOTTOM NAVIGATION ================== */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 20px; right: 20px; max-width: 440px; margin: 0 auto;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);
            padding: 10px 20px; border-radius: 30px;
            box-shadow: var(--shadow-float); z-index: 100;
            display: none; justify-content: space-between; align-items: center;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #9E9E9E; cursor: pointer; transition: 0.3s; font-size: 0.7rem; font-weight: 600; flex: 1; }
        .nav-item.active { color: var(--primary); }
        .nav-item .material-icons-round { font-size: 26px; margin-bottom: 2px; }
        
        .nav-center {
            position: relative; top: -25px;
            width: 60px; height: 60px; background: var(--primary); color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 8px 20px rgba(15, 98, 254, 0.4); border: 4px solid white;
            transition: 0.2s;
        }
        .nav-center:active { transform: scale(0.9); }

        /* ================== MODALS ================== */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(3px);
            z-index: 200; display: none; align-items: flex-end; justify-content: center;
        }
        .modal-sheet {
            background: white; width: 100%; max-width: 480px;
            border-top-left-radius: var(--radius-xl); border-top-right-radius: var(--radius-xl);
            padding: 2rem 1.5rem; max-height: 85vh; overflow-y: auto;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .modal-overlay.show .modal-sheet { transform: translateY(0); }
        
        /* Success Animation */
        .success-overlay { position: fixed; inset: 0; background: white; z-index: 300; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .check-circle { width: 90px; height: 90px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; animation: popIn 0.5s; }
        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        /* Admin Styles */
        .stat-card { background: #393939; color: white; padding: 15px; border-radius: var(--radius-md); display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .admin-banner-preview { width: 100%; height: 100px; object-fit: cover; border-radius: 8px; margin-bottom: 5px; }
        .admin-item { background: #f4f4f4; padding: 10px; margin-bottom: 10px; border-radius: 8px; position: relative; }
        .delete-btn { position: absolute; top: 10px; right: 10px; color: var(--danger); background: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    </style>
</head>
<body>

    <div id="splash-screen">
        <span class="material-icons-round splash-icon">holiday_village</span>
        <h1 class="splash-title">‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ</h1>
        <p style="color: rgba(255,255,255,0.8); margin: 0;">‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤</p>
        <div class="spinner"></div>
    </div>

    <div id="success-modal" class="success-overlay">
        <div class="check-circle"><span class="material-icons-round" style="color: white; font-size: 50px;">check</span></div>
        <h2 style="color: var(--text-main); margin-bottom: 5px;">‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!</h2>
        <p style="color: var(--text-muted);">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§</p>
    </div>

    <div class="container">
        <header>
            <div class="header-top">
                <div class="header-logo"><span class="material-icons-round">widgets</span> ‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ</div>
                <button id="logout-btn" class="logout-btn"><span class="material-icons-round" style="font-size: 16px;">logout</span> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
            <div id="hero-text">
                <h2 style="margin: 0; font-size: 1.8rem;">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2>
                <p style="margin: 0; opacity: 0.9;">‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶∏‡ßá‡¶¨‡¶æ‡¶Ø‡¶º ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</p>
            </div>
        </header>

        <main>
            <div id="auth-view" style="display: none; padding-top: 2rem;">
                <div class="card" style="text-align: center;">
                    <h3 style="margin-bottom: 1.5rem;">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    <input type="email" id="email" class="input-group" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
                    <input type="password" id="password" class="input-group" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
                    <button id="login-btn" class="btn btn-primary">‡¶≤‡¶ó‡¶á‡¶® <span class="material-icons-round">login</span></button>
                    <p style="margin-top: 15px; font-size: 0.9rem;">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? <span id="to-reg" class="link">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span></p>
                </div>
            </div>

            <div id="reg-view" style="display: none; padding-top: 2rem;">
                <div class="card">
                    <h3 style="color: var(--primary); margin-bottom: 1rem;">‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    <input type="email" id="reg-email" class="input-group" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏">
                    <input type="password" id="reg-pass" class="input-group" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
                    <button id="reg-btn" class="btn btn-primary">‡¶è‡¶ó‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶® <span class="material-icons-round">arrow_forward</span></button>
                    <p style="text-align: center; margin-top: 15px; font-size: 0.9rem;">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? <span id="to-login" class="link">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span></p>
                </div>
            </div>

            <div id="profile-form-view" style="display: none;">
                <div class="card">
                    <h3 style="color: var(--accent); margin-bottom: 5px;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®</h3>
                    <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 20px;">‡¶∏‡¶ï‡¶≤‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶™‡¶∞‡¶ø‡¶ö‡¶ø‡¶§ ‡¶π‡¶§‡ßá ‡¶§‡¶•‡ßç‡¶Ø‡¶ó‡ßÅ‡¶≤‡ßã ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®</p>
                    
                    <input type="text" id="p-name" class="input-group" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ">
                    <input type="text" id="p-profession" class="input-group" placeholder="‡¶™‡ßá‡¶∂‡¶æ (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶õ‡¶æ‡¶§‡ßç‡¶∞, ‡¶ï‡ßÉ‡¶∑‡¶ï)">
                    <select id="p-blood" class="input-group">
                        <option value="">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®...</option>
                        <option value="A+">A+</option><option value="A-">A-</option>
                        <option value="B+">B+</option><option value="B-">B-</option>
                        <option value="O+">O+</option><option value="O-">O-</option>
                        <option value="AB+">AB+</option><option value="AB-">AB-</option>
                    </select>
                    <input type="tel" id="p-phone" class="input-group" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
                    <input type="text" id="p-address" class="input-group" placeholder="‡¶™‡¶æ‡ßú‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
                    
                    <button id="save-profile-btn" class="btn btn-primary">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® <span class="material-icons-round">check_circle</span></button>
                </div>
            </div>

            <div id="home-view" style="display: none;">
                <div class="banner-wrapper" id="home-banner-slider">
                    <div style="height:100%; display:flex; align-items:center; justify-content:center; color:#ccc;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
                </div>

                <button class="btn btn-primary" onclick="switchView('villagers')" style="background: linear-gradient(135deg, #6200ea, #3700b3); margin-bottom: 20px; box-shadow: 0 5px 15px rgba(98, 0, 234, 0.3);">
                    <span class="material-icons-round">groups</span> ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                </button>

                <div class="section-header"><span class="material-icons-round" style="color:var(--primary)">campaign</span> ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¨‡ßã‡¶∞‡ßç‡¶°</div>
                <div id="notice-list"><p style="text-align:center; color:gray">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p></div>
            </div>

            <div id="services-view" style="display: none;">
                <div class="section-header">‡¶∏‡¶ï‡¶≤ ‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π</div>
                <div class="grid-2">
                    <div class="service-card" onclick="openModal('blood-modal'); loadDonors();">
                        <div class="service-icon icon-red"><span class="material-icons-round">bloodtype</span></div>
                        <div class="service-title">‡¶¨‡ßç‡¶≤‡¶æ‡¶° ‡¶°‡ßã‡¶®‡¶æ‡¶∞</div>
                    </div>
                    <div class="service-card" onclick="openModal('emergency-modal')">
                        <div class="service-icon icon-orange"><span class="material-icons-round">support_agent</span></div>
                        <div class="service-title">‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ</div>
                    </div>
                    <div class="service-card" onclick="openModal('agri-modal')">
                        <div class="service-icon icon-green"><span class="material-icons-round">agriculture</span></div>
                        <div class="service-title">‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶§‡¶•‡ßç‡¶Ø</div>
                    </div>
                </div>
            </div>

            <div id="villagers-view" style="display: none;">
                <div class="search-box">
                    <input type="text" id="v-search" class="input-group" placeholder="üîç ‡¶®‡¶æ‡¶Æ, ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¨‡¶æ ‡¶™‡ßá‡¶∂‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." style="margin-bottom:0; border-radius: 30px; padding-left: 20px;">
                </div>
                <div id="villager-list-container" style="padding-top: 10px; padding-bottom: 20px;">
                    <p style="text-align:center; color:gray">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>
            </div>

            <div id="profile-view" style="display: none;">
                <div class="card" style="text-align: center;">
                    <div style="width: 80px; height: 80px; background: var(--primary); color: white; border-radius: 50%; font-size: 35px; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                        <span class="material-icons-round">person</span>
                    </div>
                    <h3 id="my-name" style="margin: 0;">-</h3>
                    <p id="my-role" style="color: var(--text-muted); margin: 5px 0;">-</p>
                    <p id="my-email" style="font-size: 0.85rem; color: #999;">-</p>
                </div>
                <div class="card">
                    <div class="section-header">‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</div>
                    <input type="text" id="u-name" class="input-group" placeholder="‡¶®‡¶æ‡¶Æ">
                    <input type="text" id="u-prof" class="input-group" placeholder="‡¶™‡ßá‡¶∂‡¶æ">
                    <input type="tel" id="u-phone" class="input-group" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤">
                    <button id="update-btn" class="btn btn-primary">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <div id="admin-view" style="display: none;">
                <div class="grid-2">
                    <div class="stat-card"><div><div id="adm-users" style="font-size:1.5rem; font-weight:bold">-</div><small>Users</small></div><span class="material-icons-round">group</span></div>
                    <div class="stat-card" style="background:var(--accent)"><div><div id="adm-notices" style="font-size:1.5rem; font-weight:bold">-</div><small>Notices</small></div><span class="material-icons-round">campaign</span></div>
                </div>

                <div class="card">
                    <div class="section-header">‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
                    <input type="text" id="ban-img" class="input-group" placeholder="Image URL">
                    <input type="text" id="ban-link" class="input-group" placeholder="Click Link URL">
                    <button id="add-ban-btn" class="btn btn-primary" style="background: #E91E63;">‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <div id="adm-ban-list" style="margin-top: 15px;"></div>
                </div>

                <div class="card">
                    <div class="section-header">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤</div>
                    <input type="text" id="adm-search" class="input-group" placeholder="Search User...">
                    <div id="adm-user-list" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
                
                <div class="card">
                    <div class="section-header">‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¶‡¶ø‡¶®</div>
                    <input type="text" id="nt-title" class="input-group" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ">
                    <textarea id="nt-desc" class="input-group" rows="3" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§"></textarea>
                    <button id="pub-btn" class="btn btn-primary">‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

        </main>

        <nav class="bottom-nav" id="bottom-nav">
            <div class="nav-item active" id="btn-home"><span class="material-icons-round">home</span>‡¶π‡ßã‡¶Æ</div>
            <div class="nav-center" id="btn-services"><span class="material-icons-round" style="font-size: 32px;">grid_view</span></div>
            <div class="nav-item" id="btn-admin" style="display:none;"><span class="material-icons-round">admin_panel_settings</span>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</div>
            <div class="nav-item" id="btn-profile"><span class="material-icons-round">person</span>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</div>
        </nav>

        <div id="blood-modal" class="modal-overlay"><div class="modal-sheet"><div style="display:flex; justify-content:space-between"><h3 style="margin:0; color:var(--danger)">ü©∏ ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶§‡¶æ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3><span onclick="closeModal('blood-modal')" class="material-icons-round" style="cursor:pointer">close</span></div><br><div style="background:#FFEBEE; padding:15px; border-radius:12px; margin-bottom:15px"><h4 style="margin:0 0 10px; color:var(--danger)">‡¶®‡¶ø‡¶ú‡ßá‡¶ï‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</h4><input id="d-name" class="input-group" placeholder="‡¶®‡¶æ‡¶Æ"><select id="d-grp" class="input-group"><option value="A+">A+</option><option value="B+">B+</option><option value="O+">O+</option><option value="AB+">AB+</option></select><input id="d-phone" class="input-group" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤"><button id="add-donor" class="btn btn-primary" style="background:var(--danger)">‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßã‡¶®</button></div><select id="filter-blood" class="input-group" onchange="loadDonors(this.value)"><option value="All">‡¶∏‡¶ï‡¶≤ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</option><option value="A+">A+</option><option value="B+">B+</option><option value="O+">O+</option></select><div id="donor-list"></div></div></div>
        
        <div id="emergency-modal" class="modal-overlay"><div class="modal-sheet"><h3 style="margin:0 0 15px; color:var(--warning)">‚òéÔ∏è ‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ</h3><div class="villager-item"><div><h4>‡¶ú‡¶æ‡¶§‡ßÄ‡ßü ‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ</h4><p>999</p></div><a href="tel:999" class="v-call"><span class="material-icons-round">call</span></a></div><div class="villager-item"><div><h4>‡¶ö‡ßá‡ßü‡¶æ‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®</h4><p>01700000000</p></div><a href="tel:01700000000" class="v-call"><span class="material-icons-round">call</span></a></div><span onclick="closeModal('emergency-modal')" style="position:absolute; top:15px; right:15px; cursor:pointer;" class="material-icons-round">close</span></div></div>
        
        <div id="agri-modal" class="modal-overlay"><div class="modal-sheet"><h3 style="margin:0 0 15px; color:var(--accent)">üåæ ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶§‡¶•‡ßç‡¶Ø</h3><div style="background:#E8F5E9; padding:15px; border-radius:12px; color:#1b5e20; margin-bottom:15px">‡¶¨‡ßã‡¶∞‡ßã ‡¶ß‡¶æ‡¶®‡ßá‡¶∞ ‡¶ö‡¶æ‡¶∞‡¶æ ‡¶∞‡ßã‡¶™‡¶£‡ßá‡¶∞ ‡¶â‡¶™‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶∏‡¶Æ‡ßü ‡¶ö‡¶≤‡¶õ‡ßá‡•§ ‡¶ú‡¶Æ‡¶ø‡¶§‡ßá ‡¶∏‡ßÅ‡¶∑‡¶Æ ‡¶∏‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div><div class="villager-item"><div><h4>‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶ï‡¶≤ ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</h4><p>16123</p></div><a href="tel:16123" class="v-call"><span class="material-icons-round">call</span></a></div><span onclick="closeModal('agri-modal')" style="position:absolute; top:15px; right:15px; cursor:pointer;" class="material-icons-round">close</span></div></div>

        <div id="villager-detail-modal" class="modal-overlay">
            <div class="modal-sheet" style="text-align: center;">
                <div style="display:flex; justify-content:flex-end"><span onclick="closeModal('villager-detail-modal')" class="material-icons-round" style="cursor:pointer">close</span></div>
                <div style="width:80px; height:80px; background:var(--primary); color:white; border-radius:50%; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; font-size:30px; font-weight:bold" id="vd-avatar">A</div>
                <h2 id="vd-name" style="margin:0">Name</h2>
                <p id="vd-role" style="color:gray; margin:5px 0 20px">Role</p>
                
                <div style="text-align:left; background:#f9f9f9; padding:15px; border-radius:12px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px"><span style="color:gray">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</span><b id="vd-phone">-</b></div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px"><span style="color:gray">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</span><b id="vd-blood" style="color:var(--danger)">-</b></div>
                    <div style="display:flex; justify-content:space-between"><span style="color:gray">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</span><b id="vd-addr">-</b></div>
                </div>
                <a id="vd-call" href="#" class="btn btn-primary" style="margin-top:20px; background:var(--accent); text-decoration:none">‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶® <span class="material-icons-round">call</span></a>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc, setDoc, updateDoc, deleteDoc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // CONFIG
        const firebaseConfig = { apiKey: "AIzaSyAuqcDRrtuQi2tdWXA2E_UWyq7pCrGpoy4", authDomain: "parkhali-village.firebaseapp.com", projectId: "parkhali-village" };
        const app = initializeApp(firebaseConfig); const auth = getAuth(app); const db = getFirestore(app); const adminEmail = "admin@parkhali.com";

        // GLOBAL HELPERS
        window.openModal = (id) => { const m = document.getElementById(id); m.style.display='flex'; setTimeout(()=>m.classList.add('show'),10); };
        window.closeModal = (id) => { const m = document.getElementById(id); m.classList.remove('show'); setTimeout(()=>m.style.display='none',300); };

        // NAVIGATION
        const views = { auth: 'auth-view', reg: 'reg-view', profile_form: 'profile-form-view', home: 'home-view', services: 'services-view', villagers: 'villagers-view', profile: 'profile-view', admin: 'admin-view' };
        const navs = { home: 'btn-home', services: 'btn-services', profile: 'btn-profile', admin: 'btn-admin' };

        function switchView(name) {
            // Hide all views
            Object.values(views).forEach(id => document.getElementById(id).style.display = 'none');
            // Reset navs
            Object.values(navs).forEach(id => document.getElementById(id).classList.remove('active'));
            
            // Show requested view
            document.getElementById(views[name]).style.display = 'block';
            
            // Handle Bottom Nav Active State
            if(navs[name]) {
                const btn = document.getElementById(navs[name]);
                if(name === 'services') btn.style.transform = "scale(1.1)";
                else { btn.classList.add('active'); document.getElementById('btn-services').style.transform = "scale(1)"; }
            }
            
            // Allow Back Nav Logic (Villagers -> Home)
            if(name === 'villagers') document.getElementById('btn-home').classList.add('active');

            // Dynamic Header Text
            const h = document.getElementById('hero-text');
            if(name === 'home') { h.innerHTML = `<h2>‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2><p>${auth.currentUser?.email.split('@')[0] || ''}</p>`; loadBanners(); }
            else if(name === 'villagers') { h.innerHTML = `<h2>‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ</h2><p>‡¶∏‡¶ï‡¶≤‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</p>`; loadVillagers(); }
            else if(name === 'admin') { h.innerHTML = `<h2>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</h2><p>‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</p>`; loadAdminData(); }
            else if(name === 'services') { h.innerHTML = `<h2>‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π</h2><p>‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü ‡¶∏‡¶¨ ‡¶∏‡ßá‡¶¨‡¶æ</p>`; }
            else if(name === 'profile') { h.innerHTML = `<h2>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h2><p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</p>`; loadProfile(); }
        }

        // Nav Click Events
        Object.keys(navs).forEach(key => document.getElementById(navs[key]).addEventListener('click', () => switchView(key)));

        // AUTHENTICATION FLOW
        onAuthStateChanged(auth, async (user) => {
            setTimeout(() => document.getElementById('splash-screen').classList.add('hidden'), 1500); // 1.5s Splash
            if (user) {
                const uDoc = await getDoc(doc(db, "users", user.uid));
                if (uDoc.exists()) {
                    const d = uDoc.data();
                    if(d.status === "banned" && user.email !== adminEmail) { signOut(auth); alert("Account Banned!"); return; }
                    
                    document.getElementById('logout-btn').style.display = "flex";
                    
                    if(!d.name && user.email !== adminEmail) {
                        // Profile Incomplete
                        document.getElementById('bottom-nav').style.display = "none";
                        switchView('profile_form');
                    } else {
                        // Logged In & Profile OK
                        document.getElementById('bottom-nav').style.display = "flex";
                        document.getElementById('btn-admin').style.display = (user.email === adminEmail) ? "flex" : "none";
                        switchView('home');
                        loadNotices();
                    }
                } else {
                    // Auth exists but Doc missing (Edge case, go to profile form)
                    await setDoc(doc(db, "users", user.uid), { email:user.email, role:"user", status:"active" });
                    switchView('profile_form');
                }
            } else {
                // Logged Out
                switchView('auth');
                document.getElementById('logout-btn').style.display = "none";
                document.getElementById('bottom-nav').style.display = "none";
            }
        });

        // AUTH ACTIONS
        document.getElementById('to-reg').onclick = () => { document.getElementById('auth-view').style.display='none'; document.getElementById('reg-view').style.display='block'; };
        document.getElementById('to-login').onclick = () => { document.getElementById('reg-view').style.display='none'; document.getElementById('auth-view').style.display='block'; };

        document.getElementById('login-btn').onclick = async () => {
            try { await signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('password').value); }
            catch(e) { alert("Login Failed: " + e.message); }
        };
        document.getElementById('reg-btn').onclick = async () => {
            try { 
                const c = await createUserWithEmailAndPassword(auth, document.getElementById('reg-email').value, document.getElementById('reg-pass').value);
                await setDoc(doc(db, "users", c.user.uid), { email:c.user.email, role: c.user.email===adminEmail?"admin":"user", status:"active", createdAt: serverTimestamp() });
                // AuthStateChanged handles redirection to profile_form
            } catch(e) { alert("Registration Failed: " + e.message); }
        };
        document.getElementById('logout-btn').onclick = () => signOut(auth);

        // SAVE PROFILE (New User)
        document.getElementById('save-profile-btn').onclick = async () => {
            const n = document.getElementById('p-name').value;
            const para = document.getElementById('p-address').value;
            if(!n || !para) return alert("Please fill Name & Address");
            
            await updateDoc(doc(db, "users", auth.currentUser.uid), {
                name: n, profession: document.getElementById('p-profession').value,
                bloodGroup: document.getElementById('p-blood').value,
                phone: document.getElementById('p-phone').value,
                address: para
            });

            // Show Success Animation
            const suc = document.getElementById('success-modal');
            suc.style.display = "flex";
            setTimeout(() => {
                suc.style.display = "none";
                document.getElementById('bottom-nav').style.display = "flex";
                switchView('home');
                loadNotices();
            }, 2000);
        };

        // HOME: BANNERS
        let slideInterval;
        async function loadBanners() {
            const con = document.getElementById('home-banner-slider');
            const snap = await getDocs(query(collection(db, "banners"), orderBy("createdAt", "desc")));
            if(snap.empty) { con.innerHTML="<div style='display:flex;justify-content:center;align-items:center;height:100%;color:#ccc'>No Banners</div>"; return; }
            con.innerHTML = ""; let i=0;
            snap.forEach(d => {
                const b = d.data();
                con.innerHTML += `<a href="${b.link||'#'}"><img src="${b.image}" class="banner-slide ${i===0?'active':''}" data-idx="${i}"></a>`;
                i++;
            });
            if(slideInterval) clearInterval(slideInterval);
            if(i > 1) {
                slideInterval = setInterval(() => {
                    const all = document.querySelectorAll('.banner-slide');
                    let activeIdx = 0;
                    all.forEach((el, idx) => { if(el.classList.contains('active')) { el.classList.remove('active'); activeIdx = idx; } });
                    all[(activeIdx+1)%all.length].classList.add('active');
                }, 4000);
            }
        }

        // HOME: NOTICES
        async function loadNotices() {
            const c = document.getElementById('notice-list');
            const s = await getDocs(query(collection(db, "notices"), orderBy("createdAt", "desc")));
            c.innerHTML = s.empty ? "<p style='text-align:center;color:gray'>‡¶ï‡ßã‡¶®‡ßã ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶®‡ßá‡¶á</p>" : "";
            s.forEach(d => { const n=d.data(); c.innerHTML+=`<div class="notice-card"><h4>${n.title}</h4><p>${n.description}</p></div>`; });
        }

        // FEATURE: VILLAGERS LIST
        let cachedVillagers = [];
        async function loadVillagers() {
            const c = document.getElementById('villager-list-container');
            if(cachedVillagers.length === 0) {
                c.innerHTML="<p style='text-align:center'>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>";
                const s = await getDocs(collection(db, "users"));
                cachedVillagers = []; s.forEach(d => cachedVillagers.push(d.data()));
            }
            renderVillagers(cachedVillagers);
        }
        function renderVillagers(list) {
            const c = document.getElementById('villager-list-container'); c.innerHTML="";
            const valid = list.filter(u => u.name && u.status !== 'banned');
            if(valid.length === 0) { c.innerHTML="<p style='text-align:center'>‡¶ï‡¶æ‡¶â‡¶ï‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>"; return; }
            valid.forEach(u => {
                const uStr = encodeURIComponent(JSON.stringify(u));
                c.innerHTML += `
                <div class="villager-item" onclick="window.viewUser('${uStr}')">
                    <div style="display:flex;align-items:center">
                        <div class="v-avatar">${u.name.charAt(0)}</div>
                        <div class="v-details"><h4>${u.name}</h4><p>${u.profession || '‡¶™‡ßá‡¶∂‡¶æ ‡¶®‡ßá‡¶á'}</p></div>
                    </div>
                    <a href="tel:${u.phone}" class="v-call" onclick="event.stopPropagation()"><span class="material-icons-round">call</span></a>
                </div>`;
            });
        }
        document.getElementById('v-search').addEventListener('input', (e) => {
            const q = e.target.value.toLowerCase();
            const f = cachedVillagers.filter(u => (u.name?.toLowerCase().includes(q)) || (u.phone?.includes(q)) || (u.profession?.toLowerCase().includes(q)));
            renderVillagers(f);
        });
        window.viewUser = (str) => {
            const u = JSON.parse(decodeURIComponent(str));
            document.getElementById('vd-avatar').innerText = u.name.charAt(0);
            document.getElementById('vd-name').innerText = u.name;
            document.getElementById('vd-role').innerText = u.profession;
            document.getElementById('vd-phone').innerText = u.phone || '-';
            document.getElementById('vd-blood').innerText = u.bloodGroup || '-';
            document.getElementById('vd-addr').innerText = u.address || '-';
            document.getElementById('vd-call').href = `tel:${u.phone}`;
            openModal('villager-detail-modal');
        };

        // FEATURE: BLOOD DONORS
        window.loadDonors = async (f="All") => {
            const c=document.getElementById('donor-list'); c.innerHTML="‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            const s=await getDocs(query(collection(db,"blood_donors"),orderBy("createdAt","desc"))); c.innerHTML="";
            s.forEach(d=>{const v=d.data(); if(f==="All"||v.bloodGroup===f) c.innerHTML+=`<div class="villager-item"><div><b style="color:var(--danger)">${v.bloodGroup}</b> ${v.name}</div><a href="tel:${v.phone}" class="v-call"><span class="material-icons-round">call</span></a></div>`});
        }
        document.getElementById('add-donor').onclick = async () => {
            const n=document.getElementById('d-name').value; const g=document.getElementById('d-grp').value; const p=document.getElementById('d-phone').value;
            if(!n||!g||!p)return; await addDoc(collection(db,"blood_donors"),{name:n,bloodGroup:g,phone:p,createdAt:serverTimestamp()}); alert("Added!"); loadDonors();
        }

        // FEATURE: PROFILE
        async function loadProfile() {
            if(!auth.currentUser) return;
            const d = await getDoc(doc(db,"users",auth.currentUser.uid));
            if(d.exists()) {
                const u = d.data();
                document.getElementById('my-name').innerText = u.name; document.getElementById('my-role').innerText = u.profession; document.getElementById('my-email').innerText = u.email;
                document.getElementById('u-name').value = u.name; document.getElementById('u-prof').value = u.profession; document.getElementById('u-phone').value = u.phone;
            }
        }
        document.getElementById('update-btn').onclick = async () => {
            await updateDoc(doc(db,"users",auth.currentUser.uid),{name:document.getElementById('u-name').value, profession:document.getElementById('u-prof').value, phone:document.getElementById('u-phone').value});
            alert("Updated!"); loadProfile();
        }

        // ADMIN
        async function loadAdminData() {
            // Stats
            const uS = await getDocs(collection(db,"users")); const nS = await getDocs(collection(db,"notices"));
            document.getElementById('adm-users').innerText = uS.size; document.getElementById('adm-notices').innerText = nS.size;
            
            // Users
            const uList = document.getElementById('adm-user-list'); uList.innerHTML="";
            uS.forEach(d => {
                const u = d.data();
                const act = u.status==='banned' ? `<button onclick="window.tog('${d.id}','active')" style="color:green;cursor:pointer">Unban</button>` : `<button onclick="window.tog('${d.id}','banned')" style="color:orange;cursor:pointer">Ban</button>`;
                uList.innerHTML += `<div class="villager-item" style="cursor:default"><div><b>${u.email}</b><br>${u.name||'-'}</div><div>${u.role!=='admin'?act+` <span onclick="window.del('${d.id}')" class="material-icons-round" style="color:red;vertical-align:middle;cursor:pointer">delete</span>`:''}</div></div>`;
            });

            // Banners
            const bList = document.getElementById('adm-ban-list'); bList.innerHTML="";
            const bS = await getDocs(collection(db,"banners"));
            bS.forEach(d => { bList.innerHTML+=`<div class="admin-item"><img src="${d.data().image}" class="admin-banner-preview"><div class="delete-btn" onclick="window.delBan('${d.id}')"><span class="material-icons-round">delete</span></div></div>` });
        }

        document.getElementById('add-ban-btn').onclick = async () => {
            const i=document.getElementById('ban-img').value; const l=document.getElementById('ban-link').value;
            if(!i)return; await addDoc(collection(db,"banners"),{image:i,link:l,createdAt:serverTimestamp()}); alert("Banner Added"); loadAdminData();
        }
        document.getElementById('pub-btn').onclick = async () => {
            const t=document.getElementById('nt-title').value; const d=document.getElementById('nt-desc').value;
            if(!t)return; await addDoc(collection(db,"notices"),{title:t,description:d,createdAt:serverTimestamp()}); alert("Notice Published");
        }
        
        // Admin Globals
        window.tog=async(id,s)=>{await updateDoc(doc(db,"users",id),{status:s});loadAdminData();}
        window.del=async(id)=>{if(confirm('Delete User?'))await deleteDoc(doc(db,"users",id));loadAdminData();}
        window.delBan=async(id)=>{if(confirm('Delete Banner?'))await deleteDoc(doc(db,"banners",id));loadAdminData();}

        // Users Filter Admin
        document.getElementById('adm-search').addEventListener('input', (e) => {
             const val = e.target.value.toLowerCase();
             const items = document.querySelectorAll('#adm-user-list .villager-item');
             items.forEach(el => { el.style.display = el.innerText.toLowerCase().includes(val) ? 'flex' : 'none'; });
        });

    </script>
</body>
</html>
