<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ üåø</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Cloudinary Upload Widget -->
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#16a34a', secondary: '#15803d', dark: '#14532d', accent: '#facc15' },
                    fontFamily: { sans: ['Hind Siliguri', 'sans-serif'] }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #f3f4f6; margin: 0; padding: 0; overflow-x: hidden; overscroll-behavior-y: contain; }
        .hidden-section { display: none !important; }
        
        /* Splash Animation */
        #splash-screen { background: linear-gradient(135deg, #16a34a, #14532d); }
        .letter { display: inline-block; opacity: 0; transform: scale(0.5); font-size: 3.5rem; font-weight: bold; color: white; text-shadow: 2px 2px 10px rgba(0,0,0,0.2); }
        .animate-letter { animation: popIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes popIn { to { opacity: 1; transform: scale(1); } }

        /* Pull to Refresh Indicator */
        #ptr-indicator { height: 0; overflow: hidden; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; background: #f3f4f6; color: #16a34a; font-weight: bold; }
        #ptr-indicator.active { height: 60px; }

        /* Banner Slider */
        .slider-wrapper { aspect-ratio: 16/7; overflow: hidden; position: relative; width: 100%; border-radius: 0.5rem; }
        .slider-track { display: flex; transition: transform 0.5s ease-in-out; height: 100%; }
        .slide { min-width: 100%; height: 100%; object-fit: cover; cursor: pointer; }

        /* Modals & Overlays */
        .modal-overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 200; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { transform: translateY(50px); transition: all 0.3s ease; }
        .modal-overlay.active .modal-content { transform: translateY(0); }

        /* Auth Tabs */
        .auth-tab-active { border-bottom: 3px solid #16a34a; color: #16a34a; font-weight: bold; }
        .auth-tab-inactive { color: #6b7280; }

        /* Layout */
        .app-container { max-width: 480px; margin: 0 auto; background: white; min-height: 100vh; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        .content-area { padding-bottom: 80px; padding-top: 60px; height: 100vh; overflow-y: auto; }
        .nav-center { transform: translateY(-25px); border: 5px solid #f3f4f6; }
        #loading-overlay { background: rgba(255,255,255,0.8); backdrop-filter: blur(4px); z-index: 999; }

        /* Social Icons */
        .social-icon { @apply w-8 h-8 rounded-full flex items-center justify-center text-white shadow-md transition-transform hover:scale-110; }
        .theme-gradient { transition: background 0.3s ease; }
    </style>
</head>
<body>

<div class="app-container" id="app-container">

    <div id="splash-screen" class="absolute inset-0 z-[1000] flex flex-col items-center justify-center">
        <div class="w-24 h-24 bg-white/20 rounded-full flex items-center justify-center mb-6 animate-pulse">
            <i class="fas fa-leaf text-5xl text-white"></i>
        </div>
        <div id="splash-text" class="flex space-x-1">
            <span class="letter">‡¶™‡¶æ</span><span class="letter">‡¶∞</span><span class="letter">‡¶ñ‡¶æ</span><span class="letter">‡¶≤‡ßÄ</span>
        </div>
        <p class="text-white mt-4 opacity-90 text-lg tracking-wider">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶æ‡¶£‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</p>
    </div>

    <div id="loading-overlay" class="hidden-section absolute inset-0 flex items-center justify-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-primary"></div>
    </div>

    <!-- Auth Section (unchanged) -->
    <div id="auth-section" class="hidden-section flex flex-col min-h-screen bg-gray-50">
        <div class="bg-primary pt-16 pb-8 px-6 text-center text-white rounded-b-3xl shadow-lg">
            <div class="w-20 h-20 bg-white text-primary rounded-full flex items-center justify-center text-4xl mx-auto mb-4 shadow-inner"><i class="fas fa-home"></i></div>
            <h1 class="text-3xl font-bold">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ</h1>
            <p class="opacity-80 mt-1">‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        </div>
        
        <div class="px-6 py-6 flex-grow">
            <div class="flex border-b mb-6">
                <button id="tab-phone-auth" class="w-1/2 py-3 auth-tab-active text-lg transition">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</button>
                <button id="tab-email-auth" class="w-1/2 py-3 auth-tab-inactive text-lg transition">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</button>
            </div>

            <div id="auth-phone-div" class="space-y-4">
                <div>
                    <label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                    <input type="tel" id="auth-phone-num" placeholder="01XXXXXXXXX" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:border-primary">
                </div>
                <div>
                    <label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°</label>
                    <input type="password" id="auth-phone-pass" placeholder="******" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:border-primary">
                </div>
                <div class="flex space-x-3 pt-2">
                    <button id="btn-login-phone" class="w-1/2 bg-primary text-white rounded-lg py-3 font-bold shadow-md hover:bg-secondary transition">‡¶≤‡¶ó‡¶á‡¶®</button>
                    <button id="btn-register-phone" class="w-1/2 bg-white text-primary border-2 border-primary rounded-lg py-3 font-bold hover:bg-gray-50 transition">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</button>
                </div>
            </div>

            <div id="auth-email-div" class="hidden-section space-y-4">
                <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label><input type="email" id="auth-email" placeholder="example@mail.com" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:border-primary"></div>
                <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°</label><input type="password" id="auth-password" placeholder="******" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:border-primary"></div>
                <div class="flex space-x-3 pt-2">
                    <button id="btn-login-email" class="w-1/2 bg-primary text-white rounded-lg py-3 font-bold shadow-md hover:bg-secondary transition">‡¶≤‡¶ó‡¶á‡¶®</button>
                    <button id="btn-register-email" class="w-1/2 bg-white text-primary border-2 border-primary rounded-lg py-3 font-bold hover:bg-gray-50 transition">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Setup Section (updated with profile pic and social links) -->
    <div id="setup-section" class="hidden-section flex flex-col min-h-screen bg-white">
        <div class="bg-gradient-to-r from-primary to-secondary p-6 text-white text-center rounded-b-3xl">
            <h2 class="text-2xl font-bold mt-4">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <p class="opacity-90">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßã‡¶®</p>
        </div>
        <div class="px-6 py-8 space-y-4 overflow-y-auto">
            <!-- Profile Picture Upload -->
            <div class="flex flex-col items-center mb-4">
                <div class="relative">
                    <div id="setup-profile-pic-preview" class="w-24 h-24 rounded-full bg-gray-200 border-4 border-white shadow-md flex items-center justify-center text-gray-400 text-4xl overflow-hidden">
                        <i class="fas fa-user"></i>
                    </div>
                    <button id="upload-profile-setup" class="absolute bottom-0 right-0 bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg hover:bg-secondary transition"><i class="fas fa-camera"></i></button>
                </div>
                <p class="text-xs text-gray-500 mt-2">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            </div>
            <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="setup-name" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary"></div>
            <div id="setup-phone-container"><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label><input type="tel" id="setup-phone" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary"></div>
            <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶™‡ßá‡¶∂‡¶æ / ‡¶ö‡¶æ‡¶ï‡ßÅ‡¶∞‡ßÄ</label><input type="text" id="setup-profession" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary"></div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</label>
                    <select id="setup-blood" class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white focus:border-primary">
                        <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option><option value="A+">A+</option><option value="A-">A-</option>
                        <option value="B+">B+</option><option value="B-">B-</option><option value="O+">O+</option>
                        <option value="O-">O-</option><option value="AB+">AB+</option><option value="AB-">AB-</option>
                    </select>
                </div>
                <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶™‡¶æ‡ßú‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="setup-para" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary"></div>
            </div>
            <!-- Social Links -->
            <div class="border-t pt-4 mt-2">
                <p class="text-sm font-semibold text-gray-700 mb-3">‡¶∏‡¶æ‡¶Æ‡¶æ‡¶ú‡¶ø‡¶ï ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</p>
                <div class="space-y-3">
                    <div class="flex items-center"><i class="fab fa-facebook text-blue-600 w-8 text-xl"></i><input type="text" id="setup-facebook" placeholder="Facebook username ‡¶¨‡¶æ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï" class="flex-1 px-3 py-2 border rounded-lg"></div>
                    <div class="flex items-center"><i class="fab fa-whatsapp text-green-500 w-8 text-xl"></i><input type="text" id="setup-whatsapp" placeholder="WhatsApp ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (‡¶Ø‡ßá‡¶Æ‡¶®: 8801XXXXXXXXX)" class="flex-1 px-3 py-2 border rounded-lg"></div>
                    <div class="flex items-center"><i class="fab fa-telegram text-blue-400 w-8 text-xl"></i><input type="text" id="setup-telegram" placeholder="Telegram username" class="flex-1 px-3 py-2 border rounded-lg"></div>
                </div>
            </div>
            <button id="btn-save-profile" class="w-full bg-primary text-white rounded-lg py-4 mt-6 font-bold text-lg shadow-lg hover:bg-secondary transition"><i class="fas fa-check-circle mr-2"></i> ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden-section h-full flex flex-col">
        <header class="absolute top-0 w-full text-white px-4 py-3 flex items-center justify-between z-40 shadow-md" id="app-header">
            <h2 class="text-xl font-bold flex items-center"><i class="fas fa-leaf mr-2 text-accent"></i> ‡¶™‡¶æ‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ</h2>
            <div class="relative w-[55%]">
                <input type="text" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." class="w-full bg-white/20 text-white placeholder-white/70 px-4 py-1.5 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-white">
                <i class="fas fa-search absolute right-3 top-2.5 text-white/70 text-xs"></i>
            </div>
        </header>

        <main class="content-area bg-gray-100 relative" id="scrollable-content">
            <div id="ptr-indicator"><i class="fas fa-sync fa-spin mr-2"></i> ‡¶∞‡¶ø‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
            
            <!-- Home Tab -->
            <div id="tab-home" class="p-4 page-tab space-y-5">
                <div class="flex items-center justify-between bg-white p-4 rounded-xl shadow-sm border-l-4 border-primary">
                    <div><p class="text-gray-500 text-xs font-semibold">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ</p><h3 class="text-lg font-bold text-gray-800" id="welcome-name">---</h3></div>
                    <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-primary overflow-hidden" id="home-profile-pic"><i class="fas fa-user-circle text-2xl"></i></div>
                </div>

                <div class="slider-wrapper shadow-md bg-white">
                    <div id="banner-track" class="slider-track">
                        <div class="slide bg-gray-200 flex items-center justify-center"><i class="fas fa-image text-4xl text-gray-400"></i></div>
                    </div>
                </div>

                <h4 class="font-bold text-gray-800 text-lg px-1">‡¶è‡¶ï ‡¶®‡¶ú‡¶∞‡ßá ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center space-x-3">
                        <div class="w-12 h-12 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center text-xl"><i class="fas fa-users"></i></div>
                        <div><h5 class="font-semibold text-gray-700 text-sm">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</h5><p id="total-users-count" class="text-lg font-bold text-gray-900">0</p></div>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center space-x-3">
                        <div class="w-12 h-12 rounded-full bg-emerald-50 text-emerald-500 flex items-center justify-center text-xl"><i class="fas fa-mosque"></i></div>
                        <div><h5 class="font-semibold text-gray-700 text-sm">‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶</h5><p class="text-lg font-bold text-gray-900">‡ß© ‡¶ü‡¶ø</p></div>
                    </div>
                </div>
            </div>

            <!-- Villagers Tab -->
            <div id="tab-villagers" class="hidden-section p-4 page-tab">
                <div class="relative mb-5">
                    <input type="text" id="search-villager" placeholder="‡¶®‡¶æ‡¶Æ, ‡¶™‡ßá‡¶∂‡¶æ ‡¶¨‡¶æ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." class="w-full px-4 py-3 pl-11 rounded-xl border border-gray-200 shadow-sm focus:border-primary focus:ring-1 focus:ring-primary outline-none">
                    <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
                </div>
                <div id="villagers-list" class="space-y-3"></div>
            </div>

            <!-- Services Tab (unchanged) -->
            <div id="tab-services" class="hidden-section p-4 page-tab">
                <h3 class="text-xl font-bold text-gray-800 mb-5 text-center mt-2">‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-5 rounded-xl shadow-sm text-center border border-gray-100"><div class="w-14 h-14 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl"><i class="fas fa-ambulance"></i></div><h5 class="font-bold text-gray-700">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡ßç‡¶¨‡ßÅ‡¶≤‡ßá‡¶®‡ßç‡¶∏</h5></div>
                    <div class="bg-white p-5 rounded-xl shadow-sm text-center border border-gray-100"><div class="w-14 h-14 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl"><i class="fas fa-user-md"></i></div><h5 class="font-bold text-gray-700">‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞</h5></div>
                    <div class="bg-white p-5 rounded-xl shadow-sm text-center border border-gray-100"><div class="w-14 h-14 bg-yellow-50 text-yellow-600 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl"><i class="fas fa-bolt"></i></div><h5 class="font-bold text-gray-700">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶Ö‡¶´‡¶ø‡¶∏</h5></div>
                    <div class="bg-white p-5 rounded-xl shadow-sm text-center border border-gray-100"><div class="w-14 h-14 bg-green-50 text-green-600 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl"><i class="fas fa-shield-alt"></i></div><h5 class="font-bold text-gray-700">‡¶•‡¶æ‡¶®‡¶æ ‡¶™‡ßÅ‡¶≤‡¶ø‡¶∂</h5></div>
                </div>
            </div>

            <!-- Notice Tab (updated) -->
            <div id="tab-notice" class="hidden-section p-4 page-tab">
                <h3 class="font-bold text-gray-800 mb-4 text-lg">‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¨‡ßã‡¶∞‡ßç‡¶°</h3>
                <div id="notice-list" class="space-y-3"></div>
            </div>

            <!-- Profile Tab (updated) -->
            <div id="tab-profile" class="hidden-section p-4 page-tab">
                <div class="bg-white rounded-2xl shadow-sm p-6 text-center border border-gray-100 relative overflow-hidden mb-4">
                    <div class="absolute top-0 left-0 w-full h-24 bg-primary/10"></div>
                    <div class="w-24 h-24 bg-white border-4 border-white shadow-md rounded-full mx-auto mb-3 relative z-10 flex items-center justify-center overflow-hidden" id="profile-pic-container">
                        <i class="fas fa-user text-4xl text-gray-400"></i>
                    </div>
                    <h2 id="prof-name" class="text-2xl font-bold text-gray-800">---</h2>
                    <p id="prof-profession" class="text-primary font-semibold text-sm mb-1">---</p>
                    <p id="prof-para" class="text-gray-500 text-sm mb-5"><i class="fas fa-map-marker-alt mr-1"></i>---</p>
                    
                    <div class="grid grid-cols-2 gap-3 text-left mb-4">
                        <div class="bg-gray-50 p-3 rounded-lg border border-gray-100 flex items-center space-x-3"><i class="fas fa-tint text-red-500 text-xl"></i><div><p class="text-xs text-gray-500">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</p><p id="prof-blood" class="font-bold text-gray-800">---</p></div></div>
                        <div class="bg-gray-50 p-3 rounded-lg border border-gray-100 flex items-center space-x-3"><i class="fas fa-phone-alt text-green-500 text-xl"></i><div class="overflow-hidden"><p class="text-xs text-gray-500">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</p><p id="prof-phone" class="font-bold text-gray-800 text-sm truncate">---</p></div></div>
                    </div>

                    <!-- Social Icons in Profile -->
                    <div class="flex justify-center space-x-4 mb-5" id="profile-social-icons"></div>
                </div>
                
                <div class="grid gap-3">
                    <button onclick="openEditProfile()" class="w-full bg-blue-50 text-blue-600 font-bold py-3 rounded-xl border border-blue-100 hover:bg-blue-100 transition"><i class="fas fa-user-edit mr-2"></i> ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <button id="btn-logout" class="w-full bg-red-50 text-red-500 font-bold py-3 rounded-xl border border-red-100 hover:bg-red-100 transition"><i class="fas fa-sign-out-alt mr-2"></i> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <!-- Admin Tab (Enhanced) -->
            <div id="tab-admin" class="hidden-section p-4 page-tab relative min-h-screen">
                <div id="admin-main-menu">
                    <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white rounded-2xl shadow-lg p-6 text-center mb-6 relative overflow-hidden">
                        <i class="fas fa-user-shield text-5xl mb-3 text-accent opacity-90"></i>
                        <h2 class="text-2xl font-bold">‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
                        <p class="text-sm opacity-80">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</p>
                    </div>

                    <div class="grid gap-3">
                        <button onclick="showAdminPage('admin-banner-page')" class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 flex items-center justify-between font-bold text-gray-700 hover:bg-gray-50"><span class="flex items-center"><i class="fas fa-images text-primary w-8 text-xl"></i> ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú</span><i class="fas fa-chevron-right text-gray-300"></i></button>
                        <button onclick="showAdminPage('admin-notice-page')" class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 flex items-center justify-between font-bold text-gray-700 hover:bg-gray-50"><span class="flex items-center"><i class="fas fa-bullhorn text-primary w-8 text-xl"></i> ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú</span><i class="fas fa-chevron-right text-gray-300"></i></button>
                        <button onclick="showAdminPage('admin-user-page')" class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 flex items-center justify-between font-bold text-gray-700 hover:bg-gray-50"><span class="flex items-center"><i class="fas fa-users-cog text-primary w-8 text-xl"></i> ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú</span><i class="fas fa-chevron-right text-gray-300"></i></button>
                        <button onclick="showAdminPage('admin-theme-page')" class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 flex items-center justify-between font-bold text-gray-700 hover:bg-gray-50"><span class="flex items-center"><i class="fas fa-palette text-primary w-8 text-xl"></i> ‡¶•‡¶ø‡¶Æ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶á‡¶ú</span><i class="fas fa-chevron-right text-gray-300"></i></button>
                    </div>
                </div>

                <!-- Admin Banner Page (with Cloudinary) -->
                <div id="admin-banner-page" class="hidden-section absolute inset-0 bg-gray-100 z-10 p-4 overflow-y-auto">
                    <button onclick="showAdminPage('admin-main-menu')" class="mb-5 text-gray-600 font-bold hover:text-primary"><i class="fas fa-arrow-left mr-2"></i> ‡¶™‡ßá‡¶õ‡¶®‡ßá ‡¶Ø‡¶æ‡¶®</button>
                    <h3 class="font-bold text-gray-800 text-xl mb-4">‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® (16:7)</h3>
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200 mb-6">
                        <div class="mb-4">
                            <button id="upload-banner-admin" class="w-full bg-dark text-white rounded-lg py-3 font-bold hover:bg-black transition"><i class="fas fa-cloud-upload-alt mr-1"></i> ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ì ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
                            <div id="banner-preview" class="mt-3 hidden"><img src="" class="w-full rounded-lg border" style="aspect-ratio:16/7; object-fit:cover"></div>
                        </div>
                        <label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶≤‡¶ø‡¶Ç‡¶ï URL (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                        <input type="text" id="admin-banner-url" placeholder="‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ï‡ßã‡¶•‡¶æ‡ßü ‡¶Ø‡¶æ‡¶¨‡ßá" class="w-full px-4 py-3 mb-4 rounded-lg border border-gray-300">
                        <button id="btn-add-banner" class="w-full bg-dark text-white rounded-lg py-3 font-bold hover:bg-black transition"><i class="fas fa-plus-circle mr-1"></i> ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                </div>

                <!-- Admin Notice Page -->
                <div id="admin-notice-page" class="hidden-section absolute inset-0 bg-gray-100 z-10 p-4 overflow-y-auto">
                    <button onclick="showAdminPage('admin-main-menu')" class="mb-5 text-gray-600 font-bold hover:text-primary"><i class="fas fa-arrow-left mr-2"></i> ‡¶™‡ßá‡¶õ‡¶®‡ßá ‡¶Ø‡¶æ‡¶®</button>
                    <h3 class="font-bold text-gray-800 text-xl mb-4">‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¶‡¶ø‡¶®</h3>
                    <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                        <input type="text" id="notice-title" placeholder="‡¶®‡ßã‡¶ü‡¶ø‡¶∂‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ" class="w-full px-4 py-3 mb-4 rounded-lg border border-gray-300">
                        <textarea id="notice-content" placeholder="‡¶®‡ßã‡¶ü‡¶ø‡¶∂‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§..." rows="4" class="w-full px-4 py-3 mb-4 rounded-lg border border-gray-300"></textarea>
                        <button id="btn-publish-notice" class="w-full bg-primary text-white rounded-lg py-3 font-bold hover:bg-secondary transition"><i class="fas fa-paper-plane mr-1"></i> ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                    <h4 class="font-bold mt-6 mb-3">‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂</h4>
                    <div id="admin-notice-list" class="space-y-2"></div>
                </div>

                <!-- Admin User Manage Page -->
                <div id="admin-user-page" class="hidden-section absolute inset-0 bg-gray-100 z-10 p-4 overflow-y-auto">
                    <button onclick="showAdminPage('admin-main-menu')" class="mb-5 text-gray-600 font-bold hover:text-primary"><i class="fas fa-arrow-left mr-2"></i> ‡¶™‡ßá‡¶õ‡¶®‡ßá ‡¶Ø‡¶æ‡¶®</button>
                    <h3 class="font-bold text-gray-800 text-xl mb-4">‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h3>
                    <input type="text" id="admin-user-search" placeholder="‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." class="w-full px-4 py-3 rounded-lg border border-gray-300 mb-4">
                    <div id="admin-user-list" class="space-y-3"></div>
                </div>

                <!-- Admin Theme Page -->
                <div id="admin-theme-page" class="hidden-section absolute inset-0 bg-gray-100 z-10 p-4 overflow-y-auto">
                    <button onclick="showAdminPage('admin-main-menu')" class="mb-5 text-gray-600 font-bold hover:text-primary"><i class="fas fa-arrow-left mr-2"></i> ‡¶™‡ßá‡¶õ‡¶®‡ßá ‡¶Ø‡¶æ‡¶®</button>
                    <h3 class="font-bold text-gray-800 text-xl mb-4">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶•‡¶ø‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    <div class="grid grid-cols-2 gap-4" id="theme-grid">
                        <!-- Gradient options will be injected -->
                    </div>
                </div>
            </div>
        </main>

        <nav class="absolute bottom-0 w-full bg-white shadow-[0_-5px_15px_rgba(0,0,0,0.05)] flex justify-around items-center px-2 py-2 z-40 rounded-t-2xl border-t border-gray-100">
            <button onclick="switchTab('home')" class="nav-btn flex flex-col items-center text-gray-400 hover:text-primary w-1/5" data-target="tab-home"><i class="fas fa-home text-xl mb-1"></i><span class="text-[10px] font-bold">‡¶π‡ßã‡¶Æ</span></button>
            <button onclick="switchTab('villagers')" class="nav-btn flex flex-col items-center text-gray-400 hover:text-primary w-1/5" data-target="tab-villagers"><i class="fas fa-users text-xl mb-1"></i><span class="text-[10px] font-bold">‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶¨‡¶æ‡¶∏‡ßÄ</span></button>
            <div class="w-1/5 flex justify-center relative">
                <button onclick="switchTab('services')" class="nav-btn nav-center w-14 h-14 bg-gradient-to-br from-primary to-secondary text-white rounded-full flex items-center justify-center shadow-[0_5px_15px_rgba(22,163,74,0.4)] hover:scale-105 transition-transform" data-target="tab-services">
                    <i class="fas fa-th-large text-2xl"></i>
                </button>
            </div>
            <button onclick="switchTab('notice')" class="nav-btn flex flex-col items-center text-gray-400 hover:text-primary w-1/5" data-target="tab-notice"><i class="fas fa-bell text-xl mb-1"></i><span class="text-[10px] font-bold">‡¶®‡ßã‡¶ü‡¶ø‡¶∂</span></button>
            <button onclick="switchTab('profile')" class="nav-btn flex flex-col items-center text-gray-400 hover:text-primary w-1/5" data-target="tab-profile"><i class="fas fa-user text-xl mb-1"></i><span class="text-[10px] font-bold">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</span></button>
            <button id="admin-nav-btn" class="hidden-section nav-btn flex flex-col items-center text-dark hover:text-primary w-1/5" data-target="tab-admin"><i class="fas fa-shield-alt text-xl mb-1"></i><span class="text-[10px] font-bold">‡¶è‡¶°‡¶Æ‡¶ø‡¶®</span></button>
        </nav>
    </div>
</div>

<!-- Edit Profile Modal (updated) -->
<div id="edit-profile-modal" class="fixed inset-0 modal-overlay flex flex-col justify-end px-0 pb-0 z-[200]">
    <div class="modal-content bg-white w-full max-w-md mx-auto rounded-t-3xl overflow-hidden shadow-2xl relative h-[90vh] flex flex-col">
        <div class="p-4 border-b flex justify-between items-center bg-gray-50">
            <h3 class="text-xl font-bold text-gray-800">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü</h3>
            <button onclick="closeModal('edit-profile-modal')" class="w-8 h-8 bg-gray-200 rounded-full flex justify-center items-center text-gray-600"><i class="fas fa-times"></i></button>
        </div>
        <div class="p-6 overflow-y-auto flex-grow space-y-4">
            <!-- Profile Pic Upload -->
            <div class="flex flex-col items-center">
                <div class="relative">
                    <div id="edit-profile-pic-preview" class="w-24 h-24 rounded-full bg-gray-200 border-4 border-white shadow-md flex items-center justify-center text-gray-400 text-4xl overflow-hidden">
                        <i class="fas fa-user"></i>
                    </div>
                    <button id="upload-profile-edit" class="absolute bottom-0 right-0 bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg"><i class="fas fa-camera"></i></button>
                </div>
            </div>
            <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="edit-name" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary"></div>
            <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label><input type="tel" id="edit-phone" class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-gray-100" readonly></div>
            <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶™‡ßá‡¶∂‡¶æ / ‡¶ö‡¶æ‡¶ï‡ßÅ‡¶∞‡ßÄ</label><input type="text" id="edit-profession" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary"></div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</label>
                    <select id="edit-blood" class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white focus:border-primary">
                        <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option><option value="A+">A+</option><option value="A-">A-</option>
                        <option value="B+">B+</option><option value="B-">B-</option><option value="O+">O+</option>
                        <option value="O-">O-</option><option value="AB+">AB+</option><option value="AB-">AB-</option>
                    </select>
                </div>
                <div><label class="block text-gray-700 text-sm mb-1 font-semibold">‡¶™‡¶æ‡ßú‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="edit-para" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-primary"></div>
            </div>
            <!-- Social Links Edit -->
            <div class="border-t pt-4">
                <p class="text-sm font-semibold text-gray-700 mb-3">‡¶∏‡¶æ‡¶Æ‡¶æ‡¶ú‡¶ø‡¶ï ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó</p>
                <div class="space-y-3">
                    <div class="flex items-center"><i class="fab fa-facebook text-blue-600 w-8 text-xl"></i><input type="text" id="edit-facebook" placeholder="Facebook username" class="flex-1 px-3 py-2 border rounded-lg"></div>
                    <div class="flex items-center"><i class="fab fa-whatsapp text-green-500 w-8 text-xl"></i><input type="text" id="edit-whatsapp" placeholder="WhatsApp ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" class="flex-1 px-3 py-2 border rounded-lg"></div>
                    <div class="flex items-center"><i class="fab fa-telegram text-blue-400 w-8 text-xl"></i><input type="text" id="edit-telegram" placeholder="Telegram username" class="flex-1 px-3 py-2 border rounded-lg"></div>
                </div>
            </div>
            <button id="btn-update-profile" class="w-full bg-blue-600 text-white rounded-lg py-4 mt-4 font-bold text-lg shadow hover:bg-blue-700 transition"><i class="fas fa-save mr-2"></i> ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>
</div>

<!-- Success Modal (unchanged) -->
<div id="success-modal" class="fixed inset-0 modal-overlay flex items-center justify-center px-4 z-[300]">
    <div class="modal-content bg-white w-full max-w-sm rounded-2xl p-6 text-center shadow-2xl">
        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-check text-4xl text-green-500"></i></div>
        <h3 class="text-2xl font-bold text-gray-800 mb-2" id="success-title">‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!</h3>
        <p class="text-gray-600 font-medium" id="success-msg">‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶´‡¶≤‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ü‡¶ø ‡¶§‡ßà‡¶∞‡ßÄ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§</p>
    </div>
</div>

<!-- Exist Modal (unchanged) -->
<div id="exist-modal" class="fixed inset-0 modal-overlay flex items-center justify-center px-4 z-[300]" onclick="if(event.target === this) closeModal('exist-modal')">
    <div class="modal-content bg-white w-full max-w-sm rounded-2xl p-6 text-center shadow-2xl relative">
        <button onclick="closeModal('exist-modal')" class="absolute top-3 right-3 w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-200"><i class="fas fa-times"></i></button>
        <div class="w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-exclamation-triangle text-4xl text-yellow-500"></i></div>
        <h3 class="text-xl font-bold text-gray-800 mb-2">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∞‡ßü‡ßá‡¶õ‡ßá!</h3>
        <p class="text-gray-600 font-medium text-sm leading-relaxed">‡¶è‡¶á ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶è‡¶ï‡¶ü‡¶ø ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá‡•§</p>
        <button onclick="closeModal('exist-modal')" class="w-full bg-primary text-white rounded-lg py-3 mt-5 font-bold shadow hover:bg-secondary transition">‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá</button>
    </div>
</div>

<!-- Villager Modal (updated with social icons) -->
<div id="villager-modal" class="fixed inset-0 modal-overlay flex items-center justify-center px-4 z-[100]" onclick="if(event.target === this) closeModal('villager-modal')">
    <div class="modal-content bg-white w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl relative">
        <button type="button" onclick="closeModal('villager-modal')" class="absolute top-3 right-3 w-8 h-8 bg-white border border-gray-200 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-100 z-50 shadow-sm"><i class="fas fa-times"></i></button>
        <div class="bg-primary/10 h-24 w-full absolute top-0 left-0 z-0"></div>
        <div class="px-6 pt-12 pb-6 text-center relative z-10">
            <div class="w-20 h-20 bg-white border-4 border-white shadow-md rounded-full mx-auto mb-3 flex items-center justify-center overflow-hidden" id="v-modal-pic">
                <i class="fas fa-user text-3xl text-gray-400"></i>
            </div>
            <h3 id="v-modal-name" class="text-2xl font-bold text-gray-800">---</h3>
            <p id="v-modal-prof" class="text-primary font-semibold text-sm mb-4">---</p>
            <div class="space-y-3 text-left bg-gray-50 p-4 rounded-xl border border-gray-100">
                <div class="flex items-center"><i class="fas fa-map-marker-alt w-6 text-gray-400"></i> <span id="v-modal-para" class="text-gray-700 font-medium">---</span></div>
                <div class="flex items-center"><i class="fas fa-phone-alt w-6 text-gray-400"></i> <a id="v-modal-phone" href="#" class="text-blue-600 font-bold">---</a></div>
                <div class="flex items-center"><i class="fas fa-tint w-6 text-gray-400"></i> <span id="v-modal-blood" class="font-bold text-red-500 bg-red-100 px-2 rounded">---</span></div>
            </div>
            <!-- Social Icons -->
            <div class="flex justify-center space-x-4 mt-5" id="v-modal-social"></div>
            <div class="mt-4">
                <a id="v-modal-call" href="#" class="w-full block bg-green-500 text-white py-2 rounded-lg font-bold shadow hover:bg-green-600"><i class="fas fa-phone mr-1"></i> ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, updateDoc, getDoc, collection, getDocs, addDoc, query, orderBy, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAuqcDRrtuQi2tdWXA2E_UWyq7pCrGpoy4",
      authDomain: "parkhali-village.firebaseapp.com",
      projectId: "parkhali-village",
      storageBucket: "parkhali-village.firebasestorage.app",
      messagingSenderId: "645968583344",
      appId: "1:645968583344:web:89a049e6ffaba4af33b975",
      measurementId: "G-WD2LSS97KC"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Cloudinary config
    const CLOUD_NAME = 'dwnpdwnvc';
    const UPLOAD_PRESET = 'Parkhali';
    
    // Admin configuration ‚Äì ‡¶∏‡¶π‡¶ú‡ßá‡¶á ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶á‡¶Æ‡ßá‡¶á‡¶≤/‡¶´‡ßã‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
    const ADMIN_CONFIG = {
        emails: ['mdwld2005@gmail.com'],        // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®
        phones: ['01926642085']                  // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®
    };

    let currentUserData = null;
    let allVillagers = [];

    const showLoader = (show) => document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none';

    // Initialize Cloudinary widget
    function openCloudinaryWidget(callback, cropping = false) {
        const options = {
            cloudName: CLOUD_NAME,
            uploadPreset: UPLOAD_PRESET,
            cropping: cropping,
            croppingAspectRatio: cropping ? 16/7 : undefined,
            showAdvancedOptions: false,
            multiple: false,
            defaultSource: 'local',
            styles: { palette: { window: '#16a34a', sourceBg: '#f4f4f4', windowBorder: '#90a0b3', tabIcon: '#16a34a', inactiveTabIcon: '#69778A', menuIcons: '#16a34a', link: '#15803d', action: '#16a34a', inProgress: '#16a34a', complete: '#16a34a', error: '#c43737', textDark: '#000000', textLight: '#FFFFFF' } }
        };
        const widget = cloudinary.openUploadWidget(options, (error, result) => {
            if (!error && result && result.event === 'success') {
                callback(result.info.secure_url);
            }
        });
        widget.open();
    }

    // Splash and auth state
    window.onload = () => {
        const letters = document.querySelectorAll('.letter');
        letters.forEach((letter, index) => { setTimeout(() => { letter.classList.add('animate-letter'); }, index * 150); });

        setTimeout(() => {
            onAuthStateChanged(auth, async (user) => {
                document.getElementById('splash-screen').classList.add('hidden-section');
                if (user) { 
                    // Check if user is banned
                    const userDoc = await getDoc(doc(db, "users", user.uid));
                    if (userDoc.exists() && userDoc.data().banned) {
                        alert("‡¶è‡¶á ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                        signOut(auth);
                        showSection('auth-section');
                    } else {
                        checkProfileAndRedirect(user); 
                    }
                } else { showSection('auth-section'); }
            });
        }, 2500);
    };

    function showSection(sectionId) {
        ['auth-section', 'setup-section', 'main-app'].forEach(id => document.getElementById(id).classList.add('hidden-section'));
        document.getElementById(sectionId).classList.remove('hidden-section');
    }

    window.openModal = (id) => document.getElementById(id).classList.add('active');
    window.closeModal = (id) => document.getElementById(id).classList.remove('active');

    // Pull to Refresh
    let startY = 0;
    const contentArea = document.getElementById('scrollable-content');
    const ptrIndicator = document.getElementById('ptr-indicator');
    
    contentArea.addEventListener('touchstart', e => {
        if(contentArea.scrollTop === 0) startY = e.touches[0].clientY;
    }, {passive: true});
    
    contentArea.addEventListener('touchmove', e => {
        if(contentArea.scrollTop === 0 && startY > 0) {
            const y = e.touches[0].clientY;
            if(y - startY > 70) { ptrIndicator.classList.add('active'); }
        }
    }, {passive: true});
    
    contentArea.addEventListener('touchend', e => {
        if(ptrIndicator.classList.contains('active')) {
            setTimeout(() => { window.location.reload(); }, 500);
        }
        startY = 0;
    });

    // Tab Logic
    window.switchTab = function(tabName) {
        document.querySelectorAll('.page-tab').forEach(tab => tab.classList.add('hidden-section'));
        document.getElementById(`tab-${tabName}`).classList.remove('hidden-section');
        document.querySelectorAll('.nav-btn').forEach(btn => {
            if(!btn.classList.contains('nav-center')) { btn.classList.remove('text-primary'); btn.classList.add('text-gray-400'); }
        });
        const activeBtn = document.querySelector(`[data-target="tab-${tabName}"]`);
        if(activeBtn && !activeBtn.classList.contains('nav-center')) { activeBtn.classList.remove('text-gray-400'); activeBtn.classList.add('text-primary'); }

        if(tabName === 'villagers') loadVillagers();
        if(tabName === 'home') { loadBanners(); updateHomeProfilePic(); }
        if(tabName === 'notice') loadNotices();
        if(tabName === 'profile') loadProfileData();
        if(tabName === 'admin') showAdminPage('admin-main-menu');
    };

    window.showAdminPage = function(pageId) {
        ['admin-main-menu', 'admin-banner-page', 'admin-notice-page', 'admin-user-page', 'admin-theme-page'].forEach(id => {
            document.getElementById(id).classList.add('hidden-section');
        });
        document.getElementById(pageId).classList.remove('hidden-section');
        if (pageId === 'admin-user-page') loadAdminUsers();
        if (pageId === 'admin-notice-page') loadAdminNotices();
        if (pageId === 'admin-theme-page') loadThemeOptions();
    };

    // Auth UI Toggle
    document.getElementById('tab-phone-auth').addEventListener('click', (e) => {
        e.target.className = "w-1/2 py-3 auth-tab-active text-lg transition"; document.getElementById('tab-email-auth').className = "w-1/2 py-3 auth-tab-inactive text-lg transition";
        document.getElementById('auth-phone-div').classList.remove('hidden-section'); document.getElementById('auth-email-div').classList.add('hidden-section');
    });
    document.getElementById('tab-email-auth').addEventListener('click', (e) => {
        e.target.className = "w-1/2 py-3 auth-tab-active text-lg transition"; document.getElementById('tab-phone-auth').className = "w-1/2 py-3 auth-tab-inactive text-lg transition";
        document.getElementById('auth-email-div').classList.remove('hidden-section'); document.getElementById('auth-phone-div').classList.add('hidden-section');
    });

    const formatPhoneAsEmail = (phone) => `${phone}@parkhali.local`;

    // Phone Registration
    document.getElementById('btn-register-phone').addEventListener('click', () => {
        const phone = document.getElementById('auth-phone-num').value.trim();
        const pass = document.getElementById('auth-phone-pass').value;
        if(phone.length < 11 || !phone.startsWith('01')) return alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡ßß‡ßß ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®");
        if(!pass || pass.length < 6) return alert("‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá");

        showLoader(true);
        createUserWithEmailAndPassword(auth, formatPhoneAsEmail(phone), pass)
        .then(() => { showLoader(false); })
        .catch((error) => { showLoader(false); error.code === 'auth/email-already-in-use' ? openModal('exist-modal') : alert("‡¶è‡¶∞‡¶∞: " + error.message); });
    });

    document.getElementById('btn-login-phone').addEventListener('click', () => {
        const phone = document.getElementById('auth-phone-num').value.trim(); const pass = document.getElementById('auth-phone-pass').value;
        if(!phone || !pass) return alert("‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®");
        showLoader(true);
        signInWithEmailAndPassword(auth, formatPhoneAsEmail(phone), pass)
        .then(() => { showLoader(false); })
        .catch(() => { showLoader(false); alert("‡¶≠‡ßÅ‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"); });
    });

    // Profile Check
    async function checkProfileAndRedirect(user) {
        showLoader(true);
        const docRef = doc(db, "users", user.uid);
        const docSnap = await getDoc(docRef);
        showLoader(false);

        if (docSnap.exists()) {
            currentUserData = docSnap.data();
            if (currentUserData.banned) {
                alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
                signOut(auth);
                return;
            }
            setupMainApp(user, currentUserData);
            showSection('main-app');
            switchTab('home');
        } else {
            if(user.email && user.email.includes('@parkhali.local')) {
                document.getElementById('setup-phone').value = user.email.split('@')[0];
                document.getElementById('setup-phone-container').classList.add('hidden-section'); 
            } else {
                document.getElementById('setup-phone-container').classList.remove('hidden-section'); 
            }
            showSection('setup-section');
        }
    }

    // Profile picture upload handlers
    document.getElementById('upload-profile-setup').addEventListener('click', () => {
        openCloudinaryWidget((url) => {
            document.getElementById('setup-profile-pic-preview').innerHTML = `<img src="${url}" class="w-full h-full object-cover">`;
            document.getElementById('setup-profile-pic-preview').dataset.url = url;
        });
    });

    document.getElementById('upload-profile-edit').addEventListener('click', () => {
        openCloudinaryWidget((url) => {
            document.getElementById('edit-profile-pic-preview').innerHTML = `<img src="${url}" class="w-full h-full object-cover">`;
            document.getElementById('edit-profile-pic-preview').dataset.url = url;
        });
    });

    // Save Profile (Initial)
    document.getElementById('btn-save-profile').addEventListener('click', async () => {
        const name = document.getElementById('setup-name').value;
        let phone = document.getElementById('setup-phone').value;
        if(auth.currentUser.email && auth.currentUser.email.includes('@parkhali.local')) { phone = auth.currentUser.email.split('@')[0]; }
        const profession = document.getElementById('setup-profession').value;
        const blood = document.getElementById('setup-blood').value;
        const para = document.getElementById('setup-para').value;
        const profilePic = document.getElementById('setup-profile-pic-preview').dataset.url || '';
        const facebook = document.getElementById('setup-facebook').value;
        const whatsapp = document.getElementById('setup-whatsapp').value;
        const telegram = document.getElementById('setup-telegram').value;

        if(!name || !phone || !profession || !para) return alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®!");
        
        showLoader(true);
        try {
            await setDoc(doc(db, "users", auth.currentUser.uid), {
                uid: auth.currentUser.uid, email: auth.currentUser.email && !auth.currentUser.email.includes('@parkhali.local') ? auth.currentUser.email : "",
                name, phone, profession, blood, para, profilePic, facebook, whatsapp, telegram,
                joined: new Date().toISOString(), banned: false
            });
            showLoader(false);
            document.getElementById('success-title').innerText = "‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!";
            document.getElementById('success-msg').innerText = "‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶´‡¶≤‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ü‡¶ø ‡¶§‡ßà‡¶∞‡ßÄ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§";
            openModal('success-modal');
            setTimeout(() => { closeModal('success-modal'); checkProfileAndRedirect(auth.currentUser); }, 2500); 
        } catch(e) { showLoader(false); alert("‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§"); }
    });

    // Setup Main App
    function setupMainApp(user, data) {
        currentUserData = data;
        document.getElementById('welcome-name').innerText = data.name;
        document.getElementById('prof-name').innerText = data.name;
        document.getElementById('prof-profession').innerText = data.profession || '‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø';
        document.getElementById('prof-para').innerText = data.para || '‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶®‡ßá‡¶á';
        document.getElementById('prof-blood').innerText = data.blood || 'N/A';
        document.getElementById('prof-phone').innerText = data.phone;
        
        // Profile pic
        if (data.profilePic) {
            document.getElementById('home-profile-pic').innerHTML = `<img src="${data.profilePic}" class="w-full h-full object-cover">`;
            document.getElementById('profile-pic-container').innerHTML = `<img src="${data.profilePic}" class="w-full h-full object-cover">`;
        }
        // Social icons in profile
        renderSocialIcons('profile-social-icons', data);
        
        // Admin check ‚Äì ‡¶è‡¶ñ‡¶® ADMIN_CONFIG ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        if (ADMIN_CONFIG.emails.includes(user.email) || ADMIN_CONFIG.phones.includes(data.phone)) {
            document.getElementById('admin-nav-btn').classList.remove('hidden-section');
            document.querySelectorAll('.nav-btn').forEach(btn => { if(!btn.classList.contains('hidden-section')) btn.classList.replace('w-1/5', 'w-1/6'); });
        }
        loadBanners(); 
        loadTheme();
    }

    function renderSocialIcons(containerId, data) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        if (data.facebook) container.innerHTML += `<a href="https://facebook.com/${data.facebook}" target="_blank" class="social-icon bg-blue-600"><i class="fab fa-facebook-f"></i></a>`;
        if (data.whatsapp) container.innerHTML += `<a href="https://wa.me/${data.whatsapp.replace(/\+/g, '')}" target="_blank" class="social-icon bg-green-500"><i class="fab fa-whatsapp"></i></a>`;
        if (data.telegram) container.innerHTML += `<a href="https://t.me/${data.telegram}" target="_blank" class="social-icon bg-blue-400"><i class="fab fa-telegram-plane"></i></a>`;
    }

    // Edit Profile
    window.openEditProfile = function() {
        if(!currentUserData) return;
        document.getElementById('edit-name').value = currentUserData.name || '';
        document.getElementById('edit-phone').value = currentUserData.phone || '';
        document.getElementById('edit-profession').value = currentUserData.profession || '';
        document.getElementById('edit-blood').value = currentUserData.blood || '';
        document.getElementById('edit-para').value = currentUserData.para || '';
        document.getElementById('edit-facebook').value = currentUserData.facebook || '';
        document.getElementById('edit-whatsapp').value = currentUserData.whatsapp || '';
        document.getElementById('edit-telegram').value = currentUserData.telegram || '';
        if (currentUserData.profilePic) {
            document.getElementById('edit-profile-pic-preview').innerHTML = `<img src="${currentUserData.profilePic}" class="w-full h-full object-cover">`;
            document.getElementById('edit-profile-pic-preview').dataset.url = currentUserData.profilePic;
        }
        openModal('edit-profile-modal');
    };

    document.getElementById('btn-update-profile').addEventListener('click', async () => {
        const name = document.getElementById('edit-name').value;
        const profession = document.getElementById('edit-profession').value;
        const blood = document.getElementById('edit-blood').value;
        const para = document.getElementById('edit-para').value;
        const facebook = document.getElementById('edit-facebook').value;
        const whatsapp = document.getElementById('edit-whatsapp').value;
        const telegram = document.getElementById('edit-telegram').value;
        const profilePic = document.getElementById('edit-profile-pic-preview').dataset.url || currentUserData.profilePic || '';

        if(!name || !profession || !para) return alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®!");
        
        showLoader(true);
        try {
            await updateDoc(doc(db, "users", auth.currentUser.uid), {
                name, profession, blood, para, facebook, whatsapp, telegram, profilePic
            });
            currentUserData = { ...currentUserData, name, profession, blood, para, facebook, whatsapp, telegram, profilePic };
            setupMainApp(auth.currentUser, currentUserData);
            showLoader(false);
            closeModal('edit-profile-modal');
            document.getElementById('success-title').innerText = "‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!";
            document.getElementById('success-msg').innerText = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§";
            openModal('success-modal');
            setTimeout(() => { closeModal('success-modal'); }, 2000); 
        } catch(e) { showLoader(false); alert("‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá."); }
    });

    // Banner Slider
    let bannersLoaded = false;
    async function loadBanners() {
        const track = document.getElementById('banner-track');
        try {
            const querySnapshot = await getDocs(collection(db, "banners"));
            let banners = []; querySnapshot.forEach((doc) => banners.push(doc.data()));
            if(banners.length > 0) {
                track.innerHTML = '';
                banners.forEach(b => { track.innerHTML += `<img src="${b.imgUrl}" onclick="window.open('${b.linkUrl||'#'}', '_blank')" class="slide">`; });
                startSlider(banners.length);
            }
        } catch(e) { console.log(e); }
    }
    function startSlider(count) {
        if(count <= 1) return;
        const track = document.getElementById('banner-track'); let index = 0;
        setInterval(() => { index = (index + 1) % count; track.style.transform = `translateX(-${index * 100}%)`; }, 3500); 
    }

    // Admin: Add Banner with Cloudinary
    document.getElementById('upload-banner-admin').addEventListener('click', () => {
        openCloudinaryWidget((url) => {
            document.getElementById('banner-preview').classList.remove('hidden');
            document.getElementById('banner-preview').innerHTML = `<img src="${url}" class="w-full rounded-lg border" style="aspect-ratio:16/7; object-fit:cover">`;
            document.getElementById('banner-preview').dataset.url = url;
        }, true); // cropping true for 16:7
    });

    document.getElementById('btn-add-banner').addEventListener('click', async () => {
        const img = document.getElementById('banner-preview').dataset.url;
        const url = document.getElementById('admin-banner-url').value || '#';
        if(!img) return alert("‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®");
        showLoader(true);
        try {
            await addDoc(collection(db, "banners"), { imgUrl: img, linkUrl: url, addedAt: new Date() });
            alert("‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); 
            document.getElementById('banner-preview').classList.add('hidden');
            document.getElementById('admin-banner-url').value = '';
            bannersLoaded = false; 
            loadBanners();
        } catch(e) { alert("Error: "+e.message); }
        showLoader(false);
    });

    // Notices
    async function loadNotices() {
        const list = document.getElementById('notice-list');
        const q = query(collection(db, "notices"), orderBy("timestamp", "desc"));
        const snap = await getDocs(q);
        list.innerHTML = '';
        snap.forEach(doc => {
            const n = doc.data();
            list.innerHTML += `<div class="bg-white p-5 rounded-xl shadow-sm border-l-4 border-primary mb-3">
                <div class="flex justify-between items-start mb-2"><h4 class="font-bold text-gray-800 text-lg">${n.title}</h4><span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">${new Date(n.timestamp?.toDate()).toLocaleDateString('bn')}</span></div>
                <p class="text-sm text-gray-600 leading-relaxed">${n.content}</p>
            </div>`;
        });
    }

    document.getElementById('btn-publish-notice').addEventListener('click', async () => {
        const title = document.getElementById('notice-title').value;
        const content = document.getElementById('notice-content').value;
        if (!title || !content) return alert('‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡¶ø‡¶®');
        await addDoc(collection(db, "notices"), { title, content, timestamp: new Date() });
        alert('‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
        document.getElementById('notice-title').value = '';
        document.getElementById('notice-content').value = '';
        loadNotices();
        loadAdminNotices();
    });

    async function loadAdminNotices() {
        const list = document.getElementById('admin-notice-list');
        const q = query(collection(db, "notices"), orderBy("timestamp", "desc"));
        const snap = await getDocs(q);
        list.innerHTML = '';
        snap.forEach(docSnap => {
            const n = docSnap.data();
            list.innerHTML += `<div class="bg-white p-3 rounded flex justify-between items-center"><span>${n.title}</span><button class="text-red-500" onclick="deleteNotice('${docSnap.id}')"><i class="fas fa-trash"></i></button></div>`;
        });
    }
    window.deleteNotice = async (id) => {
        if (confirm('‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) { await deleteDoc(doc(db, "notices", id)); loadAdminNotices(); loadNotices(); }
    };

    // Villager List
    async function loadVillagers() {
        if(allVillagers.length === 0) {
            showLoader(true);
            const querySnapshot = await getDocs(collection(db, "users"));
            allVillagers = []; querySnapshot.forEach((doc) => { allVillagers.push(doc.data()); });
            document.getElementById('total-users-count').innerText = allVillagers.length;
            showLoader(false);
        }
        renderVillagers(allVillagers);
    }

    function renderVillagers(dataList) {
        const listContainer = document.getElementById('villagers-list');
        listContainer.innerHTML = '';
        dataList.filter(v => !v.banned).forEach(v => {
            const vData = encodeURIComponent(JSON.stringify(v));
            listContainer.innerHTML += `
                <div onclick="showVillagerDetails('${vData}')" class="bg-white p-3 rounded-xl shadow-sm border border-gray-100 flex items-center cursor-pointer hover:bg-green-50 transition">
                    <div class="w-12 h-12 bg-gray-100 rounded-full flex-shrink-0 mr-4 overflow-hidden border border-gray-200">${v.profilePic ? `<img src="${v.profilePic}" class="w-full h-full object-cover">` : '<i class="fas fa-user text-2xl flex items-center justify-center h-full text-gray-500"></i>'}</div>
                    <div class="flex-grow">
                        <h4 class="font-bold text-gray-800">${v.name || '‡¶Ö‡¶ú‡ßç‡¶û‡¶æ‡¶§'}</h4>
                        <p class="text-[11px] font-semibold text-primary mb-0.5">${v.profession || '‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø'}</p>
                        <p class="text-xs text-gray-500"><i class="fas fa-map-marker-alt text-gray-400 mr-1"></i>${v.para || '‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶®‡ßá‡¶á'}</p>
                    </div>
                    <div class="text-right"><i class="fas fa-chevron-right text-gray-300"></i></div>
                </div>
            `;
        });
    }

    window.showVillagerDetails = (encodedData) => {
        const v = JSON.parse(decodeURIComponent(encodedData));
        document.getElementById('v-modal-name').innerText = v.name || '‡¶Ö‡¶ú‡ßç‡¶û‡¶æ‡¶§';
        document.getElementById('v-modal-prof').innerText = v.profession || '‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø';
        document.getElementById('v-modal-para').innerText = v.para || '‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶®‡ßá‡¶á';
        document.getElementById('v-modal-phone').innerText = v.phone || '‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶®‡ßá‡¶á';
        document.getElementById('v-modal-phone').href = v.phone ? `tel:${v.phone}` : '#';
        document.getElementById('v-modal-call').href = v.phone ? `tel:${v.phone}` : '#';
        document.getElementById('v-modal-blood').innerText = v.blood || 'N/A';
        const picContainer = document.getElementById('v-modal-pic');
        if (v.profilePic) picContainer.innerHTML = `<img src="${v.profilePic}" class="w-full h-full object-cover">`;
        else picContainer.innerHTML = '<i class="fas fa-user text-3xl text-gray-400"></i>';
        // Social icons
        const socialDiv = document.getElementById('v-modal-social');
        socialDiv.innerHTML = '';
        if (v.facebook) socialDiv.innerHTML += `<a href="https://facebook.com/${v.facebook}" target="_blank" class="social-icon bg-blue-600"><i class="fab fa-facebook-f"></i></a>`;
        if (v.whatsapp) socialDiv.innerHTML += `<a href="https://wa.me/${v.whatsapp.replace(/\+/g, '')}" target="_blank" class="social-icon bg-green-500"><i class="fab fa-whatsapp"></i></a>`;
        if (v.telegram) socialDiv.innerHTML += `<a href="https://t.me/${v.telegram}" target="_blank" class="social-icon bg-blue-400"><i class="fab fa-telegram-plane"></i></a>`;
        openModal('villager-modal');
    }

    document.getElementById('search-villager').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = allVillagers.filter(v => 
            (v.name && v.name.toLowerCase().includes(term)) || (v.phone && v.phone.includes(term)) || (v.profession && v.profession.toLowerCase().includes(term))
        );
        renderVillagers(filtered);
    });

    // Admin User Management
    async function loadAdminUsers() {
        const snap = await getDocs(collection(db, "users"));
        const users = []; snap.forEach(d => users.push({ id: d.id, ...d.data() }));
        renderAdminUsers(users);
    }

    function renderAdminUsers(users) {
        const list = document.getElementById('admin-user-list');
        list.innerHTML = '';
        users.forEach(u => {
            list.innerHTML += `<div class="bg-white p-3 rounded-lg shadow flex items-center justify-between">
                <div><span class="font-bold">${u.name}</span> (${u.phone})</div>
                <div class="space-x-2">
                    <button onclick="toggleBanUser('${u.id}', ${u.banned})" class="text-sm px-2 py-1 rounded ${u.banned ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}">${u.banned ? 'Unban' : 'Ban'}</button>
                    <button onclick="deleteUser('${u.id}')" class="text-sm px-2 py-1 rounded bg-red-100 text-red-700"><i class="fas fa-trash"></i></button>
                </div>
            </div>`;
        });
    }

    window.toggleBanUser = async (uid, currentBan) => {
        await updateDoc(doc(db, "users", uid), { banned: !currentBan });
        loadAdminUsers();
    };
    window.deleteUser = async (uid) => {
        if (confirm('‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø‡¶ï‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®? (‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá)')) {
            await deleteDoc(doc(db, "users", uid));
            loadAdminUsers();
        }
    };

    document.getElementById('admin-user-search').addEventListener('input', async (e) => {
        const term = e.target.value.toLowerCase();
        const snap = await getDocs(collection(db, "users"));
        const users = []; snap.forEach(d => users.push({ id: d.id, ...d.data() }));
        const filtered = users.filter(u => (u.name && u.name.toLowerCase().includes(term)) || (u.phone && u.phone.includes(term)));
        renderAdminUsers(filtered);
    });

    // Theme Management
    const gradients = [
        { name: '‡¶™‡ßç‡¶∞‡¶ï‡ßÉ‡¶§‡¶ø', class: 'from-primary to-secondary' },
        { name: '‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø‡ßã‡¶¶‡¶Ø‡¶º', class: 'from-orange-500 to-yellow-500' },
        { name: '‡¶∂‡ßÄ‡¶§‡¶≤', class: 'from-blue-500 to-cyan-500' },
        { name: '‡¶¨‡ßá‡¶ó‡ßÅ‡¶®‡¶ø', class: 'from-purple-500 to-pink-500' },
        { name: '‡¶ó‡¶æ dark ‡¶º', class: 'from-gray-800 to-gray-900' }
    ];

    function loadThemeOptions() {
        const grid = document.getElementById('theme-grid');
        grid.innerHTML = gradients.map(g => 
            `<div class="bg-white p-3 rounded-xl shadow cursor-pointer" onclick="setTheme('${g.class}')">
                <div class="h-16 rounded-lg bg-gradient-to-r ${g.class} mb-2"></div>
                <p class="font-bold text-center">${g.name}</p>
            </div>`
        ).join('');
    }

    window.setTheme = async (gradientClass) => {
        document.getElementById('app-header').className = `absolute top-0 w-full text-white px-4 py-3 flex items-center justify-between z-40 shadow-md bg-gradient-to-r ${gradientClass}`;
        // Save to Firestore settings
        await setDoc(doc(db, "settings", "appearance"), { headerGradient: gradientClass });
    };

    async function loadTheme() {
        const snap = await getDoc(doc(db, "settings", "appearance"));
        if (snap.exists()) {
            document.getElementById('app-header').className = `absolute top-0 w-full text-white px-4 py-3 flex items-center justify-between z-40 shadow-md bg-gradient-to-r ${snap.data().headerGradient}`;
        }
    }

    // Logout
    document.getElementById('btn-logout').addEventListener('click', () => { signOut(auth).then(() => { window.location.reload(); }); });
</script>
</body>
    </html>
